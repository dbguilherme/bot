import{UIString as e,Throttler as t,Revealer as i,Color as s,Linkifier as n,Progress as o,Settings as r,ParsedURL as a,Trie as c,EventTarget as l,ResourceType as d,ObjectWrapper as h}from"../common/common.js";import{Widget as u,UIUtils as p,Dialog as _,GlassPane as m,Toolbar as g,TextEditor as b,View as S,ListModel as C,ListControl as f,Context as v,ARIAUtils as w,Icon as E,ContextMenu as x,ViewManager as y,ShortcutsScreen as k,KeyboardShortcut as I,Geometry as L,Utils as T,InspectorView as P,TreeOutline as M,ShortcutRegistry as F,InplaceEditor as D,PopoverHelper as B,TabbedPane as N,SearchableView as U,ActionRegistry as A,XLink as R,Panel as j,DropTarget as V,SplitWidget as O,SettingsUI as W,Infobar as H,ThrottledWidget as z,EmptyWidget as q,Fragment as G}from"../ui/ui.js";import{JavaScriptAutocomplete as K,JavaScriptREPL as $,ObjectPopoverHelper as J,RemoteObjectPreviewFormatter as Q,ObjectPropertiesSection as X}from"../object_ui/object_ui.js";import{Runtime as Y}from"../root/root.js";import{LiveLocation as Z,BlackboxManager as ee,DebuggerWorkspaceBinding as te,DefaultScriptMapping as ie,NetworkProject as se,CompilerScriptMapping as ne,DebuggerLanguagePlugins as oe,BreakpointManager as re,ResourceScriptMapping as ae}from"../bindings/bindings.js";import{InspectorFrontendHost as ce,Platform as le,userMetrics as de,UserMetrics as he}from"../host/host.js";import{Persistence as ue,FileSystemWorkspaceBinding as pe,NetworkPersistenceManager as _e,PersistenceUtils as me,IsolatedFileSystemManager as ge}from"../persistence/persistence.js";import{DebuggerModel as be,SDKModel as Se,CSSMetadata as Ce,DOMDebuggerModel as fe,RemoteObject as ve,OverlayModel as we,RuntimeModel as Ee,ConsoleModel as xe,NetworkRequest as ye}from"../sdk/sdk.js";import{Workspace as ke,UISourceCode as Ie,FileManager as Le}from"../workspace/workspace.js";import{CoverageModel as Te}from"../coverage/coverage.js";import{SourceFormatter as Pe,FormatterWorkerPool as Me,ScriptFormatter as Fe}from"../formatter/formatter.js";import{Spectrum as De}from"../color_picker/color_picker.js";import{SwatchPopoverHelper as Be,ColorSwatch as Ne,BezierEditor as Ue}from"../inline_editor/inline_editor.js";import{StringUtilities as Ae,Multimap as Re,SetUtilities as je,NumberUtilities as Ve,ArrayUtilities as Oe}from"../platform/platform.js";import{SourcesTextEditor as We,SourceCodeDiff as He,SourceFrame as ze,ImageView as qe,FontView as Ge}from"../source_frame/source_frame.js";import{TextRange as Ke,TextUtils as $e,Text as Je,TextCursor as Qe}from"../text_utils/text_utils.js";import{CodeMirrorUtils as Xe}from"../text_editor/text_editor.js";import{ExtensionServer as Ye}from"../extensions/extensions.js";import{ScriptSnippetFileSystem as Ze,project as et}from"../snippets/snippets.js";import{SearchView as tt}from"../search/search.js";import{QuickOpen as it,FilteredListWidget as st}from"../quick_open/quick_open.js";import{WorkspaceDiff as nt}from"../workspace_diff/workspace_diff.js";import{Linkifier as ot}from"../components/components.js";class rt extends u.HBox{constructor(t){super(!0),this.registerRequiredCSS("sources/dialog.css"),this.contentElement.createChild("label").textContent=e.UIString("Source map URL: "),this._input=p.createInput("add-source-map","text"),this._input.addEventListener("keydown",this._onKeyDown.bind(this),!1),this.contentElement.appendChild(this._input);const i=p.createTextButton(ls`Add`,this._apply.bind(this));this.contentElement.appendChild(i),this._dialog=new _.Dialog,this._dialog.setSizeBehavior(m.SizeBehavior.MeasureContent),this._dialog.setDefaultFocusedElement(this._input),this._callback=t}show(){super.show(this._dialog.contentElement),this._dialog.show()}_done(e){this._dialog.hide(),this._callback(e)}_apply(){this._done(this._input.value)}_onKeyDown(e){isEnterKey(e)&&(e.consume(!0),this._apply())}}var at=Object.freeze({__proto__:null,AddSourceMapURLDialog:rt});class ct extends u.Widget{constructor(e,t,i,s){super(!0),this.registerRequiredCSS("sources/breakpointEditDialog.css"),this._onFinish=s,this._finished=!1,this._editor=null,this.element.tabIndex=-1;const n=lt,o=dt;this._isLogpoint=t.startsWith(n)&&t.endsWith(o),this._isLogpoint&&(t=t.substring(n.length,t.length-o.length)),this._isLogpoint=this._isLogpoint||i,this.element.classList.add("sources-edit-breakpoint-dialog");const r=new g.Toolbar("source-frame-breakpoint-toolbar",this.contentElement);r.appendText(`Line ${e+1}:`),this._typeSelector=new g.ToolbarComboBox(this._onTypeChanged.bind(this),ls`Breakpoint type`),this._typeSelector.createOption(ls`Breakpoint`,ht.Breakpoint);const a=this._typeSelector.createOption(ls`Conditional breakpoint`,ht.Conditional),c=this._typeSelector.createOption(ls`Logpoint`,ht.Logpoint);this._typeSelector.select(this._isLogpoint?c:a),r.appendToolbarItem(this._typeSelector),Y.Runtime.instance().extension(b.TextEditorFactory).instance().then(e=>{this._editor=e.createEditor({lineNumbers:!1,lineWrapping:!0,mimeType:"javascript",autoHeight:!0}),this._updatePlaceholder(),this._editor.widget().element.classList.add("condition-editor"),this._editor.configureAutocomplete(K.JavaScriptAutocompleteConfig.createConfigForEditor(this._editor)),t&&this._editor.setText(t),this._editor.widget().markAsExternallyManaged(),this._editor.widget().show(this.contentElement),this._editor.setSelection(this._editor.fullRange()),this._editor.widget().focus(),this._editor.widget().element.addEventListener("keydown",this._onKeyDown.bind(this),!0),this.element.addEventListener("blur",e=>{e.relatedTarget&&!e.relatedTarget.isSelfOrDescendant(this.element)&&this._finishEditing(!0)},!0)})}static _conditionForLogpoint(e){return`${lt}${e}${dt}`}_onTypeChanged(){const e=this._typeSelector.selectedOption().value;this._isLogpoint=e===ht.Logpoint,this._updatePlaceholder(),e===ht.Breakpoint&&(this._editor.setText(""),this._finishEditing(!0))}_updatePlaceholder(){const e=this._typeSelector.selectedOption().value;e===ht.Conditional?(this._editor.setPlaceholder(ls`Expression to check before pausing, e.g. x > 5`),this._typeSelector.element.title=ls`Pause only when the condition is true`):e===ht.Logpoint&&(this._editor.setPlaceholder(ls`Log message, e.g. 'x is', x`),this._typeSelector.element.title=ls`Log a message to Console, do not break`)}_finishEditing(e){if(this._finished)return;this._finished=!0,this._editor.widget().detach();let t=this._editor.text();this._isLogpoint&&(t=ct._conditionForLogpoint(t)),this._onFinish({committed:e,condition:t})}async _onKeyDown(e){if(isEnterKey(e)&&!e.shiftKey){e.consume(!0);const t=this._editor.text();e.ctrlKey||await K.JavaScriptAutocomplete.isExpressionComplete(t)?this._finishEditing(!0):this._editor.newlineAndIndent()}isEscKey(e)&&(this._finishEditing(!1),e.stopImmediatePropagation())}}const lt="/** DEVTOOLS_LOGPOINT */ console.log(",dt=")",ht={Breakpoint:"Breakpoint",Conditional:"Conditional",Logpoint:"Logpoint"};var ut=Object.freeze({__proto__:null,BreakpointEditDialog:ct,LogpointPrefix:lt,LogpointSuffix:dt,BreakpointType:ht});let pt;class _t extends S.SimpleView{constructor(){super(e.UIString("Call Stack"),!0),this.registerRequiredCSS("sources/callStackSidebarPane.css"),this._blackboxedMessageElement=this._createBlackboxedMessageElement(),this.contentElement.appendChild(this._blackboxedMessageElement),this._notPausedMessageElement=this.contentElement.createChild("div","gray-info-message"),this._notPausedMessageElement.textContent=e.UIString("Not paused"),this._notPausedMessageElement.tabIndex=-1,this._items=new C.ListModel,this._list=new f.ListControl(this._items,this,f.ListMode.NonViewport),this.contentElement.appendChild(this._list.element),this._list.element.addEventListener("contextmenu",this._onContextMenu.bind(this),!1),self.onInvokeElement(this._list.element,e=>{const t=this._list.itemForNode(e.target);t&&(this._activateItem(t),e.consume(!0))}),this._showMoreMessageElement=this._createShowMoreMessageElement(),this._showMoreMessageElement.classList.add("hidden"),this.contentElement.appendChild(this._showMoreMessageElement),this._showBlackboxed=!1,this._locationPool=new Z.LiveLocationPool,this._updateThrottler=new t.Throttler(100),this._maxAsyncStackChainDepth=bt,this._update(),this._updateItemThrottler=new t.Throttler(100),this._scheduledForUpdateItems=new Set}static instance(e={forceNew:null}){const{forceNew:t}=e;return pt&&!t||(pt=new _t),pt}flavorChanged(e){this._showBlackboxed=!1,this._maxAsyncStackChainDepth=bt,this._update()}_update(){this._updateThrottler.schedule(()=>this._doUpdate())}async _doUpdate(){this._locationPool.disposeAll();const e=v.Context.instance().flavor(be.DebuggerPausedDetails);if(!e)return this.setDefaultFocusedElement(this._notPausedMessageElement),this._notPausedMessageElement.classList.remove("hidden"),this._blackboxedMessageElement.classList.add("hidden"),this._showMoreMessageElement.classList.add("hidden"),this._items.replaceAll([]),void v.Context.instance().setFlavor(be.CallFrame,null);let t=e.debuggerModel;this._notPausedMessageElement.classList.add("hidden");const i=[];for(const t of e.callFrames){const e=St.createForDebuggerCallFrame(t,this._locationPool,this._refreshItem.bind(this)).then(e=>(mt.set(e,t),e));i.push(e)}const s=await Promise.all(i);let n=e.asyncStackTrace;!n&&e.asyncStackTraceId&&(e.asyncStackTraceId.debuggerId&&(t=be.DebuggerModel.modelForDebuggerId(e.asyncStackTraceId.debuggerId)),n=t?await t.fetchAsyncStackTrace(e.asyncStackTraceId):null);let o=e.callFrames,r=this._maxAsyncStackChainDepth;for(;n&&r>0;){let e="";if("async function"===n.description&&o.length&&n.callFrames.length){const t=o[o.length-1],i=p.beautifyFunctionName(t.functionName);e=p.asyncStackTraceLabel("await in "+i)}else e=p.asyncStackTraceLabel(n.description);s.push(...await St.createItemsForAsyncStack(e,t,n.callFrames,this._locationPool,this._refreshItem.bind(this))),--r,o=n.callFrames,n.parent?n=n.parent:n.parentId?(n.parentId.debuggerId&&(t=be.DebuggerModel.modelForDebuggerId(n.parentId.debuggerId)),n=t?await t.fetchAsyncStackTrace(n.parentId):null):n=null}if(this._showMoreMessageElement.classList.toggle("hidden",!n),this._items.replaceAll(s),this._maxAsyncStackChainDepth===bt){this._list.selectNextItem(!0,!1);const e=this._list.selectedItem();e&&this._activateItem(e)}this._updatedForTest()}_updatedForTest(){}_refreshItem(e){this._scheduledForUpdateItems.add(e),this._updateItemThrottler.schedule(async()=>{const e=Array.from(this._scheduledForUpdateItems);if(this._scheduledForUpdateItems.clear(),this._muteActivateItem=!0,!this._showBlackboxed&&this._items.every(e=>e.isBlackboxed)){this._showBlackboxed=!0;for(let e=0;e<this._items.length;++e)this._list.refreshItemByIndex(e);this._blackboxedMessageElement.classList.toggle("hidden",!0)}else{const t=new Set(e);let i=!1;for(let e=0;e<this._items.length;++e){const s=this._items.at(e);t.has(s)&&this._list.refreshItemByIndex(e),i=i||s.isBlackboxed}this._blackboxedMessageElement.classList.toggle("hidden",this._showBlackboxed||!i)}delete this._muteActivateItem})}createElementForItem(e){const t=document.createElement("div");t.classList.add("call-frame-item");const i=t.createChild("div","call-frame-item-title").createChild("div","call-frame-title-text");if(i.textContent=e.title,e.isAsyncHeader)t.classList.add("async-header");else{i.title=e.title;const s=t.createChild("div","call-frame-location");s.textContent=e.linkText.trimMiddle(30),s.title=e.linkText,t.classList.toggle("blackboxed-call-frame",e.isBlackboxed),e.isBlackboxed&&w.setDescription(t,ls`blackboxed`),mt.has(e)||w.setDisabled(t,!0)}const s=mt.get(e)===v.Context.instance().flavor(be.CallFrame);return t.classList.toggle("selected",s),w.setSelected(t,s),t.classList.toggle("hidden",!this._showBlackboxed&&e.isBlackboxed),t.appendChild(E.Icon.create("smallicon-thick-right-arrow","selected-call-frame-icon")),t.tabIndex=e===this._list.selectedItem()?0:-1,t}heightForItem(e){return console.assert(!1),0}isItemSelectable(e){return!0}selectedItemChanged(e,t,i,s){i&&(i.tabIndex=-1),s&&(this.setDefaultFocusedElement(s),s.tabIndex=0,this.hasFocus()&&s.focus())}updateSelectedItemARIA(e,t){return!0}_createBlackboxedMessageElement(){const t=document.createElement("div");t.classList.add("blackboxed-message"),t.createChild("span");const i=t.createChild("span","link");i.textContent=e.UIString("Show blackboxed frames"),w.markAsLink(i),i.tabIndex=0;const s=()=>{this._showBlackboxed=!0;for(const e of this._items)this._refreshItem(e);this._blackboxedMessageElement.classList.toggle("hidden",!0)};return i.addEventListener("click",s),i.addEventListener("keydown",e=>isEnterKey(e)&&s()),t}_createShowMoreMessageElement(){const t=document.createElement("div");t.classList.add("show-more-message"),t.createChild("span");const i=t.createChild("span","link");return i.textContent=e.UIString("Show more"),i.addEventListener("click",()=>{this._maxAsyncStackChainDepth+=bt,this._update()},!1),t}_onContextMenu(t){const i=this._list.itemForNode(t.target);if(!i)return;const s=new x.ContextMenu(t),n=mt.get(i);n&&s.defaultSection().appendItem(e.UIString("Restart frame"),()=>n.restart()),s.defaultSection().appendItem(e.UIString("Copy stack trace"),this._copyStackTrace.bind(this)),i.uiLocation&&this.appendBlackboxURLContextMenuItems(s,i.uiLocation.uiSourceCode),s.show()}_onClick(e){const t=this._list.itemForNode(e.target);t&&this._activateItem(t)}_activateItem(e){const t=e.uiLocation;if(this._muteActivateItem||!t)return;this._list.selectItem(e);const s=mt.get(e),n=this.activeCallFrameItem();s&&n!==e?(s.debuggerModel.setSelectedCallFrame(s),v.Context.instance().setFlavor(be.CallFrame,s),n&&this._refreshItem(n),this._refreshItem(e)):i.reveal(t)}activeCallFrameItem(){const e=v.Context.instance().flavor(be.CallFrame);return e&&this._items.find(t=>mt.get(t)===e)||null}appendBlackboxURLContextMenuItems(t,i){const s=ue.PersistenceImpl.instance().binding(i);if(s&&(i=s.network),i.project().type()===ke.projectTypes.FileSystem)return;const n=ee.BlackboxManager.instance().canBlackboxUISourceCode(i),o=ee.BlackboxManager.instance().isBlackboxedUISourceCode(i),r=i.project().type()===ke.projectTypes.ContentScripts,a=ee.BlackboxManager.instance();n&&(o?t.defaultSection().appendItem(e.UIString("Stop blackboxing"),a.unblackboxUISourceCode.bind(a,i)):t.defaultSection().appendItem(e.UIString("Blackbox script"),a.blackboxUISourceCode.bind(a,i))),r&&(o?t.defaultSection().appendItem(e.UIString("Stop blackboxing all content scripts"),a.blackboxContentScripts.bind(a)):t.defaultSection().appendItem(e.UIString("Blackbox all content scripts"),a.unblackboxContentScripts.bind(a)))}_selectNextCallFrameOnStack(){const e=this.activeCallFrameItem();for(let t=e?this._items.indexOf(e)+1:0;t<this._items.length;t++){const e=this._items.at(t);if(mt.has(e)){this._activateItem(e);break}}}_selectPreviousCallFrameOnStack(){const e=this.activeCallFrameItem();for(let t=e?this._items.indexOf(e)-1:this._items.length-1;t>=0;t--){const e=this._items.at(t);if(mt.has(e)){this._activateItem(e);break}}}_copyStackTrace(){const e=[];for(const t of this._items){let i=t.title;t.uiLocation&&(i+=" ("+t.uiLocation.linkText(!0)+")"),e.push(i)}ce.InspectorFrontendHostInstance.copyText(e.join("\n"))}}const mt=new WeakMap,gt=Symbol("element"),bt=32;class St{static async createForDebuggerCallFrame(e,t,i){const s=new St(p.beautifyFunctionName(e.functionName),i);return await te.DebuggerWorkspaceBinding.instance().createCallFrameLiveLocation(e.location(),s._update.bind(s),t),s}static async createItemsForAsyncStack(e,t,i,s,n){const o=new WeakMap,r=new St(e,n);o.set(r,new Set),r.isAsyncHeader=!0;const a=[],c=[];for(const e of i){const i=new St(p.beautifyFunctionName(e.functionName),l),n=t?t.createRawLocationByScriptId(e.scriptId,e.lineNumber,e.columnNumber):null;n?c.push(te.DebuggerWorkspaceBinding.instance().createCallFrameLiveLocation(n,i._update.bind(i),s)):(i.linkText=(e.url||"<unknown>")+":"+(e.lineNumber+1),i.updateDelegate(i)),a.push(i)}return await Promise.all(c),n(r),[r,...a];function l(e){n(e);let t=!1;const i=o.get(r);i&&(e.isBlackboxed?(i.delete(e),t=0===i.size):(t=0===i.size,i.add(e)),r.isBlackboxed=0===i.size),t&&n(r)}}constructor(e,t){this.isBlackboxed=!1,this.title=e,this.linkText="",this.uiLocation=null,this.isAsyncHeader=!1,this.updateDelegate=t}async _update(e){const t=await e.uiLocation();this.isBlackboxed=await e.isBlackboxed(),this.linkText=t?t.linkText():"",this.uiLocation=t,this.updateDelegate(this)}}var Ct=Object.freeze({__proto__:null,CallStackSidebarPane:_t,elementSymbol:gt,defaultMaxAsyncStackChainDepth:bt,ActionDelegate:class{handleAction(e,t){switch(t){case"debugger.next-call-frame":return _t.instance()._selectNextCallFrameOnStack(),!0;case"debugger.previous-call-frame":return _t.instance()._selectPreviousCallFrameOnStack(),!0}return!1}},Item:St});class ft{static accepts(e){return!1}wasShown(){}willHide(){}async rightToolbarItems(){return[]}leftToolbarItems(){return[]}populateLineGutterContextMenu(e,t){return Promise.resolve()}populateTextAreaContextMenu(e,t,i){return Promise.resolve()}dispose(){}}var vt=Object.freeze({__proto__:null,Plugin:ft});class wt extends ft{constructor(e,t){super(),this._textEditor=e,this._uiSourceCode=t,this._originalSourceCode=Pe.SourceFormatter.instance().getOriginalUISourceCode(this._uiSourceCode),this._text=new g.ToolbarButton(ls`Click to show Coverage Panel`),this._text.setSecondary(),this._text.addEventListener(g.ToolbarButton.Events.Click,()=>{y.ViewManager.instance().showView("coverage")});const i=Se.TargetManager.instance().mainTarget();i&&(this._model=i.model(Te.CoverageModel),this._model&&(this._model.addEventListener(Te.Events.CoverageReset,this._handleReset,this),this._coverage=this._model.getCoverageForUrl(this._originalSourceCode.url()),this._coverage&&this._coverage.addEventListener(Te.URLCoverageInfo.Events.SizesChanged,this._handleCoverageSizesChanged,this))),this._updateStats()}dispose(){this._coverage&&this._coverage.removeEventListener(Te.URLCoverageInfo.Events.SizesChanged,this._handleCoverageSizesChanged,this),this._model&&this._model.removeEventListener(Te.Events.CoverageReset,this._handleReset,this)}static accepts(e){return e.contentType().isDocumentOrScriptOrStyleSheet()}_handleReset(){this._coverage=null,this._updateStats()}_handleCoverageSizesChanged(){this._updateStats()}_updateStats(){this._coverage?(this._text.setTitle(ls`Show Details`),this._text.setText(ls`Coverage: ${this._coverage.usedPercentage().toFixed(1)} %`)):(this._text.setTitle(ls`Click to show Coverage Panel`),this._text.setText(ls`Coverage: n/a`))}async rightToolbarItems(){return[this._text]}}var Et=Object.freeze({__proto__:null,CoveragePlugin:wt});class xt extends ft{constructor(e){super(),this._textEditor=e,this._swatchPopoverHelper=new Be.SwatchPopoverHelper,this._muteSwatchProcessing=!1,this._hadSwatchChange=!1,this._bezierEditor=null,this._editedSwatchTextRange=null,this._spectrum=null,this._currentSwatch=null,this._textEditor.configureAutocomplete({suggestionsCallback:this._cssSuggestions.bind(this),isWordChar:this._isWordChar.bind(this),anchorBehavior:void 0,substituteRangeCallback:void 0,tooltipCallback:void 0}),this._textEditor.addEventListener(We.Events.ScrollChanged,this._textEditorScrolled,this),this._textEditor.addEventListener(b.Events.TextChanged,this._onTextChanged,this),this._updateSwatches(0,this._textEditor.linesCount-1),this._shortcuts=new Map,this._registerShortcuts(),this._boundHandleKeyDown=this._handleKeyDown.bind(this),this._textEditor.element.addEventListener("keydown",this._boundHandleKeyDown,!1)}static accepts(e){return e.contentType().isStyleSheet()}_registerShortcuts(){const e=k.SourcesPanelShortcuts;for(const t of e.IncreaseCSSUnitByOne)this._shortcuts.set(t.key,this._handleUnitModification.bind(this,1));for(const t of e.DecreaseCSSUnitByOne)this._shortcuts.set(t.key,this._handleUnitModification.bind(this,-1));for(const t of e.IncreaseCSSUnitByTen)this._shortcuts.set(t.key,this._handleUnitModification.bind(this,10));for(const t of e.DecreaseCSSUnitByTen)this._shortcuts.set(t.key,this._handleUnitModification.bind(this,-10))}_handleKeyDown(e){const t=I.KeyboardShortcut.makeKeyFromEvent(e),i=this._shortcuts.get(t);i&&i()&&e.consume(!0)}_textEditorScrolled(){this._swatchPopoverHelper.isShowing()&&this._swatchPopoverHelper.hide(!0)}_modifyUnit(e,t){const i=parseInt(e,10);if(isNaN(i))return null;const s=e.substring(i.toString().length);return Ae.sprintf("%d%s",i+t,s)}_handleUnitModification(e){const t=this._textEditor.selection().normalize();let i=this._textEditor.tokenAtTextPosition(t.startLine,t.startColumn);if(!i&&(t.startColumn>0&&(i=this._textEditor.tokenAtTextPosition(t.startLine,t.startColumn-1)),!i))return!1;if("css-number"!==i.type)return!1;const s=new Ke.TextRange(t.startLine,i.startColumn,t.startLine,i.endColumn),n=this._textEditor.text(s),o=this._modifyUnit(n,e);return!!o&&(this._textEditor.editRange(s,o),t.startColumn=i.startColumn,t.endColumn=t.startColumn+o.length,this._textEditor.setSelection(t),!0)}_updateSwatches(e,t){const i=[],n=[],o=[Ce.VariableRegex,Ce.URLRegex,L.CubicBezier.Regex,s.Regex],r=new Map;r.set(s.Regex,this._createColorSwatch.bind(this)),r.set(L.CubicBezier.Regex,this._createBezierSwatch.bind(this));for(let s=e;s<=t;s++){const e=this._textEditor.line(s).substring(0,yt),t=$e.Utils.splitStringByRegexes(e,o);for(let a=0;a<t.length;a++){const c=t[a],l=r.get(o[c.regexIndex]);if(-1===c.regexIndex||!l)continue;const d=/[\s:;,(){}]/,h=c.position-1,u=c.position+c.value.length;if(h>=0&&!d.test(e.charAt(h))||u<e.length&&!d.test(e.charAt(u)))continue;const p=l(c.value);p&&(i.push(p),n.push(Ke.TextRange.createFromLocation(s,c.position)))}}this._textEditor.operation(function(){const s=new Ke.TextRange(e,0,t,this._textEditor.line(t).length);this._textEditor.bookmarks(s,kt).forEach(e=>e.clear());for(let e=0;e<i.length;e++){const t=i[e],s=n[e],o=this._textEditor.addBookmark(s.startLine,s.startColumn,t,kt);It.set(t,o)}}.bind(this))}_createColorSwatch(t){const i=s.Color.parse(t);if(!i)return null;const n=Ne.ColorSwatch.create();return n.setColor(i),n.iconElement().title=e.UIString("Open color picker."),n.iconElement().addEventListener("click",this._swatchIconClicked.bind(this,n),!1),n.hideText(!0),n}_createBezierSwatch(t){if(!L.CubicBezier.parse(t))return null;const i=Ne.BezierSwatch.create();return i.setBezierText(t),i.iconElement().title=e.UIString("Open cubic bezier editor."),i.iconElement().addEventListener("click",this._swatchIconClicked.bind(this,i),!1),i.hideText(!0),i}_swatchIconClicked(e,t){t.consume(!0),this._hadSwatchChange=!1,this._muteSwatchProcessing=!0;const i=It.get(e);if(!i)return;const s=i.position();s&&(this._textEditor.setSelection(s),this._editedSwatchTextRange=s.clone(),this._editedSwatchTextRange&&(this._editedSwatchTextRange.endColumn+=(e.textContent||"").length),this._currentSwatch=e,e instanceof Ne.ColorSwatch?this._showSpectrum(e):e instanceof Ne.BezierSwatch&&this._showBezierEditor(e))}_showSpectrum(e){this._spectrum||(this._spectrum=new De.Spectrum,this._spectrum.addEventListener(De.Events.SizeChanged,this._spectrumResized,this),this._spectrum.addEventListener(De.Events.ColorChanged,this._spectrumChanged,this)),this._spectrum.setColor(e.color(),e.format()),this._swatchPopoverHelper.show(this._spectrum,e.iconElement(),this._swatchPopoverHidden.bind(this))}_spectrumResized(e){this._swatchPopoverHelper.reposition()}_spectrumChanged(e){const t=e.data,i=s.Color.parse(t);i&&this._currentSwatch&&(this._currentSwatch instanceof Ne.ColorSwatch&&this._currentSwatch.setColor(i),this._changeSwatchText(t))}_showBezierEditor(e){this._bezierEditor||(this._bezierEditor=new Ue.BezierEditor,this._bezierEditor.addEventListener(Ue.Events.BezierChanged,this._bezierChanged,this));let t=L.CubicBezier.parse(e.bezierText());t||(t=L.CubicBezier.parse("linear")),this._bezierEditor.setBezier(t),this._swatchPopoverHelper.show(this._bezierEditor,e.iconElement(),this._swatchPopoverHidden.bind(this))}_bezierChanged(e){const t=e.data;this._currentSwatch instanceof Ne.BezierSwatch&&this._currentSwatch.setBezierText(t),this._changeSwatchText(t)}_changeSwatchText(e){this._hadSwatchChange=!0;const t=this._editedSwatchTextRange;this._textEditor.editRange(t,e,"*swatch-text-changed"),t.endColumn=t.startColumn+e.length}_swatchPopoverHidden(e){this._muteSwatchProcessing=!1,!e&&this._hadSwatchChange&&this._textEditor.undo()}_onTextChanged(e){this._muteSwatchProcessing||this._updateSwatches(e.data.newRange.startLine,e.data.newRange.endLine)}_isWordChar(e){return $e.Utils.isWordChar(e)||"."===e||"-"===e||"$"===e}_cssSuggestions(e,t){const i=this._textEditor.text(e);if(i.startsWith("$"))return null;const s=this._backtrackPropertyToken(e.startLine,e.startColumn-1);if(!s)return null;const n=this._textEditor.line(e.startLine).substring(s.startColumn,s.endColumn),o=Ce.cssMetadata().propertyValues(n);return Promise.resolve(o.filter(e=>e.startsWith(i)).map(e=>({text:e,title:void 0,subtitle:void 0,iconType:void 0,priority:void 0,isSecondary:void 0,subtitleRenderer:void 0,selectionRange:void 0,hideGhostText:void 0})))}_backtrackPropertyToken(e,t){let i=t;const s=this._textEditor.line(e);let n=!1;for(let t=0;t<10&&i>=0;++t){const t=this._textEditor.tokenAtTextPosition(e,i);if(!t)return null;if("css-property"===t.type)return n?t:null;if(t.type&&-1===t.type.indexOf("whitespace")&&!t.type.startsWith("css-comment"))return null;if(!t.type&&":"===s.substring(t.startColumn,t.endColumn)){if(n)return null;n=!0}i=t.startColumn-1}return null}dispose(){this._swatchPopoverHelper.isShowing()&&this._swatchPopoverHelper.hide(!0),this._textEditor.removeEventListener(We.Events.ScrollChanged,this._textEditorScrolled,this),this._textEditor.removeEventListener(b.Events.TextChanged,this._onTextChanged,this),this._textEditor.bookmarks(this._textEditor.fullRange(),kt).forEach(e=>e.clear()),this._textEditor.element.removeEventListener("keydown",this._boundHandleKeyDown,!1)}}const yt=300,kt=Symbol("swatch"),It=new WeakMap;var Lt=Object.freeze({__proto__:null,CSSPlugin:xt,maxSwatchProcessingLength:yt,SwatchBookmark:kt});class Tt{constructor(){this._element=document.createElement("div"),this._element.classList.add("paused-message"),this._element.classList.add("flex-none");const e=T.createShadowRootWithCoreStyles(this._element,"sources/debuggerPausedMessage.css");this._contentElement=e.createChild("div"),w.markAsPoliteLiveRegion(this._element,!1)}element(){return this._element}static _descriptionWithoutStack(e){const t=/^\s+at\s/m.exec(e);return t?e.substring(0,t.index-1):e.substring(0,e.lastIndexOf("\n"))}static async _createDOMBreakpointHitMessage(e){const t=document.createElement("span"),i=e.debuggerModel.target().model(fe.DOMDebuggerModel);if(!e.auxData||!i)return t;const s=i.resolveDOMBreakpointData(e.auxData);if(!s)return t;const o=t.createChild("div","status-main");o.appendChild(E.Icon.create("smallicon-info","status-icon"));const r=Pt.get(s.type);o.appendChild(document.createTextNode(ls`Paused on ${r}`));const a=t.createChild("div","status-sub monospace"),c=await n.Linkifier.linkify(s.node);if(a.appendChild(c),s.targetNode){const e=await n.Linkifier.linkify(s.targetNode);let t;t=s.insertion?s.targetNode===s.node?p.formatLocalized("Child %s added",[e]):p.formatLocalized("Descendant %s added",[e]):p.formatLocalized("Descendant %s removed",[e]),a.appendChild(document.createElement("br")),a.appendChild(t)}return t}async render(t,i,s){if(this._contentElement.removeChildren(),this._contentElement.hidden=!t,!t)return;const n=this._contentElement.createChild("div","paused-status"),o=t.reason===be.BreakReason.Exception||t.reason===be.BreakReason.PromiseRejection||t.reason===be.BreakReason.Assert||t.reason===be.BreakReason.OOM;let r;if(t.reason===be.BreakReason.DOM)r=await Tt._createDOMBreakpointHitMessage(t);else if(t.reason===be.BreakReason.EventListener){let i="";t.auxData&&(i=fe.DOMDebuggerManager.instance().resolveEventListenerBreakpointTitle(t.auxData)),r=a(e.UIString("Paused on event listener"),i)}else if(t.reason===be.BreakReason.XHR){const i=t.auxData;r=a(e.UIString("Paused on XHR or fetch"),i.url||"")}else if(t.reason===be.BreakReason.Exception){const i=t.auxData,s=i.description||i.value||"",n=Tt._descriptionWithoutStack(s);r=a(e.UIString("Paused on exception"),n,s)}else if(t.reason===be.BreakReason.PromiseRejection){const i=t.auxData,s=i.description||i.value||"",n=Tt._descriptionWithoutStack(s);r=a(e.UIString("Paused on promise rejection"),n,s)}else if(t.reason===be.BreakReason.Assert)r=a(e.UIString("Paused on assertion"));else if(t.reason===be.BreakReason.DebugCommand)r=a(e.UIString("Paused on debugged function"));else if(t.reason===be.BreakReason.OOM)r=a(e.UIString("Paused before potential out-of-memory crash"));else if(t.callFrames.length){const n=await i.rawLocationToUILocation(t.callFrames[0].location());r=a((n?s.findBreakpoint(n):null)?e.UIString("Paused on breakpoint"):e.UIString("Debugger paused"))}else console.warn("ScriptsPanel paused, but callFrames.length is zero.");function a(e,t,i){const s=document.createElement("span"),n=s.createChild("div","status-main"),r=E.Icon.create(o?"smallicon-error":"smallicon-info","status-icon");if(n.appendChild(r),n.appendChild(document.createTextNode(e)),t){const e=s.createChild("div","status-sub monospace");e.textContent=t,e.title=i||t}return s}n.classList.toggle("error-reason",o),r&&n.appendChild(r)}}const Pt=new Map([[Protocol.DOMDebugger.DOMBreakpointType.SubtreeModified,e.UIString("subtree modifications")],[Protocol.DOMDebugger.DOMBreakpointType.AttributeModified,e.UIString("attribute modifications")],[Protocol.DOMDebugger.DOMBreakpointType.NodeRemoved,e.UIString("node removal")]]);var Mt=Object.freeze({__proto__:null,DebuggerPausedMessage:Tt,BreakpointTypeNouns:Pt});const Ft=Symbol("cache"),Dt=Symbol("cachedIdentifiers");class Bt{constructor(e,t,i){this.name=e,this.lineNumber=t,this.columnNumber=i}}const Nt=function(e){const t=e.startLocation(),i=e.endLocation();if(!(e.type()!==Protocol.Debugger.ScopeType.Global&&t&&i&&t.script()&&t.script().sourceMapURL&&t.script()===i.script()))return Promise.resolve([]);return t.script().requestContent().then((function(e){if(!e.content)return Promise.resolve([]);const n=e.content,o=new Je.Text(n),r=new Ke.TextRange(t.lineNumber,t.columnNumber,i.lineNumber,i.columnNumber),a=o.extract(r),c=o.toSourceRange(r).offset;return Me.formatterWorkerPool().javaScriptIdentifiers("function fui"+a).then(s.bind(null,o,c,"function fui"))}));function s(e,t,i,s){const n=[],o=new Qe.TextCursor(e.lineEndings());for(let e=0;e<s.length;++e){const r=s[e];if(r.offset<i.length)continue;const a=t+r.offset-i.length;o.resetTo(a),n.push(new Bt(r.name,o.lineNumber(),o.columnNumber()))}return n}},Ut=function(e){let t=e[Dt];if(t)return t;const i=e.callFrame().script,s=te.DebuggerWorkspaceBinding.instance().sourceMapForScript(i);if(!s)return Promise.resolve(new Map);const n=new Map;return t=Nt(e).then((function(e){const t=new Map;for(let i=0;i<e.length;++i){const n=e[i],o=s.findEntry(n.lineNumber,n.columnNumber);o&&o.name&&t.set(n.name,o.name)}const i=[];for(let s=0;s<e.length;++s){const n=e[s];if(t.has(n.name))continue;const a=r(n).then(o.bind(null,t,n));i.push(a)}return Promise.all(i).then(()=>Sources.SourceMapNamesResolver._scopeResolvedForTest()).then(()=>t)})),e[Dt]=t,t;function o(e,t,i){i&&e.set(t.name,i)}function r(e){const t=s.findEntry(e.lineNumber,e.columnNumber),o=s.findEntry(e.lineNumber,e.columnNumber+e.name.length);if(!(t&&o&&t.sourceURL&&t.sourceURL===o.sourceURL&&t.sourceLineNumber&&t.sourceColumnNumber&&o.sourceLineNumber&&o.sourceColumnNumber))return Promise.resolve(null);const r=new Ke.TextRange(t.sourceLineNumber,t.sourceColumnNumber,o.sourceLineNumber,o.sourceColumnNumber),a=te.DebuggerWorkspaceBinding.instance().uiSourceCodeForSourceMapSourceURL(i.debuggerModel,t.sourceURL,i.isContentScript());return a?a.requestContent().then(e=>{const t=e.content;return function(e,t){if(!t)return null;let i=n.get(t);i||(i=new Je.Text(t),n.set(t,i));const s=i.extract(e).trim();return/[a-zA-Z0-9_$]+/.test(s)?s:null}(r,t)}):Promise.resolve(null)}},At=function(e){const t=e[Ft];if(t)return Promise.resolve(t);const i=[],s=e.scopeChain();for(let e=0;e<s.length;++e)i.push(Ut(s[e]));return Promise.all(i).then((function(t){const i=new Map;for(const e of t)for(const t of e.keys()){const s=e.get(t);i.has(s)||i.set(s,t)}return e[Ft]=i,i}))},Rt=function(e,t,i,s,n,o){return"application/wasm"===i.mimeType()?Promise.resolve(`memories["${t}"] ?? locals["${t}"] ?? tables["${t}"] ?? functions["${t}"] ?? globals["${t}"] ?? imports["${t}"] ?? exports["${t}"]`):i.contentType().isFromSourceMap()?At(e).then(r=>function(e,r){if(r.has(t))return Promise.resolve(r.get(t)||"");return jt(e,i,s,n,o)}(e.debuggerModel,r)):Promise.resolve("")},jt=async function(e,t,i,s,n){const o=(await te.DebuggerWorkspaceBinding.instance().uiLocationToRawLocations(t,i,s)).find(t=>t.debuggerModel===e);if(!o)return"";const r=o.script();if(!r)return"";const a=te.DebuggerWorkspaceBinding.instance().sourceMapForScript(r);return a?r.requestContent().then((function(e){const o=e.content;if(!o)return Promise.resolve("");const r=new Je.Text(o),c=a.reverseMapTextRange(t.url(),new Ke.TextRange(i,s,i,n));if(!c)return Promise.resolve("");const l=r.extract(c);if(!l)return Promise.resolve("");return Me.formatterWorkerPool().evaluatableJavaScriptSubstring(l)})):""},Vt=function(e){return e?e.scopeChain().length?Ut(e.scopeChain()[0]).then((function(i){const s=i.inverse().get("this");if(!s||1!==s.size)return Promise.resolve(e.thisObject());const n=s.values().next().value;return e.evaluate({expression:n,objectGroup:"backtrace",includeCommandLineAPI:!1,silent:!0,returnByValue:!1,generatePreview:!0}).then(t)})):Promise.resolve(e.thisObject()):Promise.resolve(null);function t(t){return!t.exceptionDetails&&t.object?t.object:e.thisObject()}},Ot=function(e){const t=e.startLocation(),i=e.endLocation();return e.type()!==Protocol.Debugger.ScopeType.Global&&t&&i&&t.script()&&t.script().sourceMapURL&&t.script()===i.script()?new Wt(e):e.object()};class Wt extends ve.RemoteObject{constructor(e){super(),this._scope=e,this._object=e.object()}customPreview(){return this._object.customPreview()}get objectId(){return this._object.objectId}get type(){return this._object.type}get subtype(){return this._object.subtype}get value(){return this._object.value}get description(){return this._object.description}get hasChildren(){return this._object.hasChildren}get preview(){return this._object.preview}arrayLength(){return this._object.arrayLength()}getOwnProperties(e){return this._object.getOwnProperties(e)}async getAllProperties(e,t){const i=await this._object.getAllProperties(e,t),s=await Ut(this._scope),n=i.properties,o=i.internalProperties,r=[];if(n)for(let e=0;e<n.length;++e){const t=n[e],i=s.get(t.name)||n[e].name;r.push(new ve.RemoteObjectProperty(i,t.value,t.enumerable,t.writable,t.isOwn,t.wasThrown,t.symbol,t.synthetic))}return{properties:r,internalProperties:o}}async setPropertyValue(e,t){const i=await Ut(this._scope);let s;s="string"==typeof e?e:e.value;let n=s;for(const e of i.keys())if(i.get(e)===s){n=e;break}return this._object.setPropertyValue(n,t)}async deleteProperty(e){return this._object.deleteProperty(e)}callFunction(e,t){return this._object.callFunction(e,t)}callFunctionJSON(e,t){return this._object.callFunctionJSON(e,t)}release(){this._object.release()}debuggerModel(){return this._object.debuggerModel()}runtimeModel(){return this._object.runtimeModel()}isNode(){return this._object.isNode()}}var Ht=Object.freeze({__proto__:null,cachedMapSymbol:Ft,cachedIdentifiersSymbol:Dt,Identifier:Bt,scopeIdentifiers:Nt,resolveScope:Ut,allVariablesInCallFrame:At,resolveExpression:Rt,resolveExpressionAsync:jt,resolveThisObject:Vt,resolveScopeInObject:Ot,RemoteObject:Wt});class zt{constructor(){this._searchId=0,this._searchResultCandidates=[],this._searchResultCallback=null,this._searchFinishedCallback=null,this._searchConfig=null}static _filesComparator(e,t){if(e.isDirty()&&!t.isDirty())return-1;if(!e.isDirty()&&t.isDirty())return 1;const i=e.project().type()===ke.projectTypes.FileSystem&&!ue.PersistenceImpl.instance().binding(e);if(i!==(t.project().type()===ke.projectTypes.FileSystem&&!ue.PersistenceImpl.instance().binding(t)))return i?1:-1;const s=e.url(),n=t.url();return s&&!n?-1:!s&&n?1:String.naturalOrderComparator(e.fullDisplayName(),t.fullDisplayName())}performIndexing(e){this.stopSearch();const t=this._projects(),i=new o.CompositeProgress(e);for(let e=0;e<t.length;++e){const s=t[e],n=i.createSubProgress(s.uiSourceCodes().length);s.indexContent(n)}}_projects(){const e=r.Settings.instance().moduleSetting("searchInAnonymousAndContentScripts").get();return ke.WorkspaceImpl.instance().projects().filter(t=>t.type()!==ke.projectTypes.Service&&(!(!e&&t.isServiceProject())&&!(!e&&t.type()===ke.projectTypes.ContentScripts)))}performSearch(e,t,i,s){this.stopSearch(),this._searchResultCandidates=[],this._searchResultCallback=i,this._searchFinishedCallback=s,this._searchConfig=e;const n=[],r=new o.CompositeProgress(t),a=r.createSubProgress(),c=new o.CompositeProgress(r.createSubProgress());for(const t of this._projects()){const i=t.uiSourceCodes().length,s=c.createSubProgress(i),o=this._projectFilesMatchingFileQuery(t,e),r=t.findFilesMatchingSearchRequest(e,o,s).then(this._processMatchingFilesForProject.bind(this,this._searchId,t,e,o));n.push(r)}Promise.all(n).then(this._processMatchingFiles.bind(this,this._searchId,a,this._searchFinishedCallback.bind(this,!0)))}_projectFilesMatchingFileQuery(e,t,i){const s=[],n=e.uiSourceCodes();for(let e=0;e<n.length;++e){const o=n[e];if(!o.contentType().isTextType())continue;const r=ue.PersistenceImpl.instance().binding(o);r&&r.network===o||(i&&!o.isDirty()||t.filePathMatchesFileQuery(o.fullDisplayName())&&s.push(o.url()))}return s.sort(String.naturalOrderComparator),s}_processMatchingFilesForProject(e,t,i,s,n){if(e!==this._searchId&&this._searchFinishedCallback)return void this._searchFinishedCallback(!1);n.sort(String.naturalOrderComparator),n=n.intersectOrdered(s,String.naturalOrderComparator);const o=this._projectFilesMatchingFileQuery(t,i,!0);n=n.mergeOrdered(o,String.naturalOrderComparator);const r=[];for(const e of n){const i=t.uiSourceCodeForURL(e);if(!i)continue;const s=ie.DefaultScriptMapping.scriptForUISourceCode(i);s&&!s.isAnonymousScript()||r.push(i)}r.sort(zt._filesComparator),this._searchResultCandidates=this._searchResultCandidates.mergeOrdered(r,zt._filesComparator)}_processMatchingFiles(e,t,i){if(e!==this._searchId&&this._searchFinishedCallback)return void this._searchFinishedCallback(!1);const s=this._searchResultCandidates;if(!s.length)return t.done(),void i();t.setTotalWork(s.length);let n=0;let o=0;for(let e=0;e<20&&e<s.length;++e)a.call(this);function r(e){e.isDirty()?c.call(this,e,e.workingCopy()):e.requestContent().then(t=>{c.call(this,e,t.content||"")})}function a(){if(n>=s.length)return o?void 0:(t.done(),void i());++o;const e=s[n++];setTimeout(r.bind(this,e),0)}function c(e,i){function s(e,t){return e.lineNumber-t.lineNumber}t.worked(1);let n=[];const r=this._searchConfig,c=r.queries();if(null!==i)for(let e=0;e<c.length;++e){const t=$e.performSearchInContent(i,c[e],!r.ignoreCase(),r.isRegex());n=n.mergeOrdered(t,s)}if(n&&this._searchResultCallback){const t=new qt(e,n);this._searchResultCallback(t)}--o,a.call(this)}}stopSearch(){++this._searchId}}class qt{constructor(e,t){this._uiSourceCode=e,this._searchMatches=t}label(){return this._uiSourceCode.displayName()}description(){return this._uiSourceCode.fullDisplayName()}matchesCount(){return this._searchMatches.length}matchLineContent(e){return this._searchMatches[e].lineContent}matchRevealable(e){const t=this._searchMatches[e];return this._uiSourceCode.uiLocation(t.lineNumber,void 0)}matchLabel(e){return this._searchMatches[e].lineNumber+1}}var Gt=Object.freeze({__proto__:null,SourcesSearchScope:zt,FileBasedSearchResult:qt});class Kt extends tt.SearchView{constructor(){super("sources")}static async openSearch(e,t){const i=y.ViewManager.instance().view("sources.search-sources-tab");(await y.ViewManager.instance().resolveLocation("drawer-view")).appendView(i),await y.ViewManager.instance().revealView(i);const s=await i.widget();return s.toggle(e,!!t),s}createScope(){return new zt}}var $t=Object.freeze({__proto__:null,SearchSourcesView:Kt,ActionDelegate:class{handleAction(e,t){return this._showSearch(),!0}_showSearch(){const e=P.InspectorView.instance().element.window().getSelection();let t="";return e&&e.rangeCount&&(t=e.toString().replace(/\r?\n.*/,"")),Kt.openSearch(t)}}});class Jt extends u.VBox{constructor(){super(!0),this.registerRequiredCSS("sources/navigatorView.css"),this._placeholder=null,this._scriptsTree=new M.TreeOutlineInShadow,this._scriptsTree.registerRequiredCSS("sources/navigatorTree.css"),this._scriptsTree.setComparator(Jt._treeElementsCompare),this._scriptsTree.setFocusable(!1),this.contentElement.appendChild(this._scriptsTree.element),this.setDefaultFocusedElement(this._scriptsTree.element),this._uiSourceCodeNodes=new Re,this._subfolderNodes=new Map,this._rootNode=new ei(this),this._rootNode.populate(),this._frameNodes=new Map,this.contentElement.addEventListener("contextmenu",this.handleContextMenu.bind(this),!1),F.ShortcutRegistry.instance().addShortcutListener(this.contentElement,{"sources.rename":this._renameShortcut.bind(this)}),this._navigatorGroupByFolderSetting=r.Settings.instance().moduleSetting("navigatorGroupByFolder"),this._navigatorGroupByFolderSetting.addChangeListener(this._groupingChanged.bind(this)),this._initGrouping(),ue.PersistenceImpl.instance().addEventListener(ue.Events.BindingCreated,this._onBindingChanged,this),ue.PersistenceImpl.instance().addEventListener(ue.Events.BindingRemoved,this._onBindingChanged,this),Se.TargetManager.instance().addEventListener(Se.Events.NameChanged,this._targetNameChanged,this),Se.TargetManager.instance().observeTargets(this),this._resetWorkspace(ke.WorkspaceImpl.instance()),this._workspace.uiSourceCodes().forEach(this._addUISourceCode.bind(this)),se.NetworkProjectManager.instance().addEventListener(se.Events.FrameAttributionAdded,this._frameAttributionAdded,this),se.NetworkProjectManager.instance().addEventListener(se.Events.FrameAttributionRemoved,this._frameAttributionRemoved,this)}static _treeElementOrder(e){if(e._boostOrder)return 0;if(!Jt._typeOrders){const e={},t=Qt;e[t.Root]=1,e[t.Domain]=10,e[t.FileSystemFolder]=1,e[t.NetworkFolder]=1,e[t.SourceMapFolder]=2,e[t.File]=10,e[t.Frame]=70,e[t.Worker]=90,e[t.FileSystem]=100,Jt._typeOrders=e}let t=Jt._typeOrders[e._nodeType];if(e._uiSourceCode){const i=e._uiSourceCode.contentType();i.isDocument()?t+=3:i.isScript()?t+=5:i.isStyleSheet()?t+=10:t+=15}return t}static appendSearchItem(t,i){let s=e.UIString("Search in folder");i&&i.trim()||(i="*",s=e.UIString("Search in all files")),t.viewSection().appendItem(s,(function(){Kt.openSearch("file:"+i.trim())}))}static _treeElementsCompare(e,t){const i=Jt._treeElementOrder(e),s=Jt._treeElementOrder(t);return i>s?1:i<s?-1:e.titleAsText().compareTo(t.titleAsText())}setPlaceholder(e){function t(){const t=this._scriptsTree.firstChild();t?e.hideWidget():e.showWidget(),this._scriptsTree.element.classList.toggle("hidden",!t)}console.assert(!this._placeholder,"A placeholder widget was already set"),this._placeholder=e,e.show(this.contentElement,this.contentElement.firstChild),t.call(this),this._scriptsTree.addEventListener(M.Events.ElementAttached,t.bind(this)),this._scriptsTree.addEventListener(M.Events.ElementsDetached,t.bind(this))}_onBindingChanged(e){const t=e.data,i=this._uiSourceCodeNodes.get(t.network);for(const e of i)e.updateTitle();const s=this._uiSourceCodeNodes.get(t.fileSystem);for(const e of s)e.updateTitle();const n=pe.FileSystemWorkspaceBinding.relativePath(t.fileSystem);let o="";for(let e=0;e<n.length-1;++e){o+=n[e];const i=this._folderNodeId(t.fileSystem.project(),null,null,t.fileSystem.origin(),o),s=this._subfolderNodes.get(i);s&&s.updateTitle(),o+="/"}const r=this._rootNode.child(t.fileSystem.project().id());r&&r.updateTitle()}focus(){this._scriptsTree.focus()}appendChild(e,t){this._scriptsTree.setFocusable(!0),e.appendChild(t)}removeChild(e,t){e.removeChild(t),0===this._scriptsTree.rootElement().childCount()&&this._scriptsTree.setFocusable(!1)}_resetWorkspace(e){this._workspace=e,this._workspace.addEventListener(ke.Events.UISourceCodeAdded,this._uiSourceCodeAdded,this),this._workspace.addEventListener(ke.Events.UISourceCodeRemoved,this._uiSourceCodeRemoved,this),this._workspace.addEventListener(ke.Events.ProjectAdded,e=>{const t=e.data;this._projectAdded(t),t.type()===ke.projectTypes.FileSystem&&this._computeUniqueFileSystemProjectNames()}),this._workspace.addEventListener(ke.Events.ProjectRemoved,e=>{const t=e.data;this._removeProject(t),t.type()===ke.projectTypes.FileSystem&&this._computeUniqueFileSystemProjectNames()}),this._workspace.projects().forEach(this._projectAdded.bind(this)),this._computeUniqueFileSystemProjectNames()}workspace(){return this._workspace}acceptProject(e){return!e.isServiceProject()}_frameAttributionAdded(e){const t=e.data.uiSourceCode;if(!this._acceptsUISourceCode(t))return;const i=e.data.frame;this._addUISourceCodeNode(t,i)}_frameAttributionRemoved(e){const t=e.data.uiSourceCode;if(!this._acceptsUISourceCode(t))return;const i=e.data.frame,s=Array.from(this._uiSourceCodeNodes.get(t)).find(e=>e.frame()===i);this._removeUISourceCodeNode(s)}_acceptsUISourceCode(e){return this.acceptProject(e.project())}_addUISourceCode(e){if(!this._acceptsUISourceCode(e))return;const t=se.NetworkProject.framesForUISourceCode(e);if(t.length)for(const i of t)this._addUISourceCodeNode(e,i);else this._addUISourceCodeNode(e,null);this.uiSourceCodeAdded(e)}_addUISourceCodeNode(e,t){const i=e.contentType().isFromSourceMap();let s;s=e.project().type()===ke.projectTypes.FileSystem?pe.FileSystemWorkspaceBinding.relativePath(e).slice(0,-1):a.ParsedURL.extractPath(e.url()).split("/").slice(1,-1);const n=e.project(),o=se.NetworkProject.targetForUISourceCode(e),r=this._folderNode(e,n,o,t,e.origin(),s,i),c=new ti(this,e,t);r.appendChild(c),this._uiSourceCodeNodes.set(e,c),this._selectDefaultTreeNode()}uiSourceCodeAdded(e){}_uiSourceCodeAdded(e){const t=e.data;this._addUISourceCode(t)}_uiSourceCodeRemoved(e){const t=e.data;this._removeUISourceCode(t)}tryAddProject(e){this._projectAdded(e),e.uiSourceCodes().forEach(this._addUISourceCode.bind(this))}_projectAdded(e){!this.acceptProject(e)||e.type()!==ke.projectTypes.FileSystem||Ze.isSnippetsProject(e)||this._rootNode.child(e.id())||(this._rootNode.appendChild(new si(this,e,e.id(),Qt.FileSystem,e.displayName())),this._selectDefaultTreeNode())}_selectDefaultTreeNode(){const e=this._rootNode.children();e.length&&!this._scriptsTree.selectedTreeElement&&e[0].treeNode().select(!0,!1)}_computeUniqueFileSystemProjectNames(){const e=this._workspace.projectsForType(ke.projectTypes.FileSystem);if(!e.length)return;const t=new ue.PathEncoder,i=e.map(e=>{const i=e;return Ae.reverse(t.encode(i.fileSystemPath()))}),s=new c.Trie;for(const e of i)s.add(e);for(let n=0;n<e.length;++n){const o=i[n],r=e[n];s.remove(o);const a=s.longestPrefix(o,!1);s.add(o);const c=o.substring(0,a.length+1),l=t.decode(Ae.reverse(c)),d=this._rootNode.child(r.id());d&&d.setTitle(l)}}_removeProject(e){const t=e.uiSourceCodes();for(let e=0;e<t.length;++e)this._removeUISourceCode(t[e]);if(e.type()!==ke.projectTypes.FileSystem)return;const i=this._rootNode.child(e.id());i&&this._rootNode.removeChild(i)}_folderNodeId(e,t,i,s,n){return(t?t.id():"")+":"+(e.type()===ke.projectTypes.FileSystem?e.id():"")+":"+(this._groupByFrame&&i?i.id:"")+":"+s+":"+n}_folderNode(e,t,i,s,n,o,r){if(Ze.isSnippetsUISourceCode(e))return this._rootNode;if(i&&!this._groupByFolder&&!r)return this._domainNode(e,t,i,s,n);const a=o.join("/"),c=this._folderNodeId(t,i,s,n,a);let l=this._subfolderNodes.get(c);if(l)return l;if(!o.length)return i?this._domainNode(e,t,i,s,n):this._rootNode.child(t.id());const d=this._folderNode(e,t,i,s,n,o.slice(0,-1),r);let h=r?Qt.SourceMapFolder:Qt.NetworkFolder;t.type()===ke.projectTypes.FileSystem&&(h=Qt.FileSystemFolder);const u=o[o.length-1];return l=new ii(this,t,c,h,a,u),this._subfolderNodes.set(c,l),d.appendChild(l),l}_domainNode(e,t,i,s,n){const o=this._frameNode(t,i,s);if(!this._groupByDomain)return o;let r=o.child(n);return r||(r=new si(this,t,n,Qt.Domain,this._computeProjectDisplayName(i,n)),s&&n===a.ParsedURL.extractOrigin(s.url)&&(r.treeNode()._boostOrder=!0),o.appendChild(r),r)}_frameNode(e,t,i){if(!this._groupByFrame||!i)return this._targetNode(e,t);let s=this._frameNodes.get(i);if(s)return s;s=new si(this,e,t.id()+":"+i.id,Qt.Frame,i.displayName()),s.setHoverCallback((function(e){if(e){const e=t.model(we.OverlayModel);e&&e.highlightFrame(i.id)}else we.OverlayModel.hideDOMNodeHighlight()})),this._frameNodes.set(i,s);const n=i.parentFrame();return this._frameNode(e,n?n.resourceTreeModel().target():t,n).appendChild(s),n||(s.treeNode()._boostOrder=!0,s.treeNode().expand()),s}_targetNode(e,t){if(t===Se.TargetManager.instance().mainTarget())return this._rootNode;let i=this._rootNode.child("target:"+t.id());return i||(i=new si(this,e,"target:"+t.id(),t.type()===Se.Type.Frame?Qt.Frame:Qt.Worker,t.name()),this._rootNode.appendChild(i)),i}_computeProjectDisplayName(t,i){const s=t.model(Ee.RuntimeModel),n=s?s.executionContexts():[];for(const e of n)if(e.name&&e.origin&&i.startsWith(e.origin))return e.name;if(!i)return e.UIString("(no domain)");const o=new a.ParsedURL(i);return(o.isValid?o.host+(o.port?":"+o.port:""):"")||i}revealUISourceCode(e,t){const i=this._uiSourceCodeNodes.get(e).firstValue();return i?(this._scriptsTree.selectedTreeElement&&this._scriptsTree.selectedTreeElement.deselect(),this._lastSelectedUISourceCode=e,i.reveal(t),i):null}_sourceSelected(e,t){this._lastSelectedUISourceCode=e,i.reveal(e,!t)}_removeUISourceCode(e){const t=this._uiSourceCodeNodes.get(e);for(const e of t)this._removeUISourceCodeNode(e)}_removeUISourceCodeNode(e){const t=e.uiSourceCode();this._uiSourceCodeNodes.delete(t,e);const i=t.project(),s=se.NetworkProject.targetForUISourceCode(t),n=e.frame();let o=e.parent;for(o.removeChild(e),e=o;e&&(o=e.parent,o&&e.isEmpty())&&(o!==this._rootNode||i.type()!==ke.projectTypes.FileSystem)&&(e instanceof si||e instanceof ii);){if(e._type===Qt.Frame){this._discardFrame(n);break}const r=this._folderNodeId(i,s,n,t.origin(),e._folderPath);this._subfolderNodes.delete(r),o.removeChild(e),e=o}}reset(){for(const e of this._uiSourceCodeNodes.valuesArray())e.dispose();this._scriptsTree.removeChildren(),this._scriptsTree.setFocusable(!1),this._uiSourceCodeNodes.clear(),this._subfolderNodes.clear(),this._frameNodes.clear(),this._rootNode.reset(),this._resetWorkspace(ke.WorkspaceImpl.instance())}handleContextMenu(e){}_renameShortcut(){const e=this._scriptsTree.selectedTreeElement&&this._scriptsTree.selectedTreeElement._node;return!!(e&&e._uiSourceCode&&e._uiSourceCode.canRename())&&(this.rename(e,!1),!0)}_handleContextMenuCreate(e,t,i){if(i){const e=pe.FileSystemWorkspaceBinding.relativePath(i);e.pop(),t=e.join("/")}this.create(e,t,i)}_handleContextMenuRename(e){this.rename(e,!1)}_handleContextMenuExclude(t,i){window.confirm(e.UIString("Are you sure you want to exclude this folder?"))&&(p.startBatchUpdate(),t.excludeFolder(pe.FileSystemWorkspaceBinding.completeURL(t,i)),p.endBatchUpdate())}_handleContextMenuDelete(t){window.confirm(e.UIString("Are you sure you want to delete this file?"))&&t.project().deleteFile(t)}handleFileContextMenu(t,i){const s=i.uiSourceCode(),n=new x.ContextMenu(t);n.appendApplicableItems(s);const o=s.project();o.type()===ke.projectTypes.FileSystem&&(n.editSection().appendItem(e.UIString("Rename…"),this._handleContextMenuRename.bind(this,i)),n.editSection().appendItem(e.UIString("Make a copy…"),this._handleContextMenuCreate.bind(this,o,"",s)),n.editSection().appendItem(e.UIString("Delete"),this._handleContextMenuDelete.bind(this,s))),n.show()}_handleDeleteOverrides(e){window.confirm(ls`Are you sure you want to delete all overrides contained in this folder?`)&&this._handleDeleteOverridesHelper(e)}_handleDeleteOverridesHelper(e){e._children.forEach(e=>{this._handleDeleteOverridesHelper(e)}),e instanceof ti&&e.uiSourceCode().project().deleteFile(e.uiSourceCode())}handleFolderContextMenu(t,i){const s=i._folderPath||"",n=i._project,o=new x.ContextMenu(t);if(Jt.appendSearchItem(o,s),n.type()===ke.projectTypes.FileSystem){const t=a.ParsedURL.urlToPlatformPath(pe.FileSystemWorkspaceBinding.completeURL(n,s),le.isWin());o.revealSection().appendItem(e.UIString("Open folder"),()=>ce.InspectorFrontendHostInstance.showItemInFolder(t)),n.canCreateFile()&&o.defaultSection().appendItem(e.UIString("New file"),this._handleContextMenuCreate.bind(this,n,s))}n.canExcludeFolder(s)&&o.defaultSection().appendItem(e.UIString("Exclude folder"),this._handleContextMenuExclude.bind(this,n,s)),n.type()===ke.projectTypes.FileSystem&&(o.defaultSection().appendAction("sources.add-folder-to-workspace",void 0,!0),i instanceof si&&o.defaultSection().appendItem(e.UIString("Remove folder from workspace"),(function(){window.confirm(e.UIString("Are you sure you want to remove this folder?"))&&n.remove()})),"overrides"===n._fileSystem._type&&o.defaultSection().appendItem(ls`Delete all overrides`,this._handleDeleteOverrides.bind(this,i))),o.show()}rename(e,t){const i=e.uiSourceCode();e.rename(function(s){if(!t)return;s?e._treeElement.listItemElement.hasFocus()&&this._sourceSelected(i,!0):i.remove()}.bind(this))}async create(e,t,i){let s="";i&&(s=(await i.requestContent()).content||"");const n=await e.createFile(t,null,s);if(!n)return;this._sourceSelected(n,!1);const o=this.revealUISourceCode(n,!0);o&&this.rename(o,!0)}_groupingChanged(){this.reset(),this._initGrouping(),this._workspace.uiSourceCodes().forEach(this._addUISourceCode.bind(this))}_initGrouping(){this._groupByFrame=!0,this._groupByDomain=this._navigatorGroupByFolderSetting.get(),this._groupByFolder=this._groupByDomain}_resetForTest(){this.reset(),this._workspace.uiSourceCodes().forEach(this._addUISourceCode.bind(this))}_discardFrame(e){const t=this._frameNodes.get(e);if(t){t.parent&&t.parent.removeChild(t),this._frameNodes.delete(e);for(const t of e.childFrames)this._discardFrame(t)}}targetAdded(e){}targetRemoved(e){const t=this._rootNode.child("target:"+e.id());t&&this._rootNode.removeChild(t)}_targetNameChanged(e){const t=e.data,i=this._rootNode.child("target:"+t.id());i&&i.setTitle(t.name())}}const Qt={Domain:"domain",File:"file",FileSystem:"fs",FileSystemFolder:"fs-folder",Frame:"frame",NetworkFolder:"nw-folder",Root:"root",SourceMapFolder:"sm-folder",Worker:"worker"};class Xt extends M.TreeElement{constructor(e,t,i,s){super("",!0),this.listItemElement.classList.add("navigator-"+t+"-tree-item","navigator-folder-tree-item"),w.setAccessibleName(this.listItemElement,`${i}, ${t}`),this._nodeType=t,this.title=i,this.tooltip=i,this._navigatorView=e,this._hoverCallback=s;let n="largeicon-navigator-folder";t===Qt.Domain?n="largeicon-navigator-domain":t===Qt.Frame?n="largeicon-navigator-frame":t===Qt.Worker&&(n="largeicon-navigator-worker"),this.setLeadingIcons([E.Icon.create(n,"icon")])}async onpopulate(){this._node.populate()}onattach(){this.collapse(),this._node.onattach(),this.listItemElement.addEventListener("contextmenu",this._handleContextMenuEvent.bind(this),!1),this.listItemElement.addEventListener("mousemove",this._mouseMove.bind(this),!1),this.listItemElement.addEventListener("mouseleave",this._mouseLeave.bind(this),!1)}setNode(e){this._node=e;const t=[];for(;e&&!e.isRoot();)t.push(e._title),e=e.parent;t.reverse(),this.tooltip=t.join("/"),w.setAccessibleName(this.listItemElement,`${this.title}, ${this._nodeType}`)}_handleContextMenuEvent(e){this._node&&(this.select(),this._navigatorView.handleFolderContextMenu(e,this._node))}_mouseMove(e){!this._hovered&&this._hoverCallback&&(this._hovered=!0,this._hoverCallback(!0))}_mouseLeave(e){this._hoverCallback&&(this._hovered=!1,this._hoverCallback(!1))}}class Yt extends M.TreeElement{constructor(e,t,i,s){super("",!1),this._nodeType=Qt.File,this._node=s,this.title=i,this.listItemElement.classList.add("navigator-"+t.contentType().name()+"-tree-item","navigator-file-tree-item"),this.tooltip=t.url(),w.setAccessibleName(this.listItemElement,`${t.name()}, ${this._nodeType}`),l.fireEvent("source-tree-file-added",t.fullDisplayName()),this._navigatorView=e,this._uiSourceCode=t,this.updateIcon()}updateIcon(){const e=ue.PersistenceImpl.instance().binding(this._uiSourceCode);if(e){const t=document.createElement("span");t.classList.add("icon-stack");let i="largeicon-navigator-file-sync";Ze.isSnippetsUISourceCode(e.fileSystem)&&(i="largeicon-navigator-snippet");const s=E.Icon.create(i,"icon"),n=E.Icon.create("badge-navigator-file-sync","icon-badge");_e.NetworkPersistenceManager.instance().project()===e.fileSystem.project()&&(n.style.filter="hue-rotate(160deg)"),t.appendChild(s),t.appendChild(n),t.title=me.PersistenceUtils.tooltipForUISourceCode(this._uiSourceCode),this.setLeadingIcons([t])}else{let e="largeicon-navigator-file";Ze.isSnippetsUISourceCode(this._uiSourceCode)&&(e="largeicon-navigator-snippet");const t=E.Icon.create(e,"icon");this.setLeadingIcons([t])}}get uiSourceCode(){return this._uiSourceCode}onattach(){this.listItemElement.draggable=!0,this.listItemElement.addEventListener("click",this._onclick.bind(this),!1),this.listItemElement.addEventListener("contextmenu",this._handleContextMenuEvent.bind(this),!1),this.listItemElement.addEventListener("dragstart",this._ondragstart.bind(this),!1)}_shouldRenameOnMouseDown(){if(!this._uiSourceCode.canRename())return!1;return this===this.treeOutline.selectedTreeElement&&this.treeOutline.element.hasFocus()&&!p.isBeingEdited(this.treeOutline.element)}selectOnMouseDown(e){1===e.which&&this._shouldRenameOnMouseDown()?setTimeout(function(){this._shouldRenameOnMouseDown()&&this._navigatorView.rename(this._node,!1)}.bind(this),300):super.selectOnMouseDown(e)}_ondragstart(e){e.dataTransfer.setData("text/plain",this._uiSourceCode.url()),e.dataTransfer.effectAllowed="copy"}onspace(){return this._navigatorView._sourceSelected(this.uiSourceCode,!0),!0}_onclick(e){this._navigatorView._sourceSelected(this.uiSourceCode,!1)}ondblclick(e){const t=1===e.button;return this._navigatorView._sourceSelected(this.uiSourceCode,!t),!1}onenter(){return this._navigatorView._sourceSelected(this.uiSourceCode,!0),!0}ondelete(){return!0}_handleContextMenuEvent(e){this.select(),this._navigatorView.handleFileContextMenu(e,this._node)}}class Zt{constructor(e,t,i){this.id=t,this._navigatorView=e,this._type=i,this._children=new Map}treeNode(){throw"Not implemented"}dispose(){}isRoot(){return!1}hasChildren(){return!0}onattach(){}setTitle(e){throw"Not implemented"}populate(){this.isPopulated()||(this.parent&&this.parent.populate(),this._populated=!0,this.wasPopulated())}wasPopulated(){const e=this.children();for(let t=0;t<e.length;++t)this._navigatorView.appendChild(this.treeNode(),e[t].treeNode())}didAddChild(e){this.isPopulated()&&this._navigatorView.appendChild(this.treeNode(),e.treeNode())}willRemoveChild(e){this.isPopulated()&&this._navigatorView.removeChild(this.treeNode(),e.treeNode())}isPopulated(){return this._populated}isEmpty(){return!this._children.size}children(){return[...this._children.values()]}child(e){return this._children.get(e)||null}appendChild(e){this._children.set(e.id,e),e.parent=this,this.didAddChild(e)}removeChild(e){this.willRemoveChild(e),this._children.delete(e.id),delete e.parent,e.dispose()}reset(){this._children.clear()}}class ei extends Zt{constructor(e){super(e,"",Qt.Root)}isRoot(){return!0}treeNode(){return this._navigatorView._scriptsTree.rootElement()}}class ti extends Zt{constructor(e,t,i){super(e,t.project().id()+":"+t.url(),Qt.File),this._uiSourceCode=t,this._treeElement=null,this._eventListeners=[],this._frame=i}frame(){return this._frame}uiSourceCode(){return this._uiSourceCode}treeNode(){if(this._treeElement)return this._treeElement;this._treeElement=new Yt(this._navigatorView,this._uiSourceCode,"",this),this.updateTitle();const e=this.updateTitle.bind(this,void 0);return this._eventListeners=[this._uiSourceCode.addEventListener(Ie.Events.TitleChanged,e),this._uiSourceCode.addEventListener(Ie.Events.WorkingCopyChanged,e),this._uiSourceCode.addEventListener(Ie.Events.WorkingCopyCommitted,e)],this._treeElement}updateTitle(t){if(!this._treeElement)return;let i=this._uiSourceCode.displayName();!t&&this._uiSourceCode.isDirty()&&(i="*"+i),this._treeElement.title=i,this._treeElement.updateIcon();let s=this._uiSourceCode.url();this._uiSourceCode.contentType().isFromSourceMap()&&(s=e.UIString("%s (from source map)",this._uiSourceCode.displayName())),this._treeElement.tooltip=s}hasChildren(){return!1}dispose(){l.EventTarget.removeEventListeners(this._eventListeners)}reveal(e){this.parent.populate(),this.parent.treeNode().expand(),this._treeElement.reveal(!0),e&&this._treeElement.select(!0)}rename(e){if(!this._treeElement)return;this._treeElement.listItemElement.focus();const t=this._treeElement.treeOutline.element;function i(i){if(!i)return p.markBeingEdited(t,!1),this.updateTitle(),void this.rename(e);s.call(this,!0)}function s(i){p.markBeingEdited(t,!1),this.updateTitle(),e&&e(i)}p.markBeingEdited(t,!0),this.updateTitle(!0),this._treeElement.startEditingTitle(new D.Config(function(e,t,n){if(t!==n)return this._treeElement.title=t,void this._uiSourceCode.rename(t).then(i.bind(this));s.call(this,!0)}.bind(this),s.bind(this,!1)))}}class ii extends Zt{constructor(e,t,i,s,n,o){super(e,i,s),this._project=t,this._folderPath=n,this._title=o}treeNode(){return this._treeElement||(this._treeElement=this._createTreeElement(this._title,this),this.updateTitle()),this._treeElement}updateTitle(){if(!this._treeElement||this._project.type()!==ke.projectTypes.FileSystem)return;const e=pe.FileSystemWorkspaceBinding.fileSystemPath(this._project.id())+"/"+this._folderPath,t=ue.PersistenceImpl.instance().filePathHasBindings(e);this._treeElement.listItemElement.classList.toggle("has-mapped-files",t)}_createTreeElement(e,t){if(this._project.type()!==ke.projectTypes.FileSystem)try{e=decodeURI(e)}catch(e){}const i=new Xt(this._navigatorView,this._type,e);return i.setNode(t),i}wasPopulated(){this._treeElement&&this._treeElement._node===this&&this._addChildrenRecursive()}_addChildrenRecursive(){const e=this.children();for(let t=0;t<e.length;++t){const i=e[t];this.didAddChild(i),i instanceof ii&&i._addChildrenRecursive()}}_shouldMerge(e){return this._type!==Qt.Domain&&e instanceof ii}didAddChild(e){function t(e){return e._title}if(!this._treeElement)return;let i,s=this.children();if(1===s.length&&this._shouldMerge(e))return e._isMerged=!0,this._treeElement.title=this._treeElement.title+"/"+e._title,e._treeElement=this._treeElement,void this._treeElement.setNode(e);if(2===s.length&&(i=s[0]!==e?s[0]:s[1]),i&&i._isMerged){delete i._isMerged;const e=[];e.push(this);let n=this;for(;n._isMerged;)n=n.parent,e.push(n);e.reverse();const o=e.map(t).join("/"),r=[];n=i;do{r.push(n),s=n.children(),n=1===s.length?s[0]:null}while(n&&n._isMerged);if(!this.isPopulated()){this._treeElement.title=o,this._treeElement.setNode(this);for(let e=0;e<r.length;++e)delete r[e]._treeElement,delete r[e]._isMerged;return}const a=this._treeElement,c=this._createTreeElement(o,this);for(let t=0;t<e.length;++t)e[t]._treeElement=c;this._navigatorView.appendChild(a.parent,c),a.setNode(r[r.length-1]),a.title=r.map(t).join("/"),this._navigatorView.removeChild(a.parent,a),this._navigatorView.appendChild(this._treeElement,a),a.expanded&&c.expand()}this.isPopulated()&&this._navigatorView.appendChild(this._treeElement,e.treeNode())}willRemoveChild(e){!e._isMerged&&this.isPopulated()&&this._navigatorView.removeChild(this._treeElement,e._treeElement)}}class si extends Zt{constructor(e,t,i,s,n){super(e,i,s),this._project=t,this._title=n,this.populate()}setHoverCallback(e){this._hoverCallback=e}treeNode(){return this._treeElement||(this._treeElement=new Xt(this._navigatorView,this._type,this._title,this._hoverCallback),this._treeElement.setNode(this)),this._treeElement}onattach(){this.updateTitle()}updateTitle(){if(!this._treeElement||this._project.type()!==ke.projectTypes.FileSystem)return;const e=pe.FileSystemWorkspaceBinding.fileSystemPath(this._project.id()),t=this._treeElement.listItemElement.classList.contains("has-mapped-files"),i=ue.PersistenceImpl.instance().filePathHasBindings(e);t!==i&&(this._treeElement.listItemElement.classList.toggle("has-mapped-files",i),this._treeElement.childrenListElement.hasFocus()||(i?this._treeElement.expand():this._treeElement.collapse()))}setTitle(e){this._title=e,this._treeElement&&(this._treeElement.title=this._title)}}var ni=Object.freeze({__proto__:null,NavigatorView:Jt,Types:Qt,NavigatorFolderTreeElement:Xt,NavigatorSourceTreeElement:Yt,NavigatorTreeNode:Zt,NavigatorRootTreeNode:ei,NavigatorUISourceCodeTreeNode:ti,NavigatorFolderTreeNode:ii,NavigatorGroupTreeNode:si});class oi{constructor(e){this._entries=[],this._activeEntryIndex=-1,this._coalescingReadonly=0,this._historyDepth=e}readOnlyLock(){++this._coalescingReadonly}releaseReadOnlyLock(){--this._coalescingReadonly}readOnly(){return!!this._coalescingReadonly}filterOut(e){if(this.readOnly())return;const t=[];let i=0;for(let s=0;s<this._entries.length;++s)e(this._entries[s])?s<=this._activeEntryIndex&&++i:t.push(this._entries[s]);this._entries=t,this._activeEntryIndex=Math.max(0,this._activeEntryIndex-i)}empty(){return!this._entries.length}active(){return this.empty()?null:this._entries[this._activeEntryIndex]}push(e){this.readOnly()||(this.empty()||this._entries.splice(this._activeEntryIndex+1),this._entries.push(e),this._entries.length>this._historyDepth&&this._entries.shift(),this._activeEntryIndex=this._entries.length-1)}rollback(){if(this.empty())return!1;let e=this._activeEntryIndex-1;for(;e>=0&&!this._entries[e].valid();)--e;return!(e<0)&&(this.readOnlyLock(),this._entries[e].reveal(),this.releaseReadOnlyLock(),this._activeEntryIndex=e,!0)}rollover(){let e=this._activeEntryIndex+1;for(;e<this._entries.length&&!this._entries[e].valid();)++e;return!(e>=this._entries.length)&&(this.readOnlyLock(),this._entries[e].reveal(),this.releaseReadOnlyLock(),this._activeEntryIndex=e,!0)}}var ri=Object.freeze({__proto__:null,HistoryEntry:class{valid(){throw new Error("not implemented")}reveal(){}},SimpleHistoryManager:oi});class ai{constructor(e,t){this._sourcesView=e,this._historyManager=new oi(ci),this._currentSourceFrameCallback=t}trackSourceFrameCursorJumps(e){e.textEditor.addEventListener(We.Events.JumpHappened,this._onJumpHappened.bind(this))}_onJumpHappened(e){e.data.from&&this._updateActiveState(e.data.from),e.data.to&&this._pushActiveState(e.data.to)}rollback(){this._historyManager.rollback()}rollover(){this._historyManager.rollover()}updateCurrentState(){const e=this._currentSourceFrameCallback();e&&this._updateActiveState(e.textEditor.selection())}pushNewState(){const e=this._currentSourceFrameCallback();e&&this._pushActiveState(e.textEditor.selection())}_updateActiveState(e){const t=this._historyManager.active();if(!t)return;const i=this._currentSourceFrameCallback();if(!i)return;const s=new li(this._sourcesView,this,i,e);t.merge(s)}_pushActiveState(e){const t=this._currentSourceFrameCallback();if(!t)return;const i=new li(this._sourcesView,this,t,e);this._historyManager.push(i)}removeHistoryForSourceCode(e){this._historyManager.filterOut(t=>{const i=t;return i._projectId===e.project().id()&&i._url===e.url()})}}const ci=20;class li{constructor(e,t,i,s){this._sourcesView=e,this._editingLocationManager=t;const n=i.uiSourceCode();this._projectId=n.project().id(),this._url=n.url();const o=this._positionFromSelection(s);this._positionHandle=i.textEditor.textEditorPositionHandle(o.lineNumber,o.columnNumber)}merge(e){this._projectId===e._projectId&&this._url===e._url&&(this._positionHandle=e._positionHandle)}_positionFromSelection(e){return{lineNumber:e.endLine,columnNumber:e.endColumn}}valid(){const e=this._positionHandle.resolve(),t=ke.WorkspaceImpl.instance().uiSourceCode(this._projectId,this._url);return!(!e||!t)}reveal(){const e=this._positionHandle.resolve(),t=ke.WorkspaceImpl.instance().uiSourceCode(this._projectId,this._url);e&&t&&(this._editingLocationManager.updateCurrentState(),this._sourcesView.showSourceLocation(t,e.lineNumber,e.columnNumber))}}var di=Object.freeze({__proto__:null,EditingLocationHistoryManager:ai,HistoryDepth:ci,EditingLocationHistoryEntry:li});class hi extends ft{constructor(e,t){super(),this._textEditor=e,this._uiSourceCode=t,this._decorations=[],this._textEditor.installGutter(pi,!0),this._workspaceDiff=nt.workspaceDiff(),this._workspaceDiff.subscribeToDiffChange(this._uiSourceCode,this._update,this),this._update()}static accepts(e){return e.project().type()===ke.projectTypes.Network}_updateDecorations(e,t){this._textEditor.operation((function(){for(const t of e)t.remove();for(const e of t)e.install()}))}_update(){this._uiSourceCode?this._workspaceDiff.requestDiff(this._uiSourceCode).then(this._innerUpdate.bind(this)):this._innerUpdate(null)}_innerUpdate(e){if(!e)return this._updateDecorations(this._decorations,[]),void(this._decorations=[]);const t=He.SourceCodeDiff.computeDiff(e),i=new Map;for(let e=0;e<t.length;++e){const s=t[e];for(let e=s.from;e<s.to;++e)i.set(e,{lineNumber:e,type:s.type})}const s=this._calculateDecorationsDiff(i),n=s.added.map(e=>new ui(this._textEditor,e.lineNumber,e.type));this._decorations=s.equal.concat(n),this._updateDecorations(s.removed,n),this._decorationsSetForTest(i)}_decorationsByLine(){const e=new Map;for(const t of this._decorations){const i=t.lineNumber();-1!==i&&e.set(i,t)}return e}_calculateDecorationsDiff(e){const t=this._decorationsByLine(),i=[...t.keys()],s=[...e.keys()];i.sort((e,t)=>e-t),s.sort((e,t)=>e-t);const n=[],o=[],r=[];let a=0,c=0;for(;a<i.length&&c<s.length;){const l=i[a],d=s[c],h=t.get(l),u=e.get(d);l===d&&h.type===u.type?(r.push(h),++a,++c):l<=d?(n.push(h),++a):(o.push(u),++c)}for(;a<i.length;){const e=i[a++];n.push(t.get(e))}for(;c<s.length;){const t=s[c++];o.push(e.get(t))}return{added:o,removed:n,equal:r}}_decorationsSetForTest(e){}async populateLineGutterContextMenu(e,t){hi._appendRevealDiffContextMenu(e,this._uiSourceCode)}async populateTextAreaContextMenu(e,t,i){hi._appendRevealDiffContextMenu(e,this._uiSourceCode)}static _appendRevealDiffContextMenu(e,t){nt.workspaceDiff().isUISourceCodeModified(t)&&e.revealSection().appendItem(ls`Local Modifications...`,()=>{i.reveal(new nt.DiffUILocation(t))})}dispose(){for(const e of this._decorations)e.remove();nt.workspaceDiff().unsubscribeFromDiffChange(this._uiSourceCode,this._update,this)}}class ui{constructor(e,t,i){this._textEditor=e,this._position=this._textEditor.textEditorPositionHandle(t,0),this._className="",i===He.EditType.Insert?this._className="diff-entry-insert":i===He.EditType.Delete?this._className="diff-entry-delete":i===He.EditType.Modify&&(this._className="diff-entry-modify"),this.type=i}lineNumber(){const e=this._position.resolve();return e?e.lineNumber:-1}install(){const e=this._position.resolve();if(!e)return;const t=document.createElement("div");t.classList.add("diff-marker"),t.textContent=" ",this._textEditor.setGutterDecoration(e.lineNumber,pi,t),this._textEditor.toggleLineClass(e.lineNumber,this._className,!0)}remove(){const e=this._position.resolve();e&&(this._textEditor.setGutterDecoration(e.lineNumber,pi,null),this._textEditor.toggleLineClass(e.lineNumber,this._className,!1))}}const pi="CodeMirror-gutter-diff";var _i=Object.freeze({__proto__:null,GutterDiffPlugin:hi,GutterDecoration:ui,DiffGutterType:pi,ContextMenuProvider:class{appendApplicableItems(e,t,i){let s=i;const n=ue.PersistenceImpl.instance().binding(s);n&&(s=n.network),hi._appendRevealDiffContextMenu(t,s)}}});class mi extends ft{constructor(e,t){super(),this._textEditor=e,this._uiSourceCode=t,this._compiling=!1,this._recompileScheduled=!1,this._timeout=null,this._message=null,this._disposed=!1,this._textEditor.addEventListener(b.Events.TextChanged,this._scheduleCompile,this),(this._uiSourceCode.hasCommits()||this._uiSourceCode.isDirty())&&this._scheduleCompile()}static accepts(e){if("js"===e.extension())return!0;if(Ze.isSnippetsUISourceCode(e))return!0;for(const t of Se.TargetManager.instance().models(be.DebuggerModel))if(te.DebuggerWorkspaceBinding.instance().scriptFile(e,t))return!0;return!1}_scheduleCompile(){this._compiling?this._recompileScheduled=!0:(this._timeout&&clearTimeout(this._timeout),this._timeout=setTimeout(this._compile.bind(this),gi))}_findRuntimeModel(){const e=Se.TargetManager.instance().models(be.DebuggerModel);for(let t=0;t<e.length;++t){if(te.DebuggerWorkspaceBinding.instance().scriptFile(this._uiSourceCode,e[t]))return e[t].runtimeModel()}const t=Se.TargetManager.instance().mainTarget();return t?t.model(Ee.RuntimeModel):null}async _compile(){const e=this._findRuntimeModel();if(!e)return;const t=v.Context.instance().flavor(Ee.ExecutionContext);if(!t)return;const i=this._textEditor.text();if(i.length>102400)return;this._compiling=!0;const s=await e.compileScript(i,"",!1,t.id);if(this._compiling=!1,this._recompileScheduled)return this._recompileScheduled=!1,void this._scheduleCompile();if(this._message&&this._uiSourceCode.removeMessage(this._message),this._disposed||!s||!s.exceptionDetails)return;const n=s.exceptionDetails,o=Ee.RuntimeModel.simpleTextFromException(n);this._message=this._uiSourceCode.addLineMessage(Ie.Message.Level.Error,o,n.lineNumber,n.columnNumber),this._compilationFinishedForTest()}_compilationFinishedForTest(){}dispose(){this._textEditor.removeEventListener(b.Events.TextChanged,this._scheduleCompile,this),this._message&&this._uiSourceCode.removeMessage(this._message),this._disposed=!0,this._timeout&&clearTimeout(this._timeout)}}const gi=1e3;var bi=Object.freeze({__proto__:null,JavaScriptCompilerPlugin:mi,CompileDelay:gi});class Si extends ft{constructor(e,t){super(),this._textEditor=e,this._uiSourceCode=t}static accepts(e){return e.contentType().hasScripts()||!!Si._script(e)}async rightToolbarItems(){const e=ne.CompilerScriptMapping.uiSourceCodeOrigin(this._uiSourceCode);if(e){const t=p.formatLocalized("(source mapped from %s)",[ot.Linkifier.linkifyURL(e)]);return[new g.ToolbarItem(t)]}const t=oe.DebuggerLanguagePluginManager.uiSourceCodeOriginScript(this._uiSourceCode);if(t&&t.hasSourceURL){const e=p.formatLocalized("(provided via debug info by %s)",[ot.Linkifier.linkifyURL(t.sourceURL)]);return[new g.ToolbarItem(e)]}const i=await Si._script(this._uiSourceCode);if(!i||!i.originStackTrace)return[];const s=Ci.linkifyStackTraceTopFrame(i.debuggerModel.target(),i.originStackTrace);return[new g.ToolbarItem(s)]}static async _script(e){const t=await te.DebuggerWorkspaceBinding.instance().uiLocationToRawLocations(e,0,0);for(const e of t){const t=e.script();if(t&&t.originStackTrace)return t}return null}}const Ci=new ot.Linkifier;var fi=Object.freeze({__proto__:null,ScriptOriginPlugin:Si,linkifier:Ci});class vi extends ft{constructor(e,t){super(),this._textEditor=e,this._uiSourceCode=t}static accepts(e){return Ze.isSnippetsUISourceCode(e)}async rightToolbarItems(){const t=g.Toolbar.createActionButtonForId("debugger.run-snippet");return t.setText(le.isMac()?e.UIString("⌘+Enter"):e.UIString("Ctrl+Enter")),[t]}}var wi=Object.freeze({__proto__:null,SnippetsPlugin:vi});class Ei extends ze.SourceFrameImpl{constructor(e){super((function(){if(e.isDirty())return Promise.resolve({content:e.workingCopy(),isEncoded:!1});return e.requestContent()})),this._uiSourceCode=e,Y.experiments.isEnabled("sourceDiff")&&(this._diff=new He.SourceCodeDiff(this.textEditor)),this._muteSourceCodeEvents=!1,this._isSettingContent=!1,this._persistenceBinding=ue.PersistenceImpl.instance().binding(e),this._rowMessageBuckets=new Map,this._typeDecorationsPending=new Set,this._uiSourceCodeEventListeners=[],this._messageAndDecorationListeners=[],this._boundOnBindingChanged=this._onBindingChanged.bind(this),this.textEditor.addEventListener(We.Events.EditorBlurred,()=>v.Context.instance().setFlavor(Ei,null)),this.textEditor.addEventListener(We.Events.EditorFocused,()=>v.Context.instance().setFlavor(Ei,this)),r.Settings.instance().moduleSetting("persistenceNetworkOverridesEnabled").addChangeListener(this._onNetworkPersistenceChanged,this),this._errorPopoverHelper=new B.PopoverHelper(this.element,this._getErrorPopoverContent.bind(this)),this._errorPopoverHelper.setHasPadding(!0),this._errorPopoverHelper.setTimeout(100,100),this._plugins=[],this._initializeUISourceCode()}_installMessageAndDecorationListeners(){if(this._persistenceBinding){const e=this._persistenceBinding.network,t=this._persistenceBinding.fileSystem;this._messageAndDecorationListeners=[e.addEventListener(Ie.Events.MessageAdded,this._onMessageAdded,this),e.addEventListener(Ie.Events.MessageRemoved,this._onMessageRemoved,this),e.addEventListener(Ie.Events.LineDecorationAdded,this._onLineDecorationAdded,this),e.addEventListener(Ie.Events.LineDecorationRemoved,this._onLineDecorationRemoved,this),t.addEventListener(Ie.Events.MessageAdded,this._onMessageAdded,this),t.addEventListener(Ie.Events.MessageRemoved,this._onMessageRemoved,this)]}else this._messageAndDecorationListeners=[this._uiSourceCode.addEventListener(Ie.Events.MessageAdded,this._onMessageAdded,this),this._uiSourceCode.addEventListener(Ie.Events.MessageRemoved,this._onMessageRemoved,this),this._uiSourceCode.addEventListener(Ie.Events.LineDecorationAdded,this._onLineDecorationAdded,this),this._uiSourceCode.addEventListener(Ie.Events.LineDecorationRemoved,this._onLineDecorationRemoved,this)]}uiSourceCode(){return this._uiSourceCode}setUISourceCode(e){this._unloadUISourceCode(),this._uiSourceCode=e,e.contentLoaded()?e.workingCopy()!==this.textEditor.text()&&this._innerSetContent(e.workingCopy()):e.requestContent().then(()=>{this._uiSourceCode===e&&e.workingCopy()!==this.textEditor.text()&&this._innerSetContent(e.workingCopy())}),this._initializeUISourceCode()}_unloadUISourceCode(){this._disposePlugins();for(const e of this._allMessages())this._removeMessageFromSource(e);l.EventTarget.removeEventListeners(this._messageAndDecorationListeners),l.EventTarget.removeEventListeners(this._uiSourceCodeEventListeners),this._uiSourceCode.removeWorkingCopyGetter(),ue.PersistenceImpl.instance().unsubscribeFromBindingEvent(this._uiSourceCode,this._boundOnBindingChanged)}_initializeUISourceCode(){this._uiSourceCodeEventListeners=[this._uiSourceCode.addEventListener(Ie.Events.WorkingCopyChanged,this._onWorkingCopyChanged,this),this._uiSourceCode.addEventListener(Ie.Events.WorkingCopyCommitted,this._onWorkingCopyCommitted,this),this._uiSourceCode.addEventListener(Ie.Events.TitleChanged,this._refreshHighlighterType,this)],ue.PersistenceImpl.instance().subscribeForBindingEvent(this._uiSourceCode,this._boundOnBindingChanged);for(const e of this._allMessages())this._addMessageToSource(e);if(this._installMessageAndDecorationListeners(),this._updateStyle(),this._decorateAllTypes(),this._refreshHighlighterType(),Y.experiments.isEnabled("sourcesPrettyPrint")){const e=new Set(["text/html","text/css","text/javascript"]);this.setCanPrettyPrint(e.has(this.highlighterType()),!0)}this._ensurePluginsLoaded()}wasShown(){super.wasShown(),window.setTimeout(()=>this._updateBucketDecorations(),0),this.setEditable(this._canEditSource());for(const e of this._plugins)e.wasShown()}willHide(){for(const e of this._plugins)e.willHide();super.willHide(),v.Context.instance().setFlavor(Ei,null),this._uiSourceCode.removeWorkingCopyGetter()}_refreshHighlighterType(){const e=ue.PersistenceImpl.instance().binding(this._uiSourceCode),t=e?e.network.mimeType():this._uiSourceCode.mimeType();this.highlighterType()!==t&&(this._disposePlugins(),this.setHighlighterType(t),this._ensurePluginsLoaded())}_canEditSource(){return!this.hasLoadError()&&(!this._uiSourceCode.editDisabled()&&("application/wasm"!==this._uiSourceCode.mimeType()&&(!!ue.PersistenceImpl.instance().binding(this._uiSourceCode)||(!!this._uiSourceCode.project().canSetFileContent()||!this._uiSourceCode.project().isServiceProject()&&(!(this._uiSourceCode.project().type()!==ke.projectTypes.Network||!_e.NetworkPersistenceManager.instance().active())||(!this.pretty||!this._uiSourceCode.contentType().hasScripts())&&this._uiSourceCode.contentType()!==d.resourceTypes.Document)))))}_onNetworkPersistenceChanged(){this.setEditable(this._canEditSource())}commitEditing(){this._uiSourceCode.isDirty()&&(this._muteSourceCodeEvents=!0,this._uiSourceCode.commitWorkingCopy(),this._muteSourceCodeEvents=!1)}setContent(e,t){this._disposePlugins(),this._rowMessageBuckets.clear(),super.setContent(e,t);for(const e of this._allMessages())this._addMessageToSource(e);this._decorateAllTypes(),this._ensurePluginsLoaded()}_allMessages(){if(this._persistenceBinding){const e=this._persistenceBinding.network.messages();return je.addAll(e,this._persistenceBinding.fileSystem.messages()),e}return this._uiSourceCode.messages()}onTextChanged(e,t){const i=this.pretty;super.onTextChanged(e,t),this._errorPopoverHelper.hidePopover(),this._isSettingContent||(Ji.instance().updateLastModificationTime(),this._muteSourceCodeEvents=!0,this.isClean()?this._uiSourceCode.resetWorkingCopy():this._uiSourceCode.setWorkingCopyGetter(this.textEditor.text.bind(this.textEditor)),this._muteSourceCodeEvents=!1,i!==this.pretty&&(this._updateStyle(),this._disposePlugins(),this._ensurePluginsLoaded()))}_onWorkingCopyChanged(e){this._muteSourceCodeEvents||this._innerSetContent(this._uiSourceCode.workingCopy())}_onWorkingCopyCommitted(e){this._muteSourceCodeEvents||this._innerSetContent(this._uiSourceCode.workingCopy()),this.contentCommitted(),this._updateStyle()}_ensurePluginsLoaded(){if(!this.loaded||this._plugins.length)return;const e=ue.PersistenceImpl.instance().binding(this._uiSourceCode),t=e?e.network:this._uiSourceCode;es.accepts(t)&&this._plugins.push(new es(this.textEditor,t,this)),xt.accepts(t)&&this._plugins.push(new xt(this.textEditor)),!this.pretty&&mi.accepts(t)&&this._plugins.push(new mi(this.textEditor,t)),vi.accepts(t)&&this._plugins.push(new vi(this.textEditor,t)),Si.accepts(t)&&this._plugins.push(new Si(this.textEditor,t)),!this.pretty&&Y.experiments.isEnabled("sourceDiff")&&hi.accepts(t)&&this._plugins.push(new hi(this.textEditor,t)),wt.accepts(t)&&this._plugins.push(new wt(this.textEditor,t)),this.dispatchEventToListeners(Mi.ToolbarItemsChanged);for(const e of this._plugins)e.wasShown()}_disposePlugins(){this.textEditor.operation(()=>{for(const e of this._plugins)e.dispose()}),this._plugins=[]}_onBindingChanged(){const e=ue.PersistenceImpl.instance().binding(this._uiSourceCode);e!==this._persistenceBinding&&(this._unloadUISourceCode(),this._persistenceBinding=e,this._initializeUISourceCode())}_updateStyle(){this.setEditable(this._canEditSource())}_innerSetContent(e){this._isSettingContent=!0;const t=this.textEditor.text();this._diff&&this._diff.highlightModifiedLines(t,e),t!==e&&this.setContent(e,null),this._isSettingContent=!1}async populateTextAreaContextMenu(e,t,i){await super.populateTextAreaContextMenu(e,t,i),e.appendApplicableItems(this._uiSourceCode);const s=this.editorLocationToUILocation(t,i);e.appendApplicableItems(new Ie.UILocation(this._uiSourceCode,s.lineNumber,s.columnNumber)),e.appendApplicableItems(this);for(const s of this._plugins)await s.populateTextAreaContextMenu(e,t,i)}dispose(){this._errorPopoverHelper.dispose(),this._unloadUISourceCode(),this.textEditor.dispose(),this.detach(),r.Settings.instance().moduleSetting("persistenceNetworkOverridesEnabled").removeChangeListener(this._onNetworkPersistenceChanged,this)}_onMessageAdded(e){const t=e.data;this._addMessageToSource(t)}_getClampedEditorLineNumberForMessage(e){let{lineNumber:t}=this.uiLocationToEditorLocation(e.lineNumber(),e.columnNumber());return t>=this.textEditor.linesCount&&(t=this.textEditor.linesCount-1),t<0&&(t=0),t}_addMessageToSource(e){if(!this.loaded)return;const t=this._getClampedEditorLineNumberForMessage(e);let i=this._rowMessageBuckets.get(t);i||(i=new Ti(this,this.textEditor,t),this._rowMessageBuckets.set(t,i)),i.addMessage(e)}_onMessageRemoved(e){const t=e.data;this._removeMessageFromSource(t)}_removeMessageFromSource(e){if(!this.loaded)return;const t=this._getClampedEditorLineNumberForMessage(e),i=this._rowMessageBuckets.get(t);i&&(i.removeMessage(e),i.uniqueMessagesCount()||(i.detachFromEditor(),this._rowMessageBuckets.delete(t)))}_getErrorPopoverContent(e){const t=e,i=t.target,s=i.enclosingNodeOrSelfWithClass("text-editor-line-decoration-icon")||i.enclosingNodeOrSelfWithClass("text-editor-line-decoration-wave");if(!s)return null;return{box:s.enclosingNodeOrSelfWithClass("text-editor-line-decoration-icon")?s.boxInWindow():new AnchorBox(t.clientX,t.clientY,1,1),hide(){},show:e=>{const t=Li.get(s.enclosingNodeOrSelfWithClass("text-editor-line-decoration"));if(t){const i=t.messagesDescription();e.contentElement.appendChild(i)}return Promise.resolve(!0)}}}_updateBucketDecorations(){for(const e of this._rowMessageBuckets.values())e._updateDecoration()}_onLineDecorationAdded(e){const t=e.data;this._decorateTypeThrottled(t.type())}_onLineDecorationRemoved(e){const t=e.data;this._decorateTypeThrottled(t.type())}async _decorateTypeThrottled(e){if(this._typeDecorationsPending.has(e))return;this._typeDecorationsPending.add(e);const t=Y.Runtime.instance().extensions(ze.LineDecorator).find(t=>t.descriptor().decoratorType===e),i=await t.instance();this._typeDecorationsPending.delete(e),this.textEditor.codeMirror().operation(()=>{i.decorate(this._persistenceBinding?this._persistenceBinding.network:this.uiSourceCode(),this.textEditor,e)})}_decorateAllTypes(){if(this.loaded)for(const e of Y.Runtime.instance().extensions(ze.LineDecorator)){const t=e.descriptor().decoratorType;null!==t&&this._uiSourceCode.decorationsForType(t)&&this._decorateTypeThrottled(t)}}async toolbarItems(){const e=await super.toolbarItems(),t=[];for(const i of this._plugins)e.push(...i.leftToolbarItems()),t.push(...await i.rightToolbarItems());return t.length?[...e,new g.ToolbarSeparator(!0),...t]:e}async populateLineGutterContextMenu(e,t){await super.populateLineGutterContextMenu(e,t);for(const i of this._plugins)await i.populateLineGutterContextMenu(e,t)}}const xi=new Map;xi.set(Ie.Message.Level.Error,"smallicon-error"),xi.set(Ie.Message.Level.Warning,"smallicon-warning");const yi=new Map;yi.set(Ie.Message.Level.Error,"error"),yi.set(Ie.Message.Level.Warning,"warning");const ki=new Map;ki.set(Ie.Message.Level.Error,"text-editor-line-with-error"),ki.set(Ie.Message.Level.Warning,"text-editor-line-with-warning");class Ii{constructor(e){this._message=e,this._repeatCount=1,this.element=document.createElement("div"),this.element.classList.add("text-editor-row-message"),this._icon=this.element.createChild("label","","dt-icon-label"),this._icon.type=xi.get(e.level()),this._repeatCountElement=this.element.createChild("span","text-editor-row-message-repeat-count hidden","dt-small-bubble"),this._repeatCountElement.type=yi.get(e.level());const t=this.element.createChild("div"),i=this._message.text().split("\n");for(let e=0;e<i.length;++e){t.createChild("div").textContent=i[e]}}message(){return this._message}repeatCount(){return this._repeatCount}setRepeatCount(e){this._repeatCount!==e&&(this._repeatCount=e,this._updateMessageRepeatCount())}_updateMessageRepeatCount(){this._repeatCountElement.textContent=String(this._repeatCount);const e=this._repeatCount>1;this._repeatCountElement.classList.toggle("hidden",!e),this._icon.classList.toggle("hidden",e)}}const Li=new WeakMap;class Ti{constructor(e,t,i){this._sourceFrame=e,this.textEditor=t,this._lineHandle=t.textEditorPositionHandle(i,0),this._decoration=document.createElement("div"),this._decoration.classList.add("text-editor-line-decoration"),Li.set(this._decoration,this),this._wave=this._decoration.createChild("div","text-editor-line-decoration-wave"),this._icon=this._wave.createChild("span","text-editor-line-decoration-icon","dt-icon-label"),this._decorationStartColumn=null,this._messagesDescriptionElement=document.createElement("div"),this._messagesDescriptionElement.classList.add("text-editor-messages-description-container"),this._messages=[],this._level=null}_updateWavePosition(e,t){e=Math.min(e,this.textEditor.linesCount-1);const i=this.textEditor.line(e);t=Math.min(t,i.length);const s=$e.Utils.lineIndent(i).length,n=Math.max(t-1,s);this._decorationStartColumn!==n&&(null!==this._decorationStartColumn&&this.textEditor.removeDecoration(this._decoration,e),this.textEditor.addDecoration(this._decoration,e,n),this._decorationStartColumn=n)}messagesDescription(){this._messagesDescriptionElement.removeChildren(),T.appendStyle(this._messagesDescriptionElement,"source_frame/messagesPopover.css");for(let e=0;e<this._messages.length;++e)this._messagesDescriptionElement.appendChild(this._messages[e].element);return this._messagesDescriptionElement}detachFromEditor(){const e=this._lineHandle.resolve();if(!e)return;const t=e.lineNumber;this._level&&this.textEditor.toggleLineClass(t,ki.get(this._level),!1),null!==this._decorationStartColumn&&(this.textEditor.removeDecoration(this._decoration,t),this._decorationStartColumn=null)}uniqueMessagesCount(){return this._messages.length}addMessage(e){for(let t=0;t<this._messages.length;++t){const i=this._messages[t];if(i.message().isEqual(e))return void i.setRepeatCount(i.repeatCount()+1)}const t=new Ii(e);this._messages.push(t),this._updateDecoration()}removeMessage(e){for(let t=0;t<this._messages.length;++t){const i=this._messages[t];if(i.message().isEqual(e))return i.setRepeatCount(i.repeatCount()-1),i.repeatCount()||this._messages.splice(t,1),void this._updateDecoration()}}_updateDecoration(){if(!this._sourceFrame.isShowing())return;if(!this._messages.length)return;const e=this._lineHandle.resolve();if(!e)return;const t=e.lineNumber;let i=Number.MAX_VALUE,s=null;for(let e=0;e<this._messages.length;++e){const o=this._messages[e].message(),{columnNumber:r}=this._sourceFrame.uiLocationToEditorLocation(t,o.columnNumber());i=Math.min(i,r),(!s||(n=o,Pi[s.level()]-Pi[n.level()]<0))&&(s=o)}var n;this._updateWavePosition(t,i),s&&this._level!==s.level()&&(this._level&&(this.textEditor.toggleLineClass(t,ki.get(this._level),!1),this._icon.type=""),this._level=s.level(),this._level&&(this.textEditor.toggleLineClass(t,ki.get(this._level),!0),this._icon.type=xi.get(this._level)))}}const Pi={Warning:3,Error:4};const Mi={ToolbarItemsChanged:Symbol("ToolbarItemsChanged")};var Fi=Object.freeze({__proto__:null,UISourceCodeFrame:Ei,RowMessage:Ii,RowMessageBucket:Ti,Events:Mi});class Di extends h.ObjectWrapper{constructor(e,t,i,s){super(),this._delegate=e,this._tabbedPane=new N.TabbedPane,this._tabbedPane.setPlaceholderElement(i,s),this._tabbedPane.setTabDelegate(new ji(this)),this._tabbedPane.setCloseableTabs(!0),this._tabbedPane.setAllowTabReorder(!0,!0),this._tabbedPane.addEventListener(N.Events.TabClosed,this._tabClosed,this),this._tabbedPane.addEventListener(N.Events.TabSelected,this._tabSelected,this),ue.PersistenceImpl.instance().addEventListener(ue.Events.BindingCreated,this._onBindingCreated,this),ue.PersistenceImpl.instance().addEventListener(ue.Events.BindingRemoved,this._onBindingRemoved,this),this._tabIds=new Map,this._files=new Map,this._previouslyViewedFilesSetting=t,this._history=Ri.fromObject(this._previouslyViewedFilesSetting.get()),this._uriToUISourceCode=new Map,this._currentFile,this._currentView}_onBindingCreated(e){const t=e.data;this._updateFileTitle(t.fileSystem);const i=this._tabIds.get(t.network);let s=this._tabIds.get(t.fileSystem);const n=this._currentFile===t.network,o=this._history.selectionRange(t.network.url()),r=this._history.scrollLineNumber(t.network.url());if(this._history.remove(t.network.url()),i){if(!s){const e=this._tabbedPane.tabView(i),n=this._tabbedPane.tabIndex(i);if(e instanceof Ei)this._delegate.recycleUISourceCodeFrame(e,t.fileSystem),s=this._appendFileTab(t.fileSystem,!1,n,e);else{s=this._appendFileTab(t.fileSystem,!1,n);const e=this._tabbedPane.tabView(s);this._restoreEditorProperties(e,o,r)}}this._closeTabs([i],!0),n&&this._tabbedPane.selectTab(s,!1),this._updateHistory()}}_onBindingRemoved(e){const t=e.data;this._updateFileTitle(t.fileSystem)}get view(){return this._tabbedPane}get visibleView(){return this._tabbedPane.visibleView}fileViews(){return this._tabbedPane.tabViews()}leftToolbar(){return this._tabbedPane.leftToolbar()}rightToolbar(){return this._tabbedPane.rightToolbar()}show(e){this._tabbedPane.show(e)}showFile(e){this._innerShowFile(this._canonicalUISourceCode(e),!0)}closeFile(e){const t=this._tabIds.get(e);t&&this._closeTabs([t])}closeAllFiles(){this._closeTabs(this._tabbedPane.tabIds())}historyUISourceCodes(){const e=[],t=this._history._urls();for(const i of t){const t=this._uriToUISourceCode.get(i);t&&e.push(t)}return e}_addViewListeners(){this._currentView&&this._currentView instanceof ze.SourceFrameImpl&&(this._currentView.textEditor.addEventListener(We.Events.ScrollChanged,this._scrollChanged,this),this._currentView.textEditor.addEventListener(We.Events.SelectionChanged,this._selectionChanged,this))}_removeViewListeners(){this._currentView&&this._currentView instanceof ze.SourceFrameImpl&&(this._currentView.textEditor.removeEventListener(We.Events.ScrollChanged,this._scrollChanged,this),this._currentView.textEditor.removeEventListener(We.Events.SelectionChanged,this._selectionChanged,this))}_scrollChanged(e){this._scrollTimer&&clearTimeout(this._scrollTimer);const t=e.data;this._scrollTimer=setTimeout(function(){this._history.save(this._previouslyViewedFilesSetting)}.bind(this),100),this._currentFile&&this._history.updateScrollLineNumber(this._currentFile.url(),t)}_selectionChanged(e){const t=e.data;this._currentFile&&this._history.updateSelectionRange(this._currentFile.url(),t),this._history.save(this._previouslyViewedFilesSetting),this._currentFile&&Ye.ExtensionServer.instance().sourceSelectionChanged(this._currentFile.url(),t)}_innerShowFile(e,t){const i=ue.PersistenceImpl.instance().binding(e);if(e=i?i.fileSystem:e,this._currentFile===e)return;this._removeViewListeners(),this._currentFile=e;const s=this._tabIds.get(e)||this._appendFileTab(e,t);this._tabbedPane.selectTab(s,t),t&&this._editorSelectedByUserAction();const n=this._currentView;this._currentView=this.visibleView,this._addViewListeners();const o={currentFile:this._currentFile,currentView:this._currentView,previousView:n,userGesture:t};this.dispatchEventToListeners(Bi.EditorSelected,o)}_titleForFile(e){let t=e.displayName(!0).trimMiddle(30);return e.isDirty()&&(t+="*"),t}_maybeCloseTab(t,i){const s=this._files.get(t);if(!s)return!1;return!(s.isDirty()&&s.project().canSetFileContent()&&!confirm(e.UIString("Are you sure you want to close unsaved file: %s?",s.name())))&&(s.resetWorkingCopy(),i&&this._tabbedPane.selectTab(i,!0),this._tabbedPane.closeTab(t,!0),!0)}_closeTabs(e,t){const i=[],s=[];for(let n=0;n<e.length;++n){const o=e[n],r=this._files.get(o);r&&(!t&&r.isDirty()?i.push(o):s.push(o))}i.length&&this._tabbedPane.selectTab(i[0],!0),this._tabbedPane.closeTabs(s,!0);for(let e=0;e<i.length;++e){const t=e+1<i.length?i[e+1]:null;if(!this._maybeCloseTab(i[e],t))break}}_onContextMenu(e,t){const i=this._files.get(e);i&&t.appendApplicableItems(i)}_canonicalUISourceCode(e){return this._uriToUISourceCode.has(e.url())?this._uriToUISourceCode.get(e.url()):(this._uriToUISourceCode.set(e.url(),e),e)}addUISourceCode(e){const t=this._canonicalUISourceCode(e),i=t!==e,s=ue.PersistenceImpl.instance().binding(t);if(e=s?s.fileSystem:t,i&&e.project().type()!==ke.projectTypes.FileSystem&&e.disableEdit(),this._currentFile===e)return;const n=e.url(),o=this._history.index(n);if(-1===o)return;if(this._tabIds.has(e)||this._appendFileTab(e,!1),!o)return void this._innerShowFile(e,!1);if(!this._currentFile)return;const r=Ze.isSnippetsUISourceCode(this._currentFile),a=Ze.isSnippetsUISourceCode(e);this._history.index(this._currentFile.url())&&r&&!a&&this._innerShowFile(e,!1)}removeUISourceCode(e){this.removeUISourceCodes([e])}removeUISourceCodes(e){const t=[];for(const i of e){const e=this._tabIds.get(i);e&&t.push(e),this._uriToUISourceCode.get(i.url())===i&&this._uriToUISourceCode.delete(i.url())}this._tabbedPane.closeTabs(t)}_editorClosedByUserAction(e){this._history.remove(e.url()),this._updateHistory()}_editorSelectedByUserAction(){this._updateHistory()}_updateHistory(){const e=this._tabbedPane.lastOpenedTabIds(Ui);this._history.update(e.map(function(e){const t=this._files.get(e);return t?t.url():""}.bind(this))),this._history.save(this._previouslyViewedFilesSetting)}_tooltipForFile(e){return(e=ue.PersistenceImpl.instance().network(e)||e).url()}_appendFileTab(e,t,i,s){const n=s||this._delegate.viewForFile(e),o=this._titleForFile(e),r=this._tooltipForFile(e),a=this._generateTabId();if(this._tabIds.set(e,a),this._files.set(a,e),!s){const t=this._history.selectionRange(e.url()),i=this._history.scrollLineNumber(e.url());this._restoreEditorProperties(n,t,i)}return this._tabbedPane.appendTab(a,o,n,r,t,void 0,i),this._updateFileTitle(e),this._addUISourceCodeListeners(e),e.loadError()?this._addLoadErrorIcon(a):e.contentLoaded()||e.requestContent().then(t=>{e.loadError()&&this._addLoadErrorIcon(a)}),a}_addLoadErrorIcon(e){const t=E.Icon.create("smallicon-error");t.title=ls`Unable to load this content.`,this._tabbedPane.tabView(e)&&this._tabbedPane.setTabIcon(e,t)}_restoreEditorProperties(e,t,i){const s=e instanceof ze.SourceFrameImpl?e:null;s&&(t&&s.setSelection(t),"number"==typeof i&&s.scrollToLine(i))}_tabClosed(e){const t=e.data.tabId,i=e.data.isUserGesture,s=this._files.get(t);this._currentFile===s&&(this._removeViewListeners(),this._currentView=null,this._currentFile=null),this._tabIds.delete(s),this._files.delete(t),s&&(this._removeUISourceCodeListeners(s),this.dispatchEventToListeners(Bi.EditorClosed,s),i&&this._editorClosedByUserAction(s))}_tabSelected(e){const t=e.data.tabId,i=e.data.isUserGesture,s=this._files.get(t);s&&this._innerShowFile(s,i)}_addUISourceCodeListeners(e){e.addEventListener(Ie.Events.TitleChanged,this._uiSourceCodeTitleChanged,this),e.addEventListener(Ie.Events.WorkingCopyChanged,this._uiSourceCodeWorkingCopyChanged,this),e.addEventListener(Ie.Events.WorkingCopyCommitted,this._uiSourceCodeWorkingCopyCommitted,this)}_removeUISourceCodeListeners(e){e.removeEventListener(Ie.Events.TitleChanged,this._uiSourceCodeTitleChanged,this),e.removeEventListener(Ie.Events.WorkingCopyChanged,this._uiSourceCodeWorkingCopyChanged,this),e.removeEventListener(Ie.Events.WorkingCopyCommitted,this._uiSourceCodeWorkingCopyCommitted,this)}_updateFileTitle(t){const i=this._tabIds.get(t);if(i){const s=this._titleForFile(t),n=this._tooltipForFile(t);this._tabbedPane.changeTabTitle(i,s,n);let o=null;t.loadError()?(o=E.Icon.create("smallicon-error"),o.title=ls`Unable to load this content.`):ue.PersistenceImpl.instance().hasUnsavedCommittedChanges(t)?(o=E.Icon.create("smallicon-warning"),o.title=e.UIString("Changes to this file were not saved to file system.")):o=me.PersistenceUtils.iconForUISourceCode(t),this._tabbedPane.setTabIcon(i,o)}}_uiSourceCodeTitleChanged(e){const t=e.data;this._updateFileTitle(t),this._updateHistory()}_uiSourceCodeWorkingCopyChanged(e){const t=e.data;this._updateFileTitle(t)}_uiSourceCodeWorkingCopyCommitted(e){const t=e.data.uiSourceCode;this._updateFileTitle(t)}_generateTabId(){return"tab_"+Ni++}currentFile(){return this._currentFile||null}}const Bi={EditorSelected:Symbol("EditorSelected"),EditorClosed:Symbol("EditorClosed")};let Ni=0;const Ui=30;class Ai{constructor(e,t,i){this.url=e,this._isSerializable=e.length<Ai.serializableUrlLengthLimit,this.selectionRange=t,this.scrollLineNumber=i}static fromObject(e){const t="selectionRange"in e?Ke.TextRange.fromObject(e.selectionRange):void 0;return new Ai(e.url,t,e.scrollLineNumber)}serializeToObject(){if(!this._isSerializable)return null;const e={};return e.url=this.url,e.selectionRange=this.selectionRange,e.scrollLineNumber=this.scrollLineNumber,e}}Ai.serializableUrlLengthLimit=4096;class Ri{constructor(e){this._items=e,this._itemsIndex=new Map,this._rebuildItemIndex()}static fromObject(e){const t=[];for(let i=0;i<e.length;++i)"url"in e[i]&&e[i].url&&t.push(Ai.fromObject(e[i]));return new Ri(t)}index(e){const t=this._itemsIndex.get(e);return void 0!==t?t:-1}_rebuildItemIndex(){this._itemsIndex=new Map;for(let e=0;e<this._items.length;++e)console.assert(!this._itemsIndex.has(this._items[e].url)),this._itemsIndex.set(this._items[e].url,e)}selectionRange(e){const t=this.index(e);return-1!==t?this._items[t].selectionRange:void 0}updateSelectionRange(e,t){if(!t)return;const i=this.index(e);-1!==i&&(this._items[i].selectionRange=t)}scrollLineNumber(e){const t=this.index(e);return-1!==t?this._items[t].scrollLineNumber:void 0}updateScrollLineNumber(e,t){const i=this.index(e);-1!==i&&(this._items[i].scrollLineNumber=t)}update(e){for(let t=e.length-1;t>=0;--t){const i=this.index(e[t]);let s;-1!==i?(s=this._items[i],this._items.splice(i,1)):s=new Ai(e[t]),this._items.unshift(s),this._rebuildItemIndex()}}remove(e){const t=this.index(e);-1!==t&&(this._items.splice(t,1),this._rebuildItemIndex())}save(e){e.set(this._serializeToObject())}_serializeToObject(){const e=[];for(let t=0;t<this._items.length;++t){const i=this._items[t].serializeToObject();if(i&&e.push(i),e.length===Ui)break}return e}_urls(){const e=[];for(let t=0;t<this._items.length;++t)e.push(this._items[t].url);return e}}class ji{constructor(e){this._editorContainer=e}closeTabs(e,t){this._editorContainer._closeTabs(t)}onContextMenu(e,t){this._editorContainer._onContextMenu(e,t)}}var Vi=Object.freeze({__proto__:null,TabbedEditorContainerDelegate:class{viewForFile(e){throw new Error("Not implemented yet")}recycleUISourceCodeFrame(e,t){}},TabbedEditorContainer:Di,Events:Bi,get tabId(){return Ni},maximalPreviouslyViewedFilesCount:Ui,HistoryItem:Ai,History:Ri,EditorContainerTabDelegate:ji});class Oi extends u.VBox{constructor(){super(),this.registerRequiredCSS("sources/sourcesView.css"),this.element.id="sources-panel-sources-view",this.setMinimumAndPreferredSizes(88,52,150,100),this._placeholderOptionArray=[],this._selectedIndex=0;const e=ke.WorkspaceImpl.instance();if(this._searchableView=new U.SearchableView(this,"sourcesViewSearchConfig"),this._searchableView.setMinimalSearchQuerySize(0),this._searchableView.show(this.element),this._sourceViewByUISourceCode=new Map,this._editorContainer=new Di(this,r.Settings.instance().createLocalSetting("previouslyViewedFiles",[]),this._placeholderElement(),this._focusedPlaceholderElement),this._editorContainer.show(this._searchableView.element),this._editorContainer.addEventListener(Bi.EditorSelected,this._editorSelected,this),this._editorContainer.addEventListener(Bi.EditorClosed,this._editorClosed,this),this._historyManager=new ai(this,this.currentSourceFrame.bind(this)),this._toolbarContainerElement=this.element.createChild("div","sources-toolbar"),!Y.experiments.isEnabled("sourcesPrettyPrint")){const e=new g.Toolbar("",this._toolbarContainerElement);Y.Runtime.instance().allInstances(Hi).then(t=>{for(const i of t)e.appendToolbarItem(i.button(this))})}this._scriptViewToolbar=new g.Toolbar("",this._toolbarContainerElement),this._scriptViewToolbar.element.style.flex="auto",this._bottomToolbar=new g.Toolbar("",this._toolbarContainerElement),this._toolbarChangedListener=null,p.startBatchUpdate(),e.uiSourceCodes().forEach(this._addUISourceCode.bind(this)),p.endBatchUpdate(),e.addEventListener(ke.Events.UISourceCodeAdded,this._uiSourceCodeAdded,this),e.addEventListener(ke.Events.UISourceCodeRemoved,this._uiSourceCodeRemoved,this),e.addEventListener(ke.Events.ProjectRemoved,this._projectRemoved.bind(this),this),window.opener||window.addEventListener("beforeunload",(function(e){if(e.returnValue)return;const t=[],s=ke.WorkspaceImpl.instance().projectsForType(ke.projectTypes.FileSystem);for(const e of s)t.push(...e.uiSourceCodes().filter(e=>e.isDirty()));if(t.length){e.returnValue=!0,y.ViewManager.instance().showView("sources");for(const e of t)i.reveal(e)}}),!0),this._shortcuts=new Map,this.element.addEventListener("keydown",this._handleKeyDown.bind(this),!1)}_placeholderElement(){this._placeholderOptionArray=[];const e=[{actionId:"quickOpen.show",description:ls`Open file`},{actionId:"commandMenu.show",description:ls`Run command`},{actionId:"sources.add-folder-to-workspace",description:ls`Drop in a folder to add to workspace`}],t=document.createElement("div"),i=t.createChild("div","tabbed-pane-placeholder");i.addEventListener("keydown",this._placeholderOnKeyDown.bind(this),!1),w.markAsList(i),w.setAccessibleName(i,ls`Source View Actions`);for(let t=0;t<e.length;t++){const s=e[t],n=F.ShortcutRegistry.instance().shortcutTitleForAction(s.actionId),o=i.createChild("div");w.markAsListitem(o);const r=o.createChild("div","tabbed-pane-placeholder-row");r.tabIndex=-1,w.markAsButton(r),n?(r.createChild("div","tabbed-pane-placeholder-key").textContent=n,r.createChild("div","tabbed-pane-placeholder-value").textContent=s.description):r.createChild("div","tabbed-pane-no-shortcut").textContent=s.description;const a=A.ActionRegistry.instance().action(s.actionId);a&&this._placeholderOptionArray.push({element:r,handler(){a.execute()}})}const s=this._placeholderOptionArray[0].element;return s.tabIndex=0,this._focusedPlaceholderElement=s,this._selectedIndex=0,t.appendChild(R.XLink.create("https://developers.google.com/web/tools/chrome-devtools/sources?utm_source=devtools&utm_campaign=2018Q1","Learn more about Workspaces")),t}_placeholderOnKeyDown(e){const t=e;if(isEnterOrSpaceKey(t))return void this._placeholderOptionArray[this._selectedIndex].handler();let i=0;"ArrowDown"===t.key?i=1:"ArrowUp"===t.key&&(i=-1);const s=Math.max(Math.min(this._placeholderOptionArray.length-1,this._selectedIndex+i),0),n=this._placeholderOptionArray[s].element,o=this._placeholderOptionArray[this._selectedIndex].element;n!==o&&(o.tabIndex=-1,n.tabIndex=0,w.setSelected(o,!1),w.setSelected(n,!0),this._selectedIndex=s,n.focus())}_resetPlaceholderState(){this._placeholderOptionArray[this._selectedIndex].element.tabIndex=-1,this._placeholderOptionArray[0].element.tabIndex=0,this._selectedIndex=0}static defaultUISourceCodeScores(){const e=new Map,t=v.Context.instance().flavor(Oi);if(t){const i=t._editorContainer.historyUISourceCodes();for(let t=1;t<i.length;++t)e.set(i[t],i.length-t)}return e}leftToolbar(){return this._editorContainer.leftToolbar()}rightToolbar(){return this._editorContainer.rightToolbar()}bottomToolbar(){return this._bottomToolbar}_registerShortcuts(e,t){for(let i=0;i<e.length;++i)this._shortcuts.set(e[i].key,t)}_handleKeyDown(e){const t=I.KeyboardShortcut.makeKeyFromEvent(e),i=this._shortcuts.get(t);i&&i()&&e.consume(!0)}wasShown(){super.wasShown(),v.Context.instance().setFlavor(Oi,this)}willHide(){v.Context.instance().setFlavor(Oi,null),this._resetPlaceholderState(),super.willHide()}toolbarContainerElement(){return this._toolbarContainerElement}searchableView(){return this._searchableView}visibleView(){return this._editorContainer.visibleView}currentSourceFrame(){const e=this.visibleView();return e instanceof Ei?e:null}currentUISourceCode(){return this._editorContainer.currentFile()}_onCloseEditorTab(){const e=this._editorContainer.currentFile();return!!e&&(this._editorContainer.closeFile(e),!0)}_onJumpToPreviousLocation(){this._historyManager.rollback()}_onJumpToNextLocation(){this._historyManager.rollover()}_uiSourceCodeAdded(e){const t=e.data;this._addUISourceCode(t)}_addUISourceCode(e){e.project().isServiceProject()||e.project().type()===ke.projectTypes.FileSystem&&"overrides"===pe.FileSystemWorkspaceBinding.fileSystemType(e.project())||this._editorContainer.addUISourceCode(e)}_uiSourceCodeRemoved(e){const t=e.data;this._removeUISourceCodes([t])}_removeUISourceCodes(e){this._editorContainer.removeUISourceCodes(e);for(let t=0;t<e.length;++t)this._removeSourceFrame(e[t]),this._historyManager.removeHistoryForSourceCode(e[t])}_projectRemoved(e){const t=e.data.uiSourceCodes();this._removeUISourceCodes(t)}_updateScriptViewToolbarItems(){const e=this.visibleView();e instanceof S.SimpleView&&e.toolbarItems().then(e=>{this._scriptViewToolbar.removeToolbarItems(),e.map(e=>this._scriptViewToolbar.appendToolbarItem(e))})}showSourceLocation(e,t,i,s,n){this._historyManager.updateCurrentState(),this._editorContainer.showFile(e);const o=this.currentSourceFrame();o&&"number"==typeof t&&o.revealPosition(t,i,!n),this._historyManager.pushNewState();const r=this.visibleView();!s&&r&&r.focus()}_createSourceView(e){let t,i;const s=e.contentType();s===d.resourceTypes.Image?i=new qe.ImageView(e.mimeType(),e):s===d.resourceTypes.Font?i=new Ge.FontView(e.mimeType(),e):t=new Ei(e),t&&this._historyManager.trackSourceFrameCursorJumps(t);const n=t||i;return this._sourceViewByUISourceCode.set(e,n),n}_getOrCreateSourceView(e){return this._sourceViewByUISourceCode.get(e)||this._createSourceView(e)}recycleUISourceCodeFrame(e,t){this._sourceViewByUISourceCode.delete(e.uiSourceCode()),e.setUISourceCode(t),this._sourceViewByUISourceCode.set(t,e)}viewForFile(e){return this._getOrCreateSourceView(e)}_removeSourceFrame(e){const t=this._sourceViewByUISourceCode.get(e);this._sourceViewByUISourceCode.delete(e),t&&t instanceof Ei&&t.dispose()}_editorClosed(e){const t=e.data;this._historyManager.removeHistoryForSourceCode(t);let i=!1;this._editorContainer.currentFile()||(i=!0),this._removeToolbarChangedListener(),this._updateScriptViewToolbarItems(),this._searchableView.resetSearch();const s={};s.uiSourceCode=t,s.wasSelected=i,this.dispatchEventToListeners(Wi.EditorClosed,s)}_editorSelected(e){const t=e.data.previousView instanceof Ei?e.data.previousView:null;t&&t.setSearchableView(null);const i=e.data.currentView instanceof Ei?e.data.currentView:null;i&&i.setSearchableView(this._searchableView),this._searchableView.setReplaceable(!!i&&i.canEditSource()),this._searchableView.refreshSearch(),this._updateToolbarChangedListener(),this._updateScriptViewToolbarItems(),this.dispatchEventToListeners(Wi.EditorSelected,this._editorContainer.currentFile())}_removeToolbarChangedListener(){this._toolbarChangedListener&&l.EventTarget.removeEventListeners([this._toolbarChangedListener]),this._toolbarChangedListener=null}_updateToolbarChangedListener(){this._removeToolbarChangedListener();const e=this.currentSourceFrame();e&&(this._toolbarChangedListener=e.addEventListener(Mi.ToolbarItemsChanged,this._updateScriptViewToolbarItems,this))}searchCanceled(){this._searchView&&this._searchView.searchCanceled(),delete this._searchView,delete this._searchConfig}performSearch(e,t,i){const s=this.currentSourceFrame();s&&(this._searchView=s,this._searchConfig=e,this._searchView.performSearch(this._searchConfig,t,i))}jumpToNextSearchResult(){this._searchView&&(this._searchConfig&&this._searchView!==this.currentSourceFrame()?this.performSearch(this._searchConfig,!0):this._searchView.jumpToNextSearchResult())}jumpToPreviousSearchResult(){if(this._searchView)return this._searchConfig&&this._searchView!==this.currentSourceFrame()?(this.performSearch(this._searchConfig,!0),void(this._searchView&&this._searchView.jumpToLastSearchResult())):void this._searchView.jumpToPreviousSearchResult()}supportsCaseSensitiveSearch(){return!0}supportsRegexSearch(){return!0}replaceSelectionWith(e,t){const i=this.currentSourceFrame();i?i.replaceSelectionWith(e,t):console.assert(!!i)}replaceAllWith(e,t){const i=this.currentSourceFrame();i?i.replaceAllWith(e,t):console.assert(!!i)}_showOutlineQuickOpen(){it.QuickOpenImpl.show("@")}_showGoToLineQuickOpen(){this._editorContainer.currentFile()&&it.QuickOpenImpl.show(":")}_save(){this._saveSourceFrame(this.currentSourceFrame())}_saveAll(){this._editorContainer.fileViews().forEach(this._saveSourceFrame.bind(this))}_saveSourceFrame(e){if(!(e instanceof Ei))return;e.commitEditing()}toggleBreakpointsActiveState(e){this._editorContainer.view.element.classList.toggle("breakpoints-deactivated",!e)}}const Wi={EditorClosed:Symbol("EditorClosed"),EditorSelected:Symbol("EditorSelected")};class Hi{button(e){throw new Error("Not implemented yet")}}class zi{static _nextFile(e){function t(e){const t=e.lastIndexOf(".");return e.substr(0,-1!==t?t:e.length).toLowerCase()}const i=e.project().uiSourceCodes(),s=[],n=e.parentURL(),o=e.name(),r=t(o);for(let e=0;e<i.length;++e){const o=i[e];n===o.parentURL()&&(t(o.name())===r&&s.push(o.name()))}s.sort(String.naturalOrderComparator);const a=Ve.mod(s.indexOf(o)+1,s.length),c=(n?n+"/":"")+s[a],l=e.project().uiSourceCodeForURL(c);return l!==e?l:null}handleAction(e,t){const i=v.Context.instance().flavor(Oi);if(!i)return!1;const s=i.currentUISourceCode();if(!s)return!1;const n=zi._nextFile(s);return!!n&&(i.showSourceLocation(n),!0)}}var qi=Object.freeze({__proto__:null,SourcesView:Oi,Events:Wi,EditorAction:Hi,SwitchFileActionDelegate:zi,ActionDelegate:class{handleAction(e,t){const i=v.Context.instance().flavor(Oi);if(!i)return!1;switch(t){case"sources.close-all":return i._editorContainer.closeAllFiles(),!0;case"sources.jump-to-previous-location":return i._onJumpToPreviousLocation(),!0;case"sources.jump-to-next-location":return i._onJumpToNextLocation(),!0;case"sources.close-editor-tab":return i._onCloseEditorTab();case"sources.go-to-line":return i._showGoToLineQuickOpen(),!0;case"sources.go-to-member":return i._showOutlineQuickOpen(),!0;case"sources.save":return i._save(),!0;case"sources.save-all":return i._saveAll(),!0}return!1}}});class Gi extends u.VBox{constructor(){super(!0),this.registerRequiredCSS("sources/threadsSidebarPane.css"),this._items=new C.ListModel,this._list=new f.ListControl(this._items,this,f.ListMode.NonViewport);const e=v.Context.instance().flavor(Se.Target);this._selectedModel=e?e.model(be.DebuggerModel):null,this.contentElement.appendChild(this._list.element),v.Context.instance().addFlavorChangeListener(Se.Target,this._targetFlavorChanged,this),Se.TargetManager.instance().observeModels(be.DebuggerModel,this)}static shouldBeShown(){return Se.TargetManager.instance().models(be.DebuggerModel).length>=2}createElementForItem(e){const t=document.createElement("div");t.classList.add("thread-item");const i=t.createChild("div","thread-item-title"),s=t.createChild("div","thread-item-paused-state");t.appendChild(E.Icon.create("smallicon-thick-right-arrow","selected-thread-icon")),t.tabIndex=-1,self.onInvokeElement(t,t=>{v.Context.instance().setFlavor(Se.Target,e.target()),t.consume(!0)});const n=v.Context.instance().flavor(Se.Target)===e.target();function o(){const t=e.runtimeModel().defaultExecutionContext();i.textContent=t&&t.label()?t.label():e.target().name()}function r(){s.textContent=e.isPaused()?ls`paused`:""}return t.classList.toggle("selected",n),w.setSelected(t,n),e.addEventListener(be.Events.DebuggerPaused,r),e.addEventListener(be.Events.DebuggerResumed,r),e.runtimeModel().addEventListener(Ee.Events.ExecutionContextChanged,o),Se.TargetManager.instance().addEventListener(Se.Events.NameChanged,(function(t){t.data===e.target()&&o()})),r(),o(),t}heightForItem(e){return console.assert(!1),0}isItemSelectable(e){return!0}selectedItemChanged(e,t,i,s){i&&(i.tabIndex=-1);const n=s;n&&(this.setDefaultFocusedElement(n),n.tabIndex=0,this.hasFocus()&&n.focus())}updateSelectedItemARIA(e,t){return!1}modelAdded(e){this._items.insert(this._items.length,e);v.Context.instance().flavor(Se.Target)===e.target()&&this._list.selectItem(e)}modelRemoved(e){this._items.remove(this._items.indexOf(e))}_targetFlavorChanged(e){const t=this.hasFocus(),i=e.data.model(be.DebuggerModel);this._list.selectItem(i),i&&this._list.refreshItem(i),this._selectedModel&&this._list.refreshItem(this._selectedModel),this._selectedModel=i,t&&this.focus()}}var Ki=Object.freeze({__proto__:null,ThreadsSidebarPane:Gi});let $i;class Ji extends j.Panel{constructor(){super("sources"),Ji._instance=this,this.registerRequiredCSS("sources/sourcesPanel.css"),new V.DropTarget(this.element,[V.Type.Folder],e.UIString("Drop workspace folder here"),this._handleDrop.bind(this)),this._workspace=ke.WorkspaceImpl.instance(),this._togglePauseAction=A.ActionRegistry.instance().action("debugger.toggle-pause"),this._stepOverAction=A.ActionRegistry.instance().action("debugger.step-over"),this._stepIntoAction=A.ActionRegistry.instance().action("debugger.step-into"),this._stepOutAction=A.ActionRegistry.instance().action("debugger.step-out"),this._stepAction=A.ActionRegistry.instance().action("debugger.step"),this._toggleBreakpointsActiveAction=A.ActionRegistry.instance().action("debugger.toggle-breakpoints-active"),this._debugToolbar=this._createDebugToolbar(),this._debugToolbarDrawer=this._createDebugToolbarDrawer(),this._debuggerPausedMessage=new Tt;this._splitWidget=new O.SplitWidget(!0,!0,"sourcesPanelSplitViewState",225),this._splitWidget.enableShowModeSaving(),this._splitWidget.show(this.element);this.editorView=new O.SplitWidget(!0,!1,"sourcesPanelNavigatorSplitViewState",225),this.editorView.enableShowModeSaving(),this._splitWidget.setMainWidget(this.editorView),this._navigatorTabbedLocation=y.ViewManager.instance().createTabbedLocation(this._revealNavigatorSidebar.bind(this),"navigator-view",!0);const t=this._navigatorTabbedLocation.tabbedPane();t.setMinimumSize(100,25),t.element.classList.add("navigator-tabbed-pane");const i=new g.ToolbarMenuButton(this._populateNavigatorMenu.bind(this),!0);if(i.setTitle(e.UIString("More options")),t.rightToolbar().appendToolbarItem(i),y.ViewManager.instance().hasViewsForLocation("run-view-sidebar")){const e=new O.SplitWidget(!1,!0,"sourcePanelNavigatorSidebarSplitViewState");e.setMainWidget(t);const i=y.ViewManager.instance().createTabbedLocation(this._revealNavigatorSidebar.bind(this),"run-view-sidebar").tabbedPane();e.setSidebarWidget(i),e.installResizer(i.headerElement()),this.editorView.setSidebarWidget(e)}else this.editorView.setSidebarWidget(t);this._sourcesView=new Oi,this._sourcesView.addEventListener(Wi.EditorSelected,this._editorSelected.bind(this)),this._toggleNavigatorSidebarButton=this.editorView.createShowHideSidebarButton(ls`navigator`),this._toggleDebuggerSidebarButton=this._splitWidget.createShowHideSidebarButton(ls`debugger`),this.editorView.setMainWidget(this._sourcesView),this._threadsSidebarPane=null,this._watchSidebarPane=y.ViewManager.instance().view("sources.watch"),this._callstackPane=_t.instance(),r.Settings.instance().moduleSetting("sidebarPosition").addChangeListener(this._updateSidebarPosition.bind(this)),this._updateSidebarPosition(),this._updateDebuggerButtonsAndStatus(),this._pauseOnExceptionEnabledChanged(),r.Settings.instance().moduleSetting("pauseOnExceptionEnabled").addChangeListener(this._pauseOnExceptionEnabledChanged,this),this._liveLocationPool=new Z.LiveLocationPool,this._setTarget(v.Context.instance().flavor(Se.Target)),r.Settings.instance().moduleSetting("breakpointsActive").addChangeListener(this._breakpointsActiveStateChanged,this),v.Context.instance().addFlavorChangeListener(Se.Target,this._onCurrentTargetChanged,this),v.Context.instance().addFlavorChangeListener(be.CallFrame,this._callFrameChanged,this),Se.TargetManager.instance().addModelListener(be.DebuggerModel,be.Events.DebuggerWasEnabled,this._debuggerWasEnabled,this),Se.TargetManager.instance().addModelListener(be.DebuggerModel,be.Events.DebuggerPaused,this._debuggerPaused,this),Se.TargetManager.instance().addModelListener(be.DebuggerModel,be.Events.DebuggerResumed,e=>this._debuggerResumed(e.data)),Se.TargetManager.instance().addModelListener(be.DebuggerModel,be.Events.GlobalObjectCleared,e=>this._debuggerResumed(e.data)),Ye.ExtensionServer.instance().addEventListener(Ye.Events.SidebarPaneAdded,this._extensionSidebarPaneAdded,this),Se.TargetManager.instance().observeTargets(this)}static instance(e={forceNew:null}){const{forceNew:t}=e;return $i&&!t||($i=new Ji),$i}static updateResizerAndSidebarButtons(e){e._sourcesView.leftToolbar().removeToolbarItems(),e._sourcesView.rightToolbar().removeToolbarItems(),e._sourcesView.bottomToolbar().removeToolbarItems();const t=Yi.isShowing()&&!P.InspectorView.instance().isDrawerMinimized();e._splitWidget.isVertical()||t?e._splitWidget.uninstallResizer(e._sourcesView.toolbarContainerElement()):e._splitWidget.installResizer(e._sourcesView.toolbarContainerElement()),t||(e._sourcesView.leftToolbar().appendToolbarItem(e._toggleNavigatorSidebarButton),e._splitWidget.isVertical()?e._sourcesView.rightToolbar().appendToolbarItem(e._toggleDebuggerSidebarButton):e._sourcesView.bottomToolbar().appendToolbarItem(e._toggleDebuggerSidebarButton))}targetAdded(e){this._showThreadsIfNeeded()}targetRemoved(e){}_showThreadsIfNeeded(){Gi.shouldBeShown()&&!this._threadsSidebarPane&&(this._threadsSidebarPane=y.ViewManager.instance().view("sources.threads"),this._sidebarPaneStack&&this._threadsSidebarPane&&this._sidebarPaneStack.showView(this._threadsSidebarPane,this._splitWidget.isVertical()?this._watchSidebarPane:this._callstackPane))}_setTarget(e){if(!e)return;const t=e.model(be.DebuggerModel);t&&(t.isPaused()?this._showDebuggerPausedDetails(t.debuggerPausedDetails()):(this._paused=!1,this._clearInterface(),this._toggleDebuggerSidebarButton.setEnabled(!0)))}_onCurrentTargetChanged(e){const t=e.data;this._setTarget(t)}paused(){return this._paused}wasShown(){v.Context.instance().setFlavor(Ji,this),super.wasShown();const e=Yi._instance;e&&e.isShowing()&&(P.InspectorView.instance().setDrawerMinimized(!0),Ji.updateResizerAndSidebarButtons(this)),this.editorView.setMainWidget(this._sourcesView)}willHide(){super.willHide(),v.Context.instance().setFlavor(Ji,null),Yi.isShowing()&&(Yi._instance._showViewInWrapper(),P.InspectorView.instance().setDrawerMinimized(!1),Ji.updateResizerAndSidebarButtons(this))}resolveLocation(e){return"sources.sidebar-top"===e||"sources.sidebar-bottom"===e||"sources.sidebar-tabs"===e?this._sidebarPaneStack:this._navigatorTabbedLocation}_ensureSourcesViewVisible(){return!!Yi.isShowing()||!!P.InspectorView.instance().canSelectPanel("sources")&&(y.ViewManager.instance().showView("sources"),!0)}onResize(){"auto"===r.Settings.instance().moduleSetting("sidebarPosition").get()&&this.element.window().requestAnimationFrame(this._updateSidebarPosition.bind(this))}searchableView(){return this._sourcesView.searchableView()}_debuggerPaused(e){const t=e.data,i=t.debuggerPausedDetails();this._paused||this._setAsCurrentPanel(),v.Context.instance().flavor(Se.Target)===t.target()?this._showDebuggerPausedDetails(i):this._paused||v.Context.instance().setFlavor(Se.Target,t.target())}_showDebuggerPausedDetails(e){this._paused=!0,this._updateDebuggerButtonsAndStatus(),v.Context.instance().setFlavor(be.DebuggerPausedDetails,e),this._toggleDebuggerSidebarButton.setEnabled(!1),this._revealDebuggerSidebar(),window.focus(),ce.InspectorFrontendHostInstance.bringToFront()}_debuggerResumed(e){const t=e.target();v.Context.instance().flavor(Se.Target)===t&&(this._paused=!1,this._clearInterface(),this._toggleDebuggerSidebarButton.setEnabled(!0),this._switchToPausedTargetTimeout=setTimeout(this._switchToPausedTarget.bind(this,e),500))}_debuggerWasEnabled(e){const t=e.data;v.Context.instance().flavor(Se.Target)===t.target()&&this._updateDebuggerButtonsAndStatus()}get visibleView(){return this._sourcesView.visibleView()}showUISourceCode(e,t,i,s){if(s){const e=Yi._instance&&Yi._instance.isShowing();if(!this.isShowing()&&!e)return}else this._showEditor();this._sourcesView.showSourceLocation(e,t,i,s)}_showEditor(){Yi._instance&&Yi._instance.isShowing()||this._setAsCurrentPanel()}showUILocation(e,t){this.showUISourceCode(e.uiSourceCode,e.lineNumber,e.columnNumber,t)}_revealInNavigator(e,t){const i=Y.Runtime.instance().extensions(Jt);Promise.all(i.map(e=>e.instance())).then(function(s){for(let n=0;n<s.length;++n){const o=s[n],r=i[n].descriptor().viewId;o.acceptProject(e.project())&&(o.revealUISourceCode(e,!0),t?this._navigatorTabbedLocation.tabbedPane().selectTab(r):y.ViewManager.instance().showView(r))}}.bind(this))}_populateNavigatorMenu(t){const i=r.Settings.instance().moduleSetting("navigatorGroupByFolder");t.appendItemsAtLocation("navigatorMenu"),t.viewSection().appendCheckboxItem(e.UIString("Group by folder"),()=>i.set(!i.get()),i.get())}setIgnoreExecutionLineEvents(e){this._ignoreExecutionLineEvents=e}updateLastModificationTime(){this._lastModificationTime=window.performance.now()}async _executionLineChanged(e){const t=await e.uiLocation();t&&(window.performance.now()-this._lastModificationTime<Qi||this._sourcesView.showSourceLocation(t.uiSourceCode,t.lineNumber,t.columnNumber,void 0,!0))}_lastModificationTimeoutPassedForTest(){Qi=Number.MIN_VALUE}_updateLastModificationTimeForTest(){Qi=Number.MAX_VALUE}async _callFrameChanged(){const e=v.Context.instance().flavor(be.CallFrame);e&&(this._executionLineLocation&&this._executionLineLocation.dispose(),this._executionLineLocation=await te.DebuggerWorkspaceBinding.instance().createCallFrameLiveLocation(e.location(),this._executionLineChanged.bind(this),this._liveLocationPool))}_pauseOnExceptionEnabledChanged(){const e=r.Settings.instance().moduleSetting("pauseOnExceptionEnabled").get();this._pauseOnExceptionButton.setToggled(e),this._pauseOnExceptionButton.setTitle(e?ls`Don't pause on exceptions`:ls`Pause on exceptions`),this._debugToolbarDrawer.classList.toggle("expanded",e)}async _updateDebuggerButtonsAndStatus(){const e=v.Context.instance().flavor(Se.Target),t=e?e.model(be.DebuggerModel):null;t?this._paused?(this._togglePauseAction.setToggled(!0),this._togglePauseAction.setEnabled(!0),this._stepOverAction.setEnabled(!0),this._stepIntoAction.setEnabled(!0),this._stepOutAction.setEnabled(!0),this._stepAction.setEnabled(!0)):(this._togglePauseAction.setToggled(!1),this._togglePauseAction.setEnabled(!t.isPausing()),this._stepOverAction.setEnabled(!1),this._stepIntoAction.setEnabled(!1),this._stepOutAction.setEnabled(!1),this._stepAction.setEnabled(!1)):(this._togglePauseAction.setEnabled(!1),this._stepOverAction.setEnabled(!1),this._stepIntoAction.setEnabled(!1),this._stepOutAction.setEnabled(!1),this._stepAction.setEnabled(!1));const i=t?t.debuggerPausedDetails():null;await this._debuggerPausedMessage.render(i,te.DebuggerWorkspaceBinding.instance(),re.BreakpointManager.instance()),i&&this._updateDebuggerButtonsAndStatusForTest()}_updateDebuggerButtonsAndStatusForTest(){}_clearInterface(){this._updateDebuggerButtonsAndStatus(),v.Context.instance().setFlavor(be.DebuggerPausedDetails,null),this._switchToPausedTargetTimeout&&clearTimeout(this._switchToPausedTargetTimeout),this._liveLocationPool.disposeAll()}_switchToPausedTarget(e){if(delete this._switchToPausedTargetTimeout,!this._paused&&!e.isPaused())for(const e of Se.TargetManager.instance().models(be.DebuggerModel))if(e.isPaused()){v.Context.instance().setFlavor(Se.Target,e.target());break}}_togglePauseOnExceptions(){r.Settings.instance().moduleSetting("pauseOnExceptionEnabled").set(!this._pauseOnExceptionButton.toggled())}_runSnippet(){const e=this._sourcesView.currentUISourceCode();e&&Ze.evaluateScriptSnippet(e)}_editorSelected(e){const t=e.data;this.editorView.mainWidget()&&r.Settings.instance().moduleSetting("autoRevealInNavigator").get()&&this._revealInNavigator(t,!0)}_togglePause(){const e=v.Context.instance().flavor(Se.Target);if(!e)return!0;const t=e.model(be.DebuggerModel);return!t||(this._paused?(this._paused=!1,t.resume()):t.pause(),this._clearInterface(),!0)}_prepareToResume(){if(!this._paused)return null;this._paused=!1,this._clearInterface();const e=v.Context.instance().flavor(Se.Target);return e?e.model(be.DebuggerModel):null}_longResume(e){const t=this._prepareToResume();t&&(t.skipAllPausesUntilReloadOrTimeout(500),t.resume())}_terminateExecution(e){const t=this._prepareToResume();t&&(t.runtimeModel().terminateExecution(),t.resume())}_stepOver(){const e=this._prepareToResume();return e&&e.stepOver(),!0}_stepInto(){const e=this._prepareToResume();return e&&e.stepInto(),!0}_stepIntoAsync(){const e=this._prepareToResume();return e&&e.scheduleStepIntoAsync(),!0}_stepOut(){const e=this._prepareToResume();return e&&e.stepOut(),!0}async _continueToLocation(e){const t=v.Context.instance().flavor(Ee.ExecutionContext);if(!t)return;const i=(await te.DebuggerWorkspaceBinding.instance().uiLocationToRawLocations(e.uiSourceCode,e.lineNumber,0)).find(e=>e.debuggerModel===t.debuggerModel);i&&this._prepareToResume()&&i.continueToLocation()}_toggleBreakpointsActive(){r.Settings.instance().moduleSetting("breakpointsActive").set(!r.Settings.instance().moduleSetting("breakpointsActive").get())}_breakpointsActiveStateChanged(){const e=r.Settings.instance().moduleSetting("breakpointsActive").get();this._toggleBreakpointsActiveAction.setToggled(!e),this._sourcesView.toggleBreakpointsActiveState(e)}_createDebugToolbar(){const t=new g.Toolbar("scripts-debug-toolbar"),i=new g.ToolbarButton(e.UIString("Resume with all pauses blocked for 500 ms"),"largeicon-play");i.addEventListener(g.ToolbarButton.Events.Click,this._longResume,this);const s=new g.ToolbarButton(ls`Terminate current JavaScript call`,"largeicon-terminate-execution");return s.addEventListener(g.ToolbarButton.Events.Click,this._terminateExecution,this),t.appendToolbarItem(g.Toolbar.createLongPressActionButton(this._togglePauseAction,[s,i],[])),t.appendToolbarItem(g.Toolbar.createActionButton(this._stepOverAction)),t.appendToolbarItem(g.Toolbar.createActionButton(this._stepIntoAction)),t.appendToolbarItem(g.Toolbar.createActionButton(this._stepOutAction)),t.appendToolbarItem(g.Toolbar.createActionButton(this._stepAction)),t.appendSeparator(),t.appendToolbarItem(g.Toolbar.createActionButton(this._toggleBreakpointsActiveAction)),this._pauseOnExceptionButton=new g.ToolbarToggle("","largeicon-pause-on-exceptions"),this._pauseOnExceptionButton.addEventListener(g.ToolbarButton.Events.Click,this._togglePauseOnExceptions,this),t.appendToolbarItem(this._pauseOnExceptionButton),t}_createDebugToolbarDrawer(){const t=document.createElement("div");t.classList.add("scripts-debug-toolbar-drawer");const i=e.UIString("Pause on caught exceptions"),s=r.Settings.instance().moduleSetting("pauseOnCaughtException");return t.appendChild(W.createSettingCheckbox(i,s,!0)),t}appendApplicableItems(e,t,i){this._appendUISourceCodeItems(e,t,i),this._appendUISourceCodeFrameItems(e,t,i),this.appendUILocationItems(t,i),this._appendRemoteObjectItems(t,i),this._appendNetworkRequestItems(t,i)}_appendUISourceCodeItems(t,i,s){if(!(s instanceof Ie.UISourceCode))return;const n=s;n.project().isServiceProject()||t.target.isSelfOrDescendant(this._navigatorTabbedLocation.widget().element)||i.revealSection().appendItem(e.UIString("Reveal in sidebar"),this._handleContextMenuReveal.bind(this,n))}_appendUISourceCodeFrameItems(e,t,i){i instanceof Ei&&(i.uiSourceCode().contentType().isFromSourceMap()||i.textEditor.selection().isEmpty()||t.debugSection().appendAction("debugger.evaluate-selection"))}appendUILocationItems(t,i){if(!(i instanceof Ie.UILocation))return;const s=i,n=s.uiSourceCode;if(n.contentType().hasScripts()){const i=v.Context.instance().flavor(Se.Target),o=i?i.model(be.DebuggerModel):null;o&&o.isPaused()&&t.debugSection().appendItem(e.UIString("Continue to here"),this._continueToLocation.bind(this,s)),this._callstackPane.appendBlackboxURLContextMenuItems(t,n)}}_handleContextMenuReveal(e){this.editorView.showBoth(),this._revealInNavigator(e)}_appendRemoteObjectItems(e,t){if(!(t instanceof ve.RemoteObject))return;const i=t,s=v.Context.instance().flavor(Ee.ExecutionContext);e.debugSection().appendItem(ls`Store as global variable`,()=>xe.ConsoleModel.instance().saveToTempVariable(s,i)),"function"===i.type&&e.debugSection().appendItem(ls`Show function definition`,this._showFunctionDefinition.bind(this,i))}_appendNetworkRequestItems(t,i){if(!(i instanceof ye.NetworkRequest))return;const s=i,n=this._workspace.uiSourceCodeForURL(s.url());if(!n)return;const o=e.UIString("Open in Sources panel");t.revealSection().appendItem(o,this.showUILocation.bind(this,n.uiLocation(0,0)))}_showFunctionDefinition(e){e.debuggerModel().functionDetailsPromise(e).then(this._didGetFunctionDetails.bind(this))}async _didGetFunctionDetails(e){if(!e||!e.location)return;const t=await te.DebuggerWorkspaceBinding.instance().rawLocationToUILocation(e.location);t&&this.showUILocation(t)}_revealNavigatorSidebar(){this._setAsCurrentPanel(),this.editorView.showBoth(!0)}_revealDebuggerSidebar(){this._setAsCurrentPanel(),this._splitWidget.showBoth(!0)}_updateSidebarPosition(){let e;const t=r.Settings.instance().moduleSetting("sidebarPosition").get();if(e="right"!==t&&("bottom"===t||P.InspectorView.instance().element.offsetWidth<680),this.sidebarPaneView&&e===!this._splitWidget.isVertical())return;if(this.sidebarPaneView&&this.sidebarPaneView.shouldHideOnDetach())return;this.sidebarPaneView&&this.sidebarPaneView.detach(),this._splitWidget.setVertical(!e),this._splitWidget.element.classList.toggle("sources-split-view-vertical",e),Ji.updateResizerAndSidebarButtons(this);const i=new u.VBox;i.element.appendChild(this._debugToolbar.element),i.element.appendChild(this._debugToolbarDrawer),i.setMinimumAndPreferredSizes(Xi,25,Xi,100),this._sidebarPaneStack=y.ViewManager.instance().createStackLocation(this._revealDebuggerSidebar.bind(this)),this._sidebarPaneStack.widget().element.classList.add("overflow-auto"),this._sidebarPaneStack.widget().show(i.element),this._sidebarPaneStack.widget().element.appendChild(this._debuggerPausedMessage.element()),this._sidebarPaneStack.appendApplicableItems("sources.sidebar-top"),this._threadsSidebarPane&&this._sidebarPaneStack.showView(this._threadsSidebarPane),e||this._sidebarPaneStack.appendView(this._watchSidebarPane),this._sidebarPaneStack.showView(this._callstackPane);const s=y.ViewManager.instance().view("sources.jsBreakpoints"),n=y.ViewManager.instance().view("sources.scopeChain");if(this._tabbedLocationHeader&&(this._splitWidget.uninstallResizer(this._tabbedLocationHeader),this._tabbedLocationHeader=null),e){const e=new O.SplitWidget(!0,!0,"sourcesPanelDebuggerSidebarSplitViewState",.5);e.setMainWidget(i),this._sidebarPaneStack.showView(s);const t=y.ViewManager.instance().createTabbedLocation(this._revealDebuggerSidebar.bind(this));e.setSidebarWidget(t.tabbedPane()),this._tabbedLocationHeader=t.tabbedPane().headerElement(),this._splitWidget.installResizer(this._tabbedLocationHeader),this._splitWidget.installResizer(this._debugToolbar.gripElementForResize()),t.appendView(n),t.appendView(this._watchSidebarPane),t.appendApplicableItems("sources.sidebar-tabs"),this._extensionSidebarPanesContainer=t,this.sidebarPaneView=e}else this._sidebarPaneStack.showView(n),this._sidebarPaneStack.showView(s),this._extensionSidebarPanesContainer=this._sidebarPaneStack,this.sidebarPaneView=i,this._splitWidget.uninstallResizer(this._debugToolbar.gripElementForResize());this._sidebarPaneStack.appendApplicableItems("sources.sidebar-bottom");const o=Ye.ExtensionServer.instance().sidebarPanes();for(let e=0;e<o.length;++e)this._addExtensionSidebarPane(o[e]);this._splitWidget.setSidebarWidget(this.sidebarPaneView)}_setAsCurrentPanel(){return y.ViewManager.instance().showView("sources")}_extensionSidebarPaneAdded(e){const t=e.data;this._addExtensionSidebarPane(t)}_addExtensionSidebarPane(e){e.panelName()===this.name&&this._extensionSidebarPanesContainer.appendView(e)}sourcesView(){return this._sourcesView}_handleDrop(e){const t=e.items;if(!t.length)return;const i=t[0].webkitGetAsEntry();i.isDirectory&&ce.InspectorFrontendHostInstance.upgradeDraggedFileSystemPermissions(i.filesystem)}}let Qi=200;const Xi=215;class Yi extends u.VBox{constructor(){super(),this.element.classList.add("sources-view-wrapper"),Yi._instance=this,this._view=Ji.instance()._sourcesView}static isShowing(){return!!Yi._instance&&Yi._instance.isShowing()}wasShown(){Ji.instance().isShowing()?P.InspectorView.instance().setDrawerMinimized(!0):this._showViewInWrapper(),Ji.updateResizerAndSidebarButtons(Ji.instance())}willHide(){P.InspectorView.instance().setDrawerMinimized(!1),setImmediate(()=>Ji.updateResizerAndSidebarButtons(Ji.instance()))}_showViewInWrapper(){this._view.show(this.element)}}var Zi=Object.freeze({__proto__:null,SourcesPanel:Ji,get lastModificationTimeout(){return Qi},minToolbarWidth:Xi,UILocationRevealer:class{reveal(e,t){return e instanceof Ie.UILocation?(Ji.instance().showUILocation(e,t),Promise.resolve()):Promise.reject(new Error("Internal error: not a ui location"))}},DebuggerLocationRevealer:class{async reveal(e,t){if(!(e instanceof be.Location))throw new Error("Internal error: not a debugger location");const i=await te.DebuggerWorkspaceBinding.instance().rawLocationToUILocation(e);i&&Ji.instance().showUILocation(i,t)}},UISourceCodeRevealer:class{reveal(e,t){return e instanceof Ie.UISourceCode?(Ji.instance().showUISourceCode(e,void 0,void 0,t),Promise.resolve()):Promise.reject(new Error("Internal error: not a ui source code"))}},DebuggerPausedDetailsRevealer:class{reveal(e){return Ji.instance()._setAsCurrentPanel()}},RevealingActionDelegate:class{handleAction(e,t){const i=Ji.instance();if(!i._ensureSourcesViewVisible())return!1;switch(t){case"debugger.toggle-pause":return i._togglePause(),!0}return!1}},DebuggingActionDelegate:class{handleAction(e,t){const i=Ji.instance();switch(t){case"debugger.step-over":return i._stepOver(),!0;case"debugger.step-into":return i._stepIntoAsync(),!0;case"debugger.step":return i._stepInto(),!0;case"debugger.step-out":return i._stepOut(),!0;case"debugger.run-snippet":return i._runSnippet(),!0;case"debugger.toggle-breakpoints-active":return i._toggleBreakpointsActive(),!0;case"debugger.evaluate-selection":{const e=v.Context.instance().flavor(Ei);if(e){let t=e.textEditor.text(e.textEditor.selection());const i=v.Context.instance().flavor(Ee.ExecutionContext);if(i){const e=xe.ConsoleModel.instance().addCommandMessage(i,t);t=$.JavaScriptREPL.wrapObjectLiteral(t),xe.ConsoleModel.instance().evaluateCommandInConsole(i,e,t,!0)}}return!0}}return!1}},WrapperView:Yi});class es extends ft{constructor(e,t,i){super(),this._textEditor=e,this._uiSourceCode=t,this._transformer=i,this._executionLocation=null,this._controlDown=!1,this._asyncStepInHoveredLine=0,this._asyncStepInHovered=!1,this._clearValueWidgetsTimer=null,this._sourceMapInfobar=null,this._controlTimeout=null,this._scriptsPanel=Ji.instance(),this._breakpointManager=re.BreakpointManager.instance(),t.project().type()===ke.projectTypes.Debugger&&this._textEditor.element.classList.add("source-frame-debugger-script"),this._popoverHelper=new B.PopoverHelper(this._scriptsPanel.element,this._getPopoverRequest.bind(this)),this._popoverHelper.setDisableOnClick(!0),this._popoverHelper.setTimeout(250,250),this._popoverHelper.setHasPadding(!0),this._boundPopoverHelperHide=this._popoverHelper.hidePopover.bind(this._popoverHelper),this._scriptsPanel.element.addEventListener("scroll",this._boundPopoverHelperHide,!0);const s={"debugger.toggle-breakpoint":async()=>{const e=this._textEditor.selection();return!!e&&(await this._toggleBreakpoint(e.startLine,!1),!0)},"debugger.toggle-breakpoint-enabled":async()=>{const e=this._textEditor.selection();return!!e&&(await this._toggleBreakpoint(e.startLine,!0),!0)},"debugger.breakpoint-input-window":async()=>{const e=this._textEditor.selection();if(!e)return!1;const t=this._lineBreakpointDecorations(e.startLine).map(e=>e.breakpoint).filter(e=>!!e);let i;t.length&&(i=t[0]);const s=!!i&&i.condition().includes(lt);return this._editBreakpointCondition(e.startLine,i,null,s),!0}};F.ShortcutRegistry.instance().addShortcutListener(this._textEditor.element,s),this._boundKeyDown=this._onKeyDown.bind(this),this._textEditor.element.addEventListener("keydown",this._boundKeyDown,!0),this._boundKeyUp=this._onKeyUp.bind(this),this._textEditor.element.addEventListener("keyup",this._boundKeyUp,!0),this._boundMouseMove=this._onMouseMove.bind(this),this._textEditor.element.addEventListener("mousemove",this._boundMouseMove,!1),this._boundMouseDown=this._onMouseDown.bind(this),this._textEditor.element.addEventListener("mousedown",this._boundMouseDown,!0),this._boundBlur=this._onBlur.bind(this),this._textEditor.element.addEventListener("focusout",this._boundBlur,!1),this._boundWheel=e=>{this._executionLocation&&I.KeyboardShortcut.eventHasCtrlOrMeta(e)&&e.preventDefault()},this._textEditor.element.addEventListener("wheel",this._boundWheel,!0),this._boundGutterClick=this._handleGutterClick.bind(this),this._textEditor.addEventListener(We.Events.GutterClick,this._boundGutterClick,this),this._breakpointManager.addEventListener(re.Events.BreakpointAdded,this._breakpointAdded,this),this._breakpointManager.addEventListener(re.Events.BreakpointRemoved,this._breakpointRemoved,this),this._uiSourceCode.addEventListener(Ie.Events.WorkingCopyChanged,this._workingCopyChanged,this),this._uiSourceCode.addEventListener(Ie.Events.WorkingCopyCommitted,this._workingCopyCommitted,this),this._breakpointDecorations=new Set,this._decorationByBreakpoint=new Map,this._possibleBreakpointsRequested=new Set,this._scriptFileForDebuggerModel=new Map,r.Settings.instance().moduleSetting("skipStackFramesPattern").addChangeListener(this._showBlackboxInfobarIfNeeded,this),r.Settings.instance().moduleSetting("skipContentScripts").addChangeListener(this._showBlackboxInfobarIfNeeded,this),this._valueWidgets=new Map,this._continueToLocationDecorations=null,v.Context.instance().addFlavorChangeListener(be.CallFrame,this._callFrameChanged,this),this._liveLocationPool=new Z.LiveLocationPool,this._callFrameChanged(),this._updateScriptFiles(),this._uiSourceCode.isDirty()?(this._muted=!0,this._mutedFromStart=!0):(this._muted=!1,this._mutedFromStart=!1,this._initializeBreakpoints()),this._blackboxInfobar=null,this._showBlackboxInfobarIfNeeded();for(const e of this._scriptFileForDebuggerModel.values())e.checkMapping();this._hasLineWithoutMapping=!1,this._updateLinesWithoutMappingHighlight(),Y.experiments.isEnabled("sourcesPrettyPrint")||(this._prettyPrintInfobar=null,this._detectMinified())}static accepts(e){return e.contentType().hasScripts()}_showBlackboxInfobarIfNeeded(){const t=this._uiSourceCode;if(!t.contentType().hasScripts())return;const i=t.project().type();if(!ee.BlackboxManager.instance().isBlackboxedUISourceCode(t))return void this._hideBlackboxInfobar();this._blackboxInfobar&&this._blackboxInfobar.dispose();const s=new H.Infobar(H.Type.Warning,e.UIString("This script is blackboxed in the debugger"),[{text:ls`Unblackbox`,highlight:!1,delegate:function(){ee.BlackboxManager.instance().unblackboxUISourceCode(t),i===ke.projectTypes.ContentScripts&&ee.BlackboxManager.instance().unblackboxContentScripts()},dismiss:!0},{text:ls`Configure`,highlight:!1,delegate:y.ViewManager.instance().showView.bind(y.ViewManager.instance(),"blackbox"),dismiss:!1}]);this._blackboxInfobar=s,s.createDetailsRowMessage(e.UIString("The debugger will skip stepping through this script, and will not stop on exceptions."));const n=this._scriptFileForDebuggerModel.size?this._scriptFileForDebuggerModel.values().next().value:null;n&&n.hasSourceMapURL()&&s.createDetailsRowMessage(e.UIString("Source map found, but ignored for blackboxed file.")),this._textEditor.attachInfobar(this._blackboxInfobar)}_hideBlackboxInfobar(){this._blackboxInfobar&&(this._blackboxInfobar.dispose(),this._blackboxInfobar=null)}wasShown(){this._executionLocation&&setImmediate(()=>{this._generateValuesInSource()})}willHide(){this._popoverHelper.hidePopover()}populateLineGutterContextMenu(t,i){return new Promise(function(s,n){const o=new Ie.UILocation(this._uiSourceCode,i,0);this._scriptsPanel.appendUILocationItems(t,o);const r=this._lineBreakpointDecorations(i).map(e=>e.breakpoint).filter(e=>!!e);if(r.length){const s=1===r.length,n=s?e.UIString("Remove breakpoint"):e.UIString("Remove all breakpoints in line");t.debugSection().appendItem(n,()=>r.map(e=>e.remove())),s&&t.debugSection().appendItem(e.UIString("Edit breakpoint…"),this._editBreakpointCondition.bind(this,i,r[0],null));if(r.some(e=>e.enabled())){const i=s?e.UIString("Disable breakpoint"):e.UIString("Disable all breakpoints in line");t.debugSection().appendItem(i,()=>r.map(e=>e.setEnabled(!1)))}if(r.some(e=>!e.enabled())){const i=s?e.UIString("Enable breakpoint"):e.UIString("Enable all breakpoints in line");t.debugSection().appendItem(i,()=>r.map(e=>e.setEnabled(!0)))}}else t.debugSection().appendItem(e.UIString("Add breakpoint"),this._createNewBreakpoint.bind(this,i,"",!0)),t.debugSection().appendItem(e.UIString("Add conditional breakpoint…"),this._editBreakpointCondition.bind(this,i,null,null)),t.debugSection().appendItem(ls`Add logpoint…`,this._editBreakpointCondition.bind(this,i,null,null,!0)),t.debugSection().appendItem(e.UIString("Never pause here"),this._createNewBreakpoint.bind(this,i,"false",!0));s()}.bind(this))}populateTextAreaContextMenu(t,i,s){function n(e){new rt(o.bind(null,e)).show()}function o(e,t){t&&e.addSourceMapURL(t)}return super.populateTextAreaContextMenu(t,i,s).then(function(){if(this._uiSourceCode.project().type()===ke.projectTypes.Network&&r.Settings.instance().moduleSetting("jsSourceMapsEnabled").get()&&!ee.BlackboxManager.instance().isBlackboxedUISourceCode(this._uiSourceCode)&&this._scriptFileForDebuggerModel.size){const i=this._scriptFileForDebuggerModel.values().next().value,s=e.UIString("Add source map…");t.debugSection().appendItem(s,n.bind(null,i))}}.bind(this))}_workingCopyChanged(){this._scriptFileForDebuggerModel.size||(this._uiSourceCode.isDirty()?this._muteBreakpointsWhileEditing():this._restoreBreakpointsAfterEditing())}_workingCopyCommitted(e){this._scriptsPanel.updateLastModificationTime(),this._scriptFileForDebuggerModel.size||this._restoreBreakpointsAfterEditing()}_didMergeToVM(){this._restoreBreakpointsIfConsistentScripts()}_didDivergeFromVM(){this._muteBreakpointsWhileEditing()}_muteBreakpointsWhileEditing(){if(!this._muted){for(const e of this._breakpointDecorations)this._updateBreakpointDecoration(e);this._muted=!0}}async _restoreBreakpointsIfConsistentScripts(){for(const e of this._scriptFileForDebuggerModel.values())if(e.hasDivergedFromVM()||e.isMergingToVM())return;await this._restoreBreakpointsAfterEditing()}async _restoreBreakpointsAfterEditing(){if(this._muted=!1,this._mutedFromStart)return this._mutedFromStart=!1,void this._initializeBreakpoints();const e=Array.from(this._breakpointDecorations);this._breakpointDecorations.clear(),this._textEditor.operation(()=>e.map(e=>e.hide()));for(const t of e){if(!t.breakpoint)continue;const e=t.enabled;t.breakpoint.remove();const i=t.handle.resolve();i&&await this._setBreakpoint(i.lineNumber,i.columnNumber,t.condition,e)}}_isIdentifier(e){return e.startsWith("js-variable")||e.startsWith("js-property")||"js-def"===e||"variable"===e}_getPopoverRequest(e){if(I.KeyboardShortcut.eventHasCtrlOrMeta(e))return null;const t=v.Context.instance().flavor(Se.Target),i=t?t.model(be.DebuggerModel):null;if(!i||!i.isPaused())return null;const s=this._textEditor.coordinatesToCursorPosition(e.x,e.y);if(!s)return null;const n=s.startLine,o=s.startColumn,r=this._textEditor.selection().normalize();let a,c,l,d;const h=v.Context.instance().flavor(be.CallFrame);if(!h)return null;if(r&&!r.isEmpty()){if(r.startLine!==r.endLine||r.startLine!==n||o<r.startColumn||o>r.endColumn)return null;const e=this._textEditor.cursorPositionToCoordinates(r.startLine,r.startColumn),t=this._textEditor.cursorPositionToCoordinates(r.endLine,r.endColumn);a=new AnchorBox(e.x,e.y,t.x-e.x,e.height),c=r.startLine,l=r.startColumn,d=r.endColumn-1}else if("application/wasm"===this._uiSourceCode.mimeType()){const e=this._textEditor.tokenAtTextPosition(s.startLine,s.startColumn);if(!e||"variable-2"!==e.type)return null;const t=this._textEditor.cursorPositionToCoordinates(s.startLine,e.startColumn),i=this._textEditor.cursorPositionToCoordinates(s.startLine,e.endColumn-1);a=new AnchorBox(t.x,t.y,i.x-t.x,t.height),c=s.startLine,l=e.startColumn,d=e.endColumn-1}else{const e=this._textEditor.tokenAtTextPosition(s.startLine,s.startColumn);if(!e||!e.type)return null;c=s.startLine;const t=this._textEditor.line(c),i=t.substring(e.startColumn,e.endColumn);if(!this._isIdentifier(e.type)&&("js-keyword"!==e.type||"this"!==i))return null;const n=this._textEditor.cursorPositionToCoordinates(c,e.startColumn),o=this._textEditor.cursorPositionToCoordinates(c,e.endColumn-1);for(a=new AnchorBox(n.x,n.y,o.x-n.x,n.height),l=e.startColumn,d=e.endColumn-1;l>1&&"."===t.charAt(l-1);){const e=this._textEditor.tokenAtTextPosition(c,l-2);if(!e||!e.type)return null;if("js-meta"===e.type)break;if("js-string-2"===e.type){if(e.endColumn<2)return null;if(l=t.lastIndexOf("`",e.endColumn-2),l<0)return null;break}l=e.startColumn}}let u,p;return{box:a,show:async e=>{const t=this._textEditor.line(c).substring(l,d+1),s=await async function(e,t){if(h.script.isWasm()&&h.sourceScopeChain){for(const e of h.sourceScopeChain){const i=await e.getVariableValue(t);if(i)return{object:i}}return null}const i=await Rt(h,t,e,c,l,d);return await h.evaluate({expression:i||t,objectGroup:"popover",includeCommandLineAPI:!1,silent:!0,returnByValue:!1,generatePreview:!1})}(this._uiSourceCode,t);if(!s||!s.object||"object"===s.object.type&&"error"===s.object.subtype)return!1;u=await J.ObjectPopoverHelper.buildObjectPopover(s.object,e);const n=v.Context.instance().flavor(be.CallFrame);if(!u||h!==n)return i.runtimeModel().releaseObjectGroup("popover"),u&&u.dispose(),!1;const o=new Ke.TextRange(c,l,c,d);return p=this._textEditor.highlightRange(o,"source-frame-eval-expression"),!0},hide:()=>{u.dispose(),i.runtimeModel().releaseObjectGroup("popover"),this._textEditor.removeHighlight(p)}}}async _onKeyDown(e){(!e.ctrlKey||!e.metaKey&&le.isMac())&&this._clearControlDown(),"Escape"!==e.key?I.KeyboardShortcut.eventHasCtrlOrMeta(e)&&this._executionLocation&&(this._controlDown=!0,e.key===(le.isMac()?"Meta":"Control")&&(this._controlTimeout=setTimeout(()=>{this._executionLocation&&this._controlDown&&this._showContinueToLocations()},150))):this._popoverHelper.isPopoverVisible()&&(this._popoverHelper.hidePopover(),e.consume())}_onMouseMove(e){if(this._executionLocation&&this._controlDown&&I.KeyboardShortcut.eventHasCtrlOrMeta(e)&&(this._continueToLocationDecorations||this._showContinueToLocations()),this._continueToLocationDecorations){const t=this._textEditor.coordinatesToCursorPosition(e.x,e.y),i=!!e.target.enclosingNodeOrSelfWithClass("source-frame-async-step-in");this._setAsyncStepInHoveredLine(t?t.startLine:null,i)}}_setAsyncStepInHoveredLine(e,t){this._asyncStepInHoveredLine===e&&this._asyncStepInHovered===t||(this._asyncStepInHovered&&this._asyncStepInHoveredLine&&this._textEditor.toggleLineClass(this._asyncStepInHoveredLine,"source-frame-async-step-in-hovered",!1),this._asyncStepInHoveredLine=e,this._asyncStepInHovered=t,this._asyncStepInHovered&&this._asyncStepInHoveredLine&&this._textEditor.toggleLineClass(this._asyncStepInHoveredLine,"source-frame-async-step-in-hovered",!0))}_onMouseDown(e){if(!this._executionLocation||!I.KeyboardShortcut.eventHasCtrlOrMeta(e))return;if(!this._continueToLocationDecorations)return;e.consume();const t=this._textEditor.coordinatesToCursorPosition(e.x,e.y);if(t)for(const e of this._continueToLocationDecorations.keys()){const i=e.find();if(i.from.line===t.startLine&&i.to.line===t.startLine&&(i.from.ch<=t.startColumn&&t.startColumn<=i.to.ch)){this._continueToLocationDecorations.get(e)();break}}}_onBlur(e){this._clearControlDown()}_onKeyUp(e){this._clearControlDown()}_clearControlDown(){this._controlDown=!1,this._clearContinueToLocations(),clearTimeout(this._controlTimeout)}async _editBreakpointCondition(e,t,i,s){const n=t?t.condition():"",o=createElement("div"),r=new ct(e,n,!!s,async s=>{r.detach(),this._textEditor.removeDecoration(o,e),s.committed&&(t?t.setCondition(s.condition):i?await this._setBreakpoint(i.lineNumber,i.columnNumber,s.condition,!0):await this._createNewBreakpoint(e,s.condition,!0))});this._textEditor.addDecoration(o,e),r.markAsExternallyManaged(),r.show(o)}async _executionLineChanged(e){this._clearExecutionLine();const t=await e.uiLocation();if(!t||t.uiSourceCode.url()!==this._uiSourceCode.url())return void(this._executionLocation=null);this._executionLocation=t;const i=this._transformer.uiLocationToEditorLocation(t.lineNumber,t.columnNumber);this._textEditor.setExecutionLocation(i.lineNumber,i.columnNumber),this._textEditor.isShowing()&&setImmediate(()=>{this._controlDown?this._showContinueToLocations():this._generateValuesInSource()})}_generateValuesInSource(){if(!r.Settings.instance().moduleSetting("inlineVariableValues").get())return;if(!v.Context.instance().flavor(Ee.ExecutionContext))return;const e=v.Context.instance().flavor(be.CallFrame);if(!e)return;const t=e.localScope(),i=e.functionLocation();t&&i&&Ot(t).getAllProperties(!1,!1).then(this._prepareScopeVariables.bind(this,e))}_showContinueToLocations(){this._popoverHelper.hidePopover();if(!v.Context.instance().flavor(Ee.ExecutionContext))return;const e=v.Context.instance().flavor(be.CallFrame);if(!e)return;const t=e.functionLocation()||e.location();function i(e){this._clearContinueToLocationsNoRestore(),this._textEditor.hideExecutionLineBackground(),this._continueToLocationDecorations=new Map,e=e.reverse();let t=-1;for(const i of e){const e=this._transformer.uiLocationToEditorLocation(i.lineNumber,i.columnNumber);let s=this._textEditor.tokenAtTextPosition(e.lineNumber,e.columnNumber);if(!s)continue;const n=this._textEditor.line(e.lineNumber);let o=n.substring(s.startColumn,s.endColumn);if(s.type||"."!==o||(s=this._textEditor.tokenAtTextPosition(e.lineNumber,s.endColumn+1),o=n.substring(s.startColumn,s.endColumn)),!s.type)continue;if(!("js-keyword"===s.type&&("this"===o||"return"===o||"new"===o||"continue"===o||"break"===o))&&!this._isIdentifier(s.type))continue;if(t===e.lineNumber&&i.type!==Protocol.Debugger.BreakLocationType.Call)continue;let r=new Ke.TextRange(e.lineNumber,s.startColumn,e.lineNumber,s.endColumn-1),a=this._textEditor.highlightRange(r,"source-frame-continue-to-location");this._continueToLocationDecorations.set(a,i.continueToLocation.bind(i)),i.type===Protocol.Debugger.BreakLocationType.Call&&(t=e.lineNumber);let c="."===n[s.startColumn-1]&&"then"===o||"setTimeout"===o||"setInterval"===o||"postMessage"===o;"new"===o&&(s=this._textEditor.tokenAtTextPosition(e.lineNumber,s.endColumn+1),o=n.substring(s.startColumn,s.endColumn),c="Worker"===o);const l=this._executionLocation&&i.lineNumber===this._executionLocation.lineNumber&&i.columnNumber===this._executionLocation.columnNumber;if(i.type===Protocol.Debugger.BreakLocationType.Call&&c){const t=this._findAsyncStepInRange(this._textEditor,e.lineNumber,n,s.endColumn);t&&(r=new Ke.TextRange(e.lineNumber,t.from,e.lineNumber,t.to-1),a=this._textEditor.highlightRange(r,"source-frame-async-step-in"),this._continueToLocationDecorations.set(a,this._asyncStepIn.bind(this,i,!!l)))}}this._continueToLocationRenderedForTest()}e.debuggerModel.getPossibleBreakpoints(t,null,!0).then(e=>this._textEditor.operation(i.bind(this,e)))}_continueToLocationRenderedForTest(){}_findAsyncStepInRange(e,t,i,s){let n,o,r=s,a=i.length,c=i.indexOf("(",s);const l=c;if(-1===c)return null;if(c++,u(),c>=i.length)return null;if(h(),!n)return null;if(r=n.startColumn,"js-keyword"===n.type&&"async"===o){if(u(),c>=i.length)return{from:r,to:a};if(h(),!n)return{from:r,to:a}}if("js-keyword"===n.type&&"function"===o)return{from:r,to:a};if("js-string"===n.type)return{from:l,to:a};if(n.type&&this._isIdentifier(n.type))return{from:r,to:a};if("("!==o)return null;const d=i.indexOf(")",c);return-1===d||-1!==i.substring(c,d).indexOf("(")?{from:r,to:a}:{from:r,to:d+1};function h(){n=e.tokenAtTextPosition(t,c),n&&(c=n.endColumn,a=n.endColumn,o=i.substring(n.startColumn,n.endColumn))}function u(){for(;c<i.length;){if(" "===i[c]){c++;continue}const s=e.tokenAtTextPosition(t,c);if("js-comment"!==s.type)break;c=s.endColumn}}}_asyncStepIn(e,t){function i(){e.debuggerModel.scheduleStepIntoAsync()}t?i():e.continueToLocation(i)}async _prepareScopeVariables(e,t){const i=t.properties;if(this._clearValueWidgets(),!i||!i.length||i.length>500||!this._textEditor.isShowing())return;const s=te.DebuggerWorkspaceBinding.instance().rawLocationToUILocation(e.functionLocation()),n=te.DebuggerWorkspaceBinding.instance().rawLocationToUILocation(e.location()),[o,r]=await Promise.all([s,n]);if(!o||!r||o.uiSourceCode.url()!==this._uiSourceCode.url()||r.uiSourceCode.url()!==this._uiSourceCode.url())return;const a=this._transformer.uiLocationToEditorLocation(o.lineNumber,o.columnNumber),c=this._transformer.uiLocationToEditorLocation(r.lineNumber,r.columnNumber),l=a.lineNumber,d=a.columnNumber,h=c.lineNumber;if(l>=h||h-l>500||l<0||h>=this._textEditor.linesCount)return;const u=new Map;for(const e of i)u.set(e.name,e.value);const p=new Map;let _=!1;const m=(new Xe.TokenizerFactory).createTokenizer("text/javascript");m(this._textEditor.line(l).substring(d),g.bind(this,l));for(let e=l+1;e<h;++e)m(this._textEditor.line(e),g.bind(this,e));function g(e,t,i,s,n){if(!_&&i&&this._isIdentifier(i)&&u.get(t)){let i=p.get(e);i||(i=new Set,p.set(e,i)),i.add(t)}_="."===t}this._textEditor.operation(this._renderDecorations.bind(this,u,p,l,h))}_renderDecorations(e,t,i,s){const n=new Q.RemoteObjectPreviewFormatter;for(let o=i;o<s;++o){const i=t.get(o),s=this._valueWidgets.get(o);if(!i){s&&(this._valueWidgets.delete(o),this._textEditor.removeDecoration(s,o));continue}const r=document.createElement("div");r.classList.add("text-editor-value-decoration");const a=this._textEditor.cursorPositionToCoordinates(o,0),c=4,l=this._textEditor.cursorPositionToCoordinates(o,this._textEditor.line(o).length).x-a.x+c;r.style.left=l+"px",r.__nameToToken=new Map;let d=0;for(const s of i){if(d>10)break;if(t.get(o-1)&&t.get(o-1).has(s))continue;d&&p.createTextChild(r,", ");const i=r.createChild("span");r.__nameToToken.set(s,i),p.createTextChild(i,s+" = ");const a=e.get(s),c=a.preview?a.preview.properties.length:0,l=a.preview&&a.preview.entries?a.preview.entries.length:0;if(a.preview&&c+l<10)n.appendObjectPreview(i,a.preview,!1);else{const e=X.ObjectPropertiesSection.createPropertyValue(a,!1,!1);i.appendChild(e.element)}++d}let h=!0;if(s){h=!1;for(const e of r.__nameToToken.keys()){const t=s.__nameToToken.get(e)?s.__nameToToken.get(e).textContent:"";(r.__nameToToken.get(e)?r.__nameToToken.get(e).textContent:"")!==t&&(h=!0,p.runCSSAnimationOnce(r.__nameToToken.get(e),"source-frame-value-update-highlight"))}h&&(this._valueWidgets.delete(o),this._textEditor.removeDecoration(s,o))}h&&(this._valueWidgets.set(o,r),this._textEditor.addDecoration(r,o))}}_clearExecutionLine(){this._textEditor.operation(()=>{this._executionLocation&&this._textEditor.clearExecutionLine(),this._executionLocation=null,this._clearValueWidgetsTimer&&(clearTimeout(this._clearValueWidgetsTimer),this._clearValueWidgetsTimer=null),this._clearValueWidgetsTimer=setTimeout(this._clearValueWidgets.bind(this),1e3),this._clearContinueToLocationsNoRestore()})}_clearValueWidgets(){clearTimeout(this._clearValueWidgetsTimer),this._clearValueWidgetsTimer=null,this._textEditor.operation(()=>{for(const e of this._valueWidgets.keys())this._textEditor.removeDecoration(this._valueWidgets.get(e),e);this._valueWidgets.clear()})}_clearContinueToLocationsNoRestore(){this._continueToLocationDecorations&&this._textEditor.operation(()=>{for(const e of this._continueToLocationDecorations.keys())this._textEditor.removeHighlight(e);this._continueToLocationDecorations=null,this._setAsyncStepInHoveredLine(null,!1)})}_clearContinueToLocations(){this._continueToLocationDecorations&&this._textEditor.operation(()=>{this._textEditor.showExecutionLineBackground(),this._generateValuesInSource(),this._clearContinueToLocationsNoRestore()})}_lineBreakpointDecorations(e){return Array.from(this._breakpointDecorations).filter(t=>(t.handle.resolve()||{}).lineNumber===e)}_breakpointDecoration(e,t){for(const i of this._breakpointDecorations){const s=i.handle.resolve();if(s&&(s.lineNumber===e&&s.columnNumber===t))return i}return null}_updateBreakpointDecoration(e){function t(){if(!this._scheduledBreakpointDecorationUpdates)return;const e=new Set;for(const t of this._scheduledBreakpointDecorationUpdates){const i=t.handle.resolve();i&&e.add(i.lineNumber)}this._scheduledBreakpointDecorationUpdates=null;let t=!1;for(const n of e){const e=this._lineBreakpointDecorations(n);i.call(this,n,e),this._possibleBreakpointsRequested.has(n)?t=!0:s.call(this,n,e)}t||this._breakpointDecorationsUpdatedForTest()}function i(e,t){if(this._textEditor.toggleLineClass(e,"cm-breakpoint",!1),this._textEditor.toggleLineClass(e,"cm-breakpoint-disabled",!1),this._textEditor.toggleLineClass(e,"cm-breakpoint-unbound",!1),this._textEditor.toggleLineClass(e,"cm-breakpoint-conditional",!1),this._textEditor.toggleLineClass(e,"cm-breakpoint-logpoint",!1),t.length){t.sort(ts.mostSpecificFirst);const i=!t[0].enabled||this._muted,s=t[0].condition.includes(lt),n=!t[0].bound,o=!!t[0].condition&&!s;this._textEditor.toggleLineClass(e,"cm-breakpoint",!0),this._textEditor.toggleLineClass(e,"cm-breakpoint-disabled",i),this._textEditor.toggleLineClass(e,"cm-breakpoint-unbound",n&&!i),this._textEditor.toggleLineClass(e,"cm-breakpoint-logpoint",s),this._textEditor.toggleLineClass(e,"cm-breakpoint-conditional",o)}}function s(e,t){const i=new Set(t.map(e=>e.bookmark).filter(e=>!!e)),s=this._textEditor.line(e).length,n=this._textEditor.bookmarks(new Ke.TextRange(e,0,e,s),ts.bookmarkSymbol);for(const e of n)i.has(e)||e.clear();if(t.length)if(t.length>1)for(const e of t)e.update(),this._muted?e.hide():e.show();else t[0].update(),t[0].hide()}this._scheduledBreakpointDecorationUpdates||(this._scheduledBreakpointDecorationUpdates=new Set,setImmediate(()=>this._textEditor.operation(t.bind(this)))),this._scheduledBreakpointDecorationUpdates.add(e)}_breakpointDecorationsUpdatedForTest(){}async _inlineBreakpointClick(e,t){if(t.consume(!0),e.breakpoint)t.shiftKey?e.breakpoint.setEnabled(!e.breakpoint.enabled()):e.breakpoint.remove();else{const t=e.handle.resolve();if(!t)return;const i=this._transformer.editorLocationToUILocation(t.lineNumber,t.columnNumber);await this._setBreakpoint(i.lineNumber,i.columnNumber,e.condition,!0)}}_inlineBreakpointContextMenu(t,i){i.consume(!0);const s=t.handle.resolve();if(!s)return;if(this._textEditor.hasLineClass(s.lineNumber,"cm-non-breakable-line"))return;const n=this._transformer.editorLocationToUILocation(s.lineNumber,s.columnNumber),o=new x.ContextMenu(i);t.breakpoint?o.debugSection().appendItem(e.UIString("Edit breakpoint…"),this._editBreakpointCondition.bind(this,s.lineNumber,t.breakpoint,null)):(o.debugSection().appendItem(e.UIString("Add conditional breakpoint…"),this._editBreakpointCondition.bind(this,s.lineNumber,null,s)),o.debugSection().appendItem(ls`Add logpoint…`,this._editBreakpointCondition.bind(this,s.lineNumber,null,s,!0)),o.debugSection().appendItem(e.UIString("Never pause here"),this._setBreakpoint.bind(this,n.lineNumber,n.columnNumber,"false",!0))),o.show()}_shouldIgnoreExternalBreakpointEvents(e){if(e.data.uiLocation.uiSourceCode!==this._uiSourceCode)return!0;if(this._muted)return!0;for(const e of this._scriptFileForDebuggerModel.values())if(e.isDivergingFromVM()||e.isMergingToVM())return!0;return!1}_breakpointAdded(e){if(this._shouldIgnoreExternalBreakpointEvents(e))return;const t=e.data.uiLocation,i=e.data.breakpoint;this._addBreakpoint(t,i)}_addBreakpoint(e,t){const i=this._transformer.uiLocationToEditorLocation(e.lineNumber,e.columnNumber),s=this._lineBreakpointDecorations(e.lineNumber);let n=this._breakpointDecoration(i.lineNumber,i.columnNumber);if(n)n.breakpoint=t,n.condition=t.condition(),n.enabled=t.enabled();else{const e=this._textEditor.textEditorPositionHandle(i.lineNumber,i.columnNumber);n=new ts(this._textEditor,e,t.condition(),t.enabled(),t.bound()||!t.hasBoundScript(),t),n.element.addEventListener("click",this._inlineBreakpointClick.bind(this,n),!0),n.element.addEventListener("contextmenu",this._inlineBreakpointContextMenu.bind(this,n),!0),this._breakpointDecorations.add(n)}if(this._decorationByBreakpoint.set(t,n),this._updateBreakpointDecoration(n),t.enabled()&&!s.length){this._possibleBreakpointsRequested.add(i.lineNumber);const e=this._transformer.editorLocationToUILocation(i.lineNumber,0),t=this._transformer.editorLocationToUILocation(i.lineNumber+1,0);this._breakpointManager.possibleBreakpoints(this._uiSourceCode,new Ke.TextRange(e.lineNumber,e.columnNumber,t.lineNumber,t.columnNumber)).then(function(e,t){this._possibleBreakpointsRequested.delete(e);const i=this._lineBreakpointDecorations(e);for(const e of i)this._updateBreakpointDecoration(e);if(!i.some(e=>!!e.breakpoint))return;const s=new Set;for(const e of i){const t=e.handle.resolve();t&&s.add(t.columnNumber)}for(const i of t.slice(0,100)){const t=this._transformer.uiLocationToEditorLocation(i.lineNumber,i.columnNumber);if(t.lineNumber!==e)continue;if(s.has(t.columnNumber))continue;const n=this._textEditor.textEditorPositionHandle(t.lineNumber,t.columnNumber),o=new ts(this._textEditor,n,"",!1,!1,null);o.element.addEventListener("click",this._inlineBreakpointClick.bind(this,o),!0),o.element.addEventListener("contextmenu",this._inlineBreakpointContextMenu.bind(this,o),!0),this._breakpointDecorations.add(o),this._updateBreakpointDecoration(o)}}.bind(this,i.lineNumber))}}_breakpointRemoved(e){if(this._shouldIgnoreExternalBreakpointEvents(e))return;const t=e.data.uiLocation,i=e.data.breakpoint,s=this._decorationByBreakpoint.get(i);if(!s)return;this._decorationByBreakpoint.delete(i);const n=this._transformer.uiLocationToEditorLocation(t.lineNumber,t.columnNumber);s.breakpoint=null,s.enabled=!1;const o=this._lineBreakpointDecorations(n.lineNumber);if(o.some(e=>!!e.breakpoint))this._updateBreakpointDecoration(s);else for(const e of o)this._breakpointDecorations.delete(e),this._updateBreakpointDecoration(e)}_initializeBreakpoints(){const e=this._breakpointManager.breakpointLocationsForUISourceCode(this._uiSourceCode);for(const t of e)this._addBreakpoint(t.uiLocation,t.breakpoint)}_updateLinesWithoutMappingHighlight(){if(!!ne.CompilerScriptMapping.uiSourceCodeOrigin(this._uiSourceCode)){const e=this._textEditor.linesCount;for(let t=0;t<e;++t){const e=ne.CompilerScriptMapping.uiLineHasMapping(this._uiSourceCode,t);e||(this._hasLineWithoutMapping=!0),this._hasLineWithoutMapping&&this._textEditor.toggleLineClass(t,"cm-non-breakable-line",!e)}}else;}_updateScriptFiles(){for(const e of Se.TargetManager.instance().models(be.DebuggerModel)){te.DebuggerWorkspaceBinding.instance().scriptFile(this._uiSourceCode,e)&&this._updateScriptFile(e)}}_updateScriptFile(e){const t=this._scriptFileForDebuggerModel.get(e),i=te.DebuggerWorkspaceBinding.instance().scriptFile(this._uiSourceCode,e);this._scriptFileForDebuggerModel.delete(e),t&&(t.removeEventListener(ae.ResourceScriptFile.Events.DidMergeToVM,this._didMergeToVM,this),t.removeEventListener(ae.ResourceScriptFile.Events.DidDivergeFromVM,this._didDivergeFromVM,this),this._muted&&!this._uiSourceCode.isDirty()&&this._restoreBreakpointsIfConsistentScripts()),i&&(this._scriptFileForDebuggerModel.set(e,i),i.addEventListener(ae.ResourceScriptFile.Events.DidMergeToVM,this._didMergeToVM,this),i.addEventListener(ae.ResourceScriptFile.Events.DidDivergeFromVM,this._didDivergeFromVM,this),i.checkMapping(),i.hasSourceMapURL()&&this._showSourceMapInfobar())}_showSourceMapInfobar(){this._sourceMapInfobar||(this._sourceMapInfobar=H.Infobar.create(H.Type.Info,e.UIString("Source Map detected."),[],r.Settings.instance().createSetting("sourceMapInfobarDisabled",!1)),this._sourceMapInfobar&&(this._sourceMapInfobar.createDetailsRowMessage(e.UIString("Associated files should be added to the file tree. You can debug these resolved source files as regular JavaScript files.")),this._sourceMapInfobar.createDetailsRowMessage(e.UIString("Associated files are available via file tree or %s.",F.ShortcutRegistry.instance().shortcutTitleForAction("quickOpen.show"))),this._sourceMapInfobar.setCloseCallback(()=>{this._sourceMapInfobar=null}),this._textEditor.attachInfobar(this._sourceMapInfobar)))}async _detectMinified(){const t=this._uiSourceCode.content();if(!t||!$e.isMinified(t))return;const i=await Y.Runtime.instance().allInstances(Sources.SourcesView.EditorAction);let s=null;for(const e of i)if(e instanceof Sources.ScriptFormatterEditorAction){if(!e.isCurrentUISourceCodeFormatable())return;s=e.toggleFormatScriptSource.bind(e);break}if(this._prettyPrintInfobar=H.Infobar.create(H.Type.Info,e.UIString("Pretty-print this minified file?"),[{text:ls`Pretty-print`,delegate:s,highlight:!0,dismiss:!0}],r.Settings.instance().createSetting("prettyPrintInfobarDisabled",!1)),!this._prettyPrintInfobar)return;this._prettyPrintInfobar.setCloseCallback(()=>{this._prettyPrintInfobar=null});const n=new g.Toolbar(""),o=new g.ToolbarButton("","largeicon-pretty-print");n.appendToolbarItem(o),n.element.style.display="inline-block",n.element.style.verticalAlign="middle",n.element.style.marginBottom="3px",n.element.style.pointerEvents="none",n.element.tabIndex=-1;this._prettyPrintInfobar.createDetailsRowMessage().appendChild(p.formatLocalized("Pretty-printing will format this file in a new tab where you can continue debugging. You can also pretty-print this file by clicking the %s button on the bottom status bar.",[n.element])),this._textEditor.attachInfobar(this._prettyPrintInfobar)}async _handleGutterClick(e){if(this._muted)return;const t=e.data;if(t.gutterType!==We.lineNumbersGutterType)return;const i=t.lineNumber,s=t.event;0!==s.button||s.altKey||s.ctrlKey||s.metaKey||(await this._toggleBreakpoint(i,s.shiftKey),s.consume(!0))}async _toggleBreakpoint(e,t){const i=this._lineBreakpointDecorations(e);if(!i.length)return void await this._createNewBreakpoint(e,"",!0);const s=this._textEditor.hasLineClass(e,"cm-breakpoint-disabled"),n=i.map(e=>e.breakpoint).filter(e=>!!e);for(const e of n)t?e.setEnabled(s):e.remove()}async _createNewBreakpoint(e,t,i){if(this._textEditor.hasLineClass(e,"cm-non-breakable-line"))return;de.actionTaken(he.Action.ScriptsBreakpointSet);const s=this._transformer.editorLocationToUILocation(e,0);await this._setBreakpoint(s.lineNumber,s.columnNumber,t,i)}async _setBreakpoint(e,t,i,s){r.Settings.instance().moduleSetting("breakpointsActive").set(!0),await this._breakpointManager.setBreakpoint(this._uiSourceCode,e,t,i,s),this._breakpointWasSetForTest(e,t,i,s)}_breakpointWasSetForTest(e,t,i,s){}async _callFrameChanged(){this._liveLocationPool.disposeAll();const e=v.Context.instance().flavor(be.CallFrame);e?await te.DebuggerWorkspaceBinding.instance().createCallFrameLiveLocation(e.location(),this._executionLineChanged.bind(this),this._liveLocationPool):this._clearExecutionLine()}dispose(){for(const e of this._breakpointDecorations)e.dispose();if(this._breakpointDecorations.clear(),this._scheduledBreakpointDecorationUpdates){for(const e of this._scheduledBreakpointDecorationUpdates)e.dispose();this._scheduledBreakpointDecorationUpdates.clear()}this._hideBlackboxInfobar(),this._sourceMapInfobar&&this._sourceMapInfobar.dispose(),this._prettyPrintInfobar&&this._prettyPrintInfobar.dispose(),this._scriptsPanel.element.removeEventListener("scroll",this._boundPopoverHelperHide,!0);for(const e of this._scriptFileForDebuggerModel.values())e.removeEventListener(ae.ResourceScriptFile.Events.DidMergeToVM,this._didMergeToVM,this),e.removeEventListener(ae.ResourceScriptFile.Events.DidDivergeFromVM,this._didDivergeFromVM,this);this._scriptFileForDebuggerModel.clear(),this._textEditor.element.removeEventListener("keydown",this._boundKeyDown,!0),this._textEditor.element.removeEventListener("keyup",this._boundKeyUp,!0),this._textEditor.element.removeEventListener("mousemove",this._boundMouseMove,!1),this._textEditor.element.removeEventListener("mousedown",this._boundMouseDown,!0),this._textEditor.element.removeEventListener("focusout",this._boundBlur,!1),this._textEditor.element.removeEventListener("wheel",this._boundWheel,!0),this._textEditor.removeEventListener(We.Events.GutterClick,this._boundGutterClick,this),this._popoverHelper.hidePopover(),this._popoverHelper.dispose(),this._breakpointManager.removeEventListener(re.Events.BreakpointAdded,this._breakpointAdded,this),this._breakpointManager.removeEventListener(re.Events.BreakpointRemoved,this._breakpointRemoved,this),this._uiSourceCode.removeEventListener(Ie.Events.WorkingCopyChanged,this._workingCopyChanged,this),this._uiSourceCode.removeEventListener(Ie.Events.WorkingCopyCommitted,this._workingCopyCommitted,this),r.Settings.instance().moduleSetting("skipStackFramesPattern").removeChangeListener(this._showBlackboxInfobarIfNeeded,this),r.Settings.instance().moduleSetting("skipContentScripts").removeChangeListener(this._showBlackboxInfobarIfNeeded,this),super.dispose(),this._clearExecutionLine(),v.Context.instance().removeFlavorChangeListener(be.CallFrame,this._callFrameChanged,this),this._liveLocationPool.disposeAll()}}class ts{constructor(e,t,i,s,n,o){this._textEditor=e,this.handle=t,this.condition=i,this.enabled=s,this.bound=n,this.breakpoint=o,this.element=document.createElement("span"),this.element.classList.toggle("cm-inline-breakpoint",!0),this.bookmark=null}static mostSpecificFirst(e,t){return e.enabled!==t.enabled?e.enabled?-1:1:e.bound!==t.bound?e.bound?-1:1:!!e.condition!=!!t.condition?e.condition?-1:1:0}update(){const e=!!this.condition&&this.condition.includes(lt),t=!!this.condition&&!e;this.element.classList.toggle("cm-inline-logpoint",e),this.element.classList.toggle("cm-inline-breakpoint-conditional",t),this.element.classList.toggle("cm-inline-disabled",!this.enabled)}show(){if(this.bookmark)return;const e=this.handle.resolve();e&&(this.bookmark=this._textEditor.addBookmark(e.lineNumber,e.columnNumber,this.element,ts.bookmarkSymbol),this.bookmark[ts._elementSymbolForTest]=this.element)}hide(){this.bookmark&&(this.bookmark.clear(),this.bookmark=null)}dispose(){const e=this.handle.resolve();e&&(this._textEditor.toggleLineClass(e.lineNumber,"cm-breakpoint",!1),this._textEditor.toggleLineClass(e.lineNumber,"cm-breakpoint-disabled",!1),this._textEditor.toggleLineClass(e.lineNumber,"cm-breakpoint-unbound",!1),this._textEditor.toggleLineClass(e.lineNumber,"cm-breakpoint-conditional",!1),this._textEditor.toggleLineClass(e.lineNumber,"cm-breakpoint-logpoint",!1)),this.hide()}}ts.bookmarkSymbol=Symbol("bookmark"),ts._elementSymbolForTest=Symbol("element");const is=Symbol("bookmark");var ss=Object.freeze({__proto__:null,DebuggerPlugin:es,BreakpointDecoration:ts,continueToLocationDecorationSymbol:is});class ns{constructor(e){this._query=e,this._queryUpperCase=e.toUpperCase(),this._score=new Int32Array(2e3),this._sequence=new Int32Array(2e3),this._dataUpperCase="",this._fileNameIndex=0}score(e,t){if(!e||!this._query)return 0;const i=this._query.length,s=e.length;(!this._score||this._score.length<i*s)&&(this._score=new Int32Array(i*s*2),this._sequence=new Int32Array(i*s*2));const n=this._score,o=this._sequence;this._dataUpperCase=e.toUpperCase(),this._fileNameIndex=e.lastIndexOf("/");for(let t=0;t<i;++t)for(let i=0;i<s;++i){const r=0===i?0:n[t*s+i-1],a=0===t||0===i?0:n[(t-1)*s+i-1],c=0===t||0===i?0:o[(t-1)*s+i-1],l=this._match(this._query,e,t,i,c);l&&a+l>=r?(o[t*s+i]=c+1,n[t*s+i]=a+l):(o[t*s+i]=0,n[t*s+i]=r)}t&&this._restoreMatchIndexes(o,i,s,t);return 256*n[i*s-1]+(256-e.length)}_testWordStart(e,t){if(0===t)return!0;const i=e.charAt(t-1);return"_"===i||"-"===i||"/"===i||"."===i||" "===i||e[t-1]!==this._dataUpperCase[t-1]&&e[t]===this._dataUpperCase[t]}_restoreMatchIndexes(e,t,i,s){let n=t-1,o=i-1;for(;n>=0&&o>=0;)switch(e[n*i+o]){case 0:--o;break;default:s.push(o),--n,--o}s.reverse()}_singleCharScore(e,t,i,s){const n=this._testWordStart(t,s),o=s>this._fileNameIndex;let r=10;return(0===s||"/"===t[s-1])&&(r+=4),n&&(r+=2),e[i]===t[s]&&e[i]===this._queryUpperCase[i]&&(r+=6),o&&(r+=4),s===this._fileNameIndex+1&&0===i&&(r+=5),o&&n&&(r+=3),r}_sequenceCharScore(e,t,i,s,n){let o=10;return s>this._fileNameIndex&&(o+=4),(0===s||"/"===t[s-1])&&(o+=5),o+=4*n,o}_match(e,t,i,s,n){return this._queryUpperCase[i]!==this._dataUpperCase[s]?0:n?this._sequenceCharScore(e,t,i,s-n,n):this._singleCharScore(e,t,i,s)}}var os=Object.freeze({__proto__:null,FilePathScoreFunction:ns});class rs extends st.Provider{constructor(){super(),this._queryLineNumberAndColumnNumber="",this._defaultScores=null,this._scorer=new ns(""),this._uiSourceCodes=[],this._query}_projectRemoved(e){const t=e.data;this._populate(t),this.refresh()}_populate(e){this._uiSourceCodes=[];const t=ke.WorkspaceImpl.instance().projects().filter(this.filterProject.bind(this));for(let i=0;i<t.length;++i){if(e&&t[i]===e)continue;const s=t[i].uiSourceCodes().filter(this._filterUISourceCode.bind(this));this._uiSourceCodes=this._uiSourceCodes.concat(s)}}_filterUISourceCode(e){const t=ue.PersistenceImpl.instance().binding(e);return!t||t.fileSystem===e}uiSourceCodeSelected(e,t,i){}filterProject(e){return!0}itemCount(){return this._uiSourceCodes.length}itemKeyAt(e){return this._uiSourceCodes[e].url()}setDefaultScores(e){this._defaultScores=e}itemScoreAt(e,t){const i=this._uiSourceCodes[e],s=this._defaultScores&&this._defaultScores.get(i)||0;if(!t||t.length<2)return s;this._query!==t&&(this._query=t,this._scorer=new ns(t));let n=10;i.project().type()!==ke.projectTypes.FileSystem||ue.PersistenceImpl.instance().binding(i)||(n=5);const o=i.fullDisplayName();return s+n*this._scorer.score(o,null)}renderItem(e,t,i,s){t=this.rewriteQuery(t);const n=this._uiSourceCodes[e],o=n.fullDisplayName(),r=[];new ns(t).score(o,r);const a=o.lastIndexOf("/");i.classList.add("monospace"),s.classList.add("monospace"),i.textContent=n.displayName()+(this._queryLineNumberAndColumnNumber||""),this._renderSubtitleElement(s,o),s.title=o;const c=[];for(let e=0;e<r.length;++e)c.push({offset:r[e],length:1});if(r[0]>a){for(let e=0;e<c.length;++e)c[e].offset-=a+1;p.highlightRangesWithStyleClass(i,c,"highlight")}else p.highlightRangesWithStyleClass(s,c,"highlight")}_renderSubtitleElement(e,t){e.removeChildren();let i=t.lastIndexOf("/");t.length>55&&(i=t.length-55);e.createChild("div","first-part").textContent=t.substring(0,i);e.createChild("div","second-part").textContent=t.substring(i),e.title=t}selectItem(e,t){const i=t.trim().match(/^([^:]*)(:\d+)?(:\d+)?$/);if(!i)return;let s,n;i[2]&&(s=parseInt(i[2].substr(1),10)-1),i[3]&&(n=parseInt(i[3].substr(1),10)-1);const o=null!==e?this._uiSourceCodes[e]:null;this.uiSourceCodeSelected(o,s,n)}rewriteQuery(e){if(!(e=e?e.trim():"")||":"===e)return"";const t=e.match(/^([^:]+)((?::[^:]*){0,2})$/);return this._queryLineNumberAndColumnNumber=t?t[2]:"",t?t[1]:e}_uiSourceCodeAdded(e){const t=e.data;this._filterUISourceCode(t)&&this.filterProject(t.project())&&(this._uiSourceCodes.push(t),this.refresh())}notFoundText(){return e.UIString("No files found")}attach(){ke.WorkspaceImpl.instance().addEventListener(ke.Events.UISourceCodeAdded,this._uiSourceCodeAdded,this),ke.WorkspaceImpl.instance().addEventListener(ke.Events.ProjectRemoved,this._projectRemoved,this),this._populate()}detach(){ke.WorkspaceImpl.instance().removeEventListener(ke.Events.UISourceCodeAdded,this._uiSourceCodeAdded,this),ke.WorkspaceImpl.instance().removeEventListener(ke.Events.ProjectRemoved,this._projectRemoved,this),this._queryLineNumberAndColumnNumber="",this._defaultScores=null}}var as=Object.freeze({__proto__:null,FilteredUISourceCodeListProvider:rs});class cs extends st.Provider{selectItem(e,t){const s=this._currentUISourceCode();if(!s)return;const n=this._parsePosition(t);n&&i.reveal(s.uiLocation(n.line-1,n.column-1))}notFoundText(t){if(!this._currentUISourceCode())return e.UIString("No file selected.");const i=this._parsePosition(t);if(!i){const e=this._currentSourceFrame();if(!e)return ls`Type a number to go to that line.`;const t=e.textEditor.currentLineNumber()+1,i=e.textEditor.linesCount;return ls`Current line: ${t}. Type a line number between 1 and ${i} to navigate to.`}return i.column&&i.column>1?ls`Go to line ${i.line} and column ${i.column}.`:ls`Go to line ${i.line}.`}_parsePosition(e){const t=e.match(/([0-9]+)(\:[0-9]*)?/);if(!t||!t[0]||t[0].length!==e.length)return null;const i=parseInt(t[1],10);let s=0;return t[2]&&(s=parseInt(t[2].substring(1),10)),{line:Math.max(0|i,1),column:Math.max(0|s,1)}}_currentUISourceCode(){const e=v.Context.instance().flavor(Oi);return e?e.currentUISourceCode():null}_currentSourceFrame(){const e=v.Context.instance().flavor(Oi);return e?e.currentSourceFrame():null}}var ds=Object.freeze({__proto__:null,GoToLineQuickOpen:cs});var hs=Object.freeze({__proto__:null,InplaceFormatterEditorAction:class{constructor(){this._button,this._sourcesView}_editorSelected(e){const t=e.data;this._updateButton(t)}_editorClosed(e){e.data.wasSelected&&this._updateButton(null)}_updateButton(t){const i=this._isFormattable(t);this._button.element.classList.toggle("hidden",!i),t&&i&&this._button.setTitle(e.UIString("Format "+t.name()))}button(t){return this._button||(this._sourcesView=t,this._sourcesView.addEventListener(Wi.EditorSelected,this._editorSelected.bind(this)),this._sourcesView.addEventListener(Wi.EditorClosed,this._editorClosed.bind(this)),this._button=new g.ToolbarButton(e.UIString("Format"),"largeicon-pretty-print"),this._button.addEventListener(g.ToolbarButton.Events.Click,this._formatSourceInPlace,this),this._updateButton(t.currentUISourceCode())),this._button}_isFormattable(e){return!!e&&(!!e.project().canSetFileContent()||(!!ue.PersistenceImpl.instance().binding(e)||e.contentType().isStyleSheet()))}_formatSourceInPlace(e){const t=this._sourcesView.currentUISourceCode();t&&this._isFormattable(t)&&(t.isDirty()?this._contentLoaded(t,t.workingCopy()):t.requestContent().then(e=>{this._contentLoaded(t,e.content||"")}))}_contentLoaded(e,t){const i=e.mimeType();Fe.FormatterInterface.format(e.contentType(),i,t,(t,i)=>{this._formattingComplete(e,t,i)})}_formattingComplete(e,t,i){if(e.workingCopy()===t)return;const s=this._sourcesView.viewForFile(e);let n=[0,0];if(s){const e=s.selection();n=i.originalToFormatted(e.startLine,e.startColumn)}e.setWorkingCopy(t),this._sourcesView.showSourceLocation(e,n[0],n[1])}}});class us extends z.ThrottledWidget{constructor(){super(!0),this.registerRequiredCSS("sources/javaScriptBreakpointsSidebarPane.css"),this._breakpointManager=re.BreakpointManager.instance(),this._breakpointManager.addEventListener(re.Events.BreakpointAdded,this.update,this),this._breakpointManager.addEventListener(re.Events.BreakpointRemoved,this.update,this),r.Settings.instance().moduleSetting("breakpointsActive").addChangeListener(this.update,this),this._breakpoints=new C.ListModel,this._list=new f.ListControl(this._breakpoints,this,f.ListMode.NonViewport),w.markAsList(this._list.element),this.contentElement.appendChild(this._list.element),this._emptyElement=this.contentElement.createChild("div","gray-info-message"),this._emptyElement.textContent=ls`No breakpoints`,this._emptyElement.tabIndex=-1,this.update()}_getBreakpointLocations(){const e=this._breakpointManager.allBreakpointLocations().filter(e=>e.uiLocation.uiSourceCode.project().type()!==ke.projectTypes.Debugger);e.sort((e,t)=>e.uiLocation.compareTo(t.uiLocation));const t=[];let i=null,s=null;for(const n of e)(n.breakpoint!==i||s&&n.uiLocation.compareTo(s))&&(t.push(n),i=n.breakpoint,s=n.uiLocation);return t}_hideList(){this._list.element.classList.add("hidden"),this._emptyElement.classList.remove("hidden")}_ensureListShown(){this._list.element.classList.remove("hidden"),this._emptyElement.classList.add("hidden")}_groupBreakpointLocationsById(e){const t=new Re;for(const i of e){const e=i.uiLocation;t.set(e.id(),i)}const i=[];for(const e of t.keysArray()){const s=Array.from(t.get(e));s.length&&i.push(s)}return i}_getLocationIdsByLineId(e){const t=new Re;for(const i of e){const e=i.uiLocation;t.set(e.lineId(),e.id())}return t}async _getSelectedUILocation(){const e=v.Context.instance().flavor(be.DebuggerPausedDetails);return e&&e.callFrames.length?await te.DebuggerWorkspaceBinding.instance().rawLocationToUILocation(e.callFrames[0].location()):null}_getContent(e){const t=new Map;return Promise.all(e.map(async([{uiLocation:{uiSourceCode:e}}])=>{if("application/wasm"===e.mimeType())return new Je.Text("");const{content:i}=await e.requestContent(),s=i||"";if(t.has(s))return t.get(s);const n=new Je.Text(s);return t.set(s,n),n}))}async doUpdate(){const e=this.hasFocus(),t=this._getBreakpointLocations();if(!t.length)return this._hideList(),this._setBreakpointItems([]),this._didUpdateForTest();this._ensureListShown();const i=this._groupBreakpointLocationsById(t),s=this._getLocationIdsByLineId(t),n=await this._getContent(i),o=await this._getSelectedUILocation(),a=[];for(let e=0;e<i.length;e++){const t=i[e],r=t[0].uiLocation,c=!!o&&t.some(e=>e.uiLocation.id()===o.id()),l=s.get(r.lineId()).size>1,d=n[e];a.push(new ps(t,d,c,l))}return a.some(e=>e.isSelected)&&y.ViewManager.instance().showView("sources.jsBreakpoints"),this._list.element.classList.toggle("breakpoints-list-deactivated",!r.Settings.instance().moduleSetting("breakpointsActive").get()),this._setBreakpointItems(a),e&&this.focus(),this._didUpdateForTest()}_setBreakpointItems(e){if(this._breakpoints.length===e.length)for(let t=0;t<this._breakpoints.length;t++)this._breakpoints.at(t).isSimilar(e[t])||this._breakpoints.replace(t,e[t]);else this._breakpoints.replaceAll(e)}createElementForItem(e){const t=document.createElement("div");t.classList.add("breakpoint-entry"),w.markAsListitem(t),t.tabIndex=this._list.selectedItem()===e?0:-1,t.addEventListener("contextmenu",this._breakpointContextMenu.bind(this),!0),t.addEventListener("click",this._revealLocation.bind(this,t),!1);const i=p.CheckboxLabel.create(""),s=e.locations[0].uiLocation,n=e.locations.some(e=>e.breakpoint.enabled()),o=e.locations.some(e=>!e.breakpoint.enabled());i.textElement.textContent=s.linkText()+(e.showColumn?":"+(s.columnNumber+1):""),i.checkboxElement.checked=n,i.checkboxElement.indeterminate=n&&o,i.checkboxElement.tabIndex=-1,i.addEventListener("click",this._breakpointCheckboxClicked.bind(this),!1),t.appendChild(i);let r=n?ls`checked`:ls`unchecked`;n&&o&&(r=ls`mixed`),e.isSelected?(w.setDescription(t,ls`${r} breakpoint hit`),t.classList.add("breakpoint-hit"),this.setDefaultFocusedElement(t)):w.setDescription(t,r),t.addEventListener("keydown",e=>{" "===e.key&&(i.checkboxElement.click(),e.consume(!0))});const a=t.createChild("div","source-text monospace"),c=s.lineNumber;if(e.text&&c<e.text.lineCount()){const t=e.text.lineAt(c),i=200;a.textContent=t.substring(e.showColumn?s.columnNumber:0).trimEndWithMaxLength(i)}return ms.set(t,e.locations),_s.set(t,s),t}heightForItem(e){return 0}isItemSelectable(e){return!0}selectedItemChanged(e,t,i,s){i&&(i.tabIndex=-1),s&&(s.tabIndex=0,this.setDefaultFocusedElement(s),this.hasFocus()&&s.focus())}updateSelectedItemARIA(e,t){return!0}_breakpointLocations(e){return e.target instanceof Element?this._breakpointLocationsForElement(e.target):[]}_breakpointLocationsForElement(e){const t=e.enclosingNodeOrSelfWithClass("breakpoint-entry");return t&&ms.get(t)||[]}_breakpointCheckboxClicked(e){const t=this.hasFocus(),i=this._breakpointLocations(e).map(e=>e.breakpoint),s=e.target.checkboxElement.checked;for(const e of i){e.setEnabled(s);const t=this._breakpoints.find(t=>t.locations.some(t=>t.breakpoint===e));t&&this._list.refreshItem(t)}t&&this.focus(),e.consume()}_revealLocation(e){const t=this._breakpointLocationsForElement(e).map(e=>e.uiLocation);let s=null;for(const e of t)(!s||e.columnNumber<s.columnNumber)&&(s=e);s&&i.reveal(s)}_breakpointContextMenu(t){const i=this._breakpointLocations(t).map(e=>e.breakpoint),s=new x.ContextMenu(t),n=i.length>1?e.UIString("Remove all breakpoints in line"):e.UIString("Remove breakpoint");s.defaultSection().appendItem(n,()=>i.map(e=>e.remove(!1))),t.target instanceof Element&&s.defaultSection().appendItem(ls`Reveal location`,this._revealLocation.bind(this,t.target));const o=r.Settings.instance().moduleSetting("breakpointsActive").get(),a=o?e.UIString("Deactivate breakpoints"):e.UIString("Activate breakpoints");if(s.defaultSection().appendItem(a,()=>r.Settings.instance().moduleSetting("breakpointsActive").set(!o)),i.some(e=>!e.enabled())){const i=e.UIString("Enable all breakpoints");if(s.defaultSection().appendItem(i,this._toggleAllBreakpoints.bind(this,!0)),t.target instanceof Element){const i=e.UIString("Enable breakpoints in file");s.defaultSection().appendItem(i,this._toggleAllBreakpointsInFile.bind(this,t.target,!0))}}if(i.some(e=>e.enabled())){const i=e.UIString("Disable all breakpoints");if(s.defaultSection().appendItem(i,this._toggleAllBreakpoints.bind(this,!1)),t.target instanceof Element){const i=e.UIString("Disable breakpoints in file");s.defaultSection().appendItem(i,this._toggleAllBreakpointsInFile.bind(this,t.target,!1))}}const c=e.UIString("Remove all breakpoints");s.defaultSection().appendItem(c,this._removeAllBreakpoints.bind(this));const l=e.UIString("Remove other breakpoints");s.defaultSection().appendItem(l,this._removeOtherBreakpoints.bind(this,new Set(i))),s.show()}_toggleAllBreakpointsInFile(e,t){const i=this._getBreakpointLocations(),s=this._breakpointLocationsForElement(e);i.forEach(e=>{s.some(t=>t.breakpoint.url()===e.breakpoint.url())&&e.breakpoint.setEnabled(t)})}_toggleAllBreakpoints(e){for(const t of this._breakpointManager.allBreakpointLocations())t.breakpoint.setEnabled(e)}_removeAllBreakpoints(){for(const e of this._breakpointManager.allBreakpointLocations())e.breakpoint.remove(!1)}_removeOtherBreakpoints(e){for(const t of this._breakpointManager.allBreakpointLocations())e.has(t.breakpoint)||t.breakpoint.remove(!1)}flavorChanged(e){this.update()}_didUpdateForTest(){}}class ps{constructor(e,t,i,s){this.locations=e,this.text=t,this.isSelected=i,this.showColumn=s}isSimilar(e){return this.locations.length===e.locations.length&&this.locations.every((t,i)=>t.uiLocation===e.locations[i].uiLocation)&&this.locations.every((t,i)=>t.breakpoint===e.locations[i].breakpoint)&&(this.text===e.text||this.text&&e.text&&this.text.value()===e.text.value())&&this.isSelected===e.isSelected&&this.showColumn===e.showColumn}}const _s=new WeakMap;const ms=new WeakMap;var gs=Object.freeze({__proto__:null,JavaScriptBreakpointsSidebarPane:us,retrieveLocationForElement:function(e){return _s.get(e)},BreakpointLocation:void 0});var bs=Object.freeze({__proto__:null,OpenFileQuickOpen:class extends rs{attach(){this.setDefaultScores(Oi.defaultUISourceCodeScores()),super.attach()}uiSourceCodeSelected(e,t,s){de.actionTaken(he.Action.SelectFileFromFilePicker),e&&("number"==typeof t?i.reveal(e.uiLocation(t,s)):i.reveal(e))}filterProject(e){return!e.isServiceProject()}renderAsTwoRows(){return!0}}});class Ss extends st.Provider{constructor(){super(),this._items=[],this._active=!1}attach(){this._items=[],this._active=!1;const e=this._currentUISourceCode();e&&(this._active=Me.formatterWorkerPool().outlineForMimetype(e.workingCopy(),e.contentType().canonicalMimeType(),this._didBuildOutlineChunk.bind(this)))}_didBuildOutlineChunk(e,t){this._items.push(...t),this.refresh()}itemCount(){return this._items.length}itemKeyAt(e){const t=this._items[e];return t.title+(t.subtitle?t.subtitle:"")}itemScoreAt(e,t){const i=this._items[e];return t.split("(")[0].toLowerCase()===i.title.toLowerCase()?1/(1+i.line):-i.line-1}renderItem(e,t,i,s){const n=this._items[e];i.textContent=n.title+(n.subtitle?n.subtitle:""),st.FilteredListWidget.highlightRanges(i,t),s.textContent=":"+(n.line+1)}selectItem(e,t){if(null===e)return;const s=this._currentUISourceCode();if(!s)return;const n=this._items[e].line;!isNaN(n)&&n>=0&&i.reveal(s.uiLocation(n,this._items[e].column))}_currentUISourceCode(){const e=v.Context.instance().flavor(Oi);return e?e.currentUISourceCode():null}notFoundText(){return this._currentUISourceCode()?this._active?e.UIString("No results found"):e.UIString("Open a JavaScript or CSS file to see symbols"):e.UIString("No file selected.")}}var Cs=Object.freeze({__proto__:null,OutlineQuickOpen:Ss});class fs extends u.VBox{constructor(){super(!0),this.registerRequiredCSS("sources/scopeChainSidebarPane.css"),this._treeOutline=new X.ObjectPropertiesSectionsTreeOutline,this._treeOutline.registerRequiredCSS("sources/scopeChainSidebarPane.css"),this._treeOutline.setShowSelectionOnKeyboardFocus(!0),this._expandController=new X.ObjectPropertiesSectionsTreeExpandController(this._treeOutline),this._linkifier=new ot.Linkifier,this._infoElement=document.createElement("div"),this._infoElement.className="gray-info-message",this._infoElement.textContent=ls`Not paused`,this._infoElement.tabIndex=-1,this._update()}flavorChanged(e){this._update()}focus(){this.hasFocus()||v.Context.instance().flavor(be.DebuggerPausedDetails)&&this._treeOutline.forceSelect()}_getScopeChain(e){return e.sourceScopeChain||e.scopeChain()}_update(){const e=v.Context.instance().flavor(be.CallFrame),t=v.Context.instance().flavor(be.DebuggerPausedDetails);this._linkifier.reset(),Vt(e).then(this._innerUpdate.bind(this,t,e))}_innerUpdate(e,t,i){if(this._treeOutline.removeChildren(),this.contentElement.removeChildren(),!e||!t)return void this.contentElement.appendChild(this._infoElement);this.contentElement.appendChild(this._treeOutline.element);let s=!1;const n=this._getScopeChain(t);for(let o=0;o<n.length;++o){const r=n[o],a=this._extraPropertiesForScope(r,e,t,i,0===o);r.type()===Protocol.Debugger.ScopeType.Local&&(s=!0);const c=this._createScopeSectionTreeElement(r,a);r.type()===Protocol.Debugger.ScopeType.Global?c.collapse():s&&r.type()!==Protocol.Debugger.ScopeType.Local||c.expand(),this._treeOutline.appendChild(c),0===o&&c.select(!0)}this._sidebarPaneUpdatedForTest()}_createScopeSectionTreeElement(e,t){let i=null;(e.type()===Protocol.Debugger.ScopeType.Local||Protocol.Debugger.ScopeType.Closure)&&(i=ls`No variables`);let s=e.typeName();if(e.type()===Protocol.Debugger.ScopeType.Closure){const t=e.name();s=t?ls`Closure (${p.beautifyFunctionName(t)})`:ls`Closure`}let n=e.description();s&&s!==n||(n=null);const o=e.icon(),r=document.createElement("div");if(r.classList.add("scope-chain-sidebar-pane-section-header"),r.classList.add("tree-element-title"),o){const e=document.createElement("img");e.classList.add("scope-chain-sidebar-pane-section-icon"),e.src=o,r.appendChild(e)}r.createChild("div","scope-chain-sidebar-pane-section-subtitle").textContent=n,r.createChild("div","scope-chain-sidebar-pane-section-title").textContent=s;const a=new X.RootElement(Ot(e),this._linkifier,i,!0,t);return a.title=r,a.listItemElement.classList.add("scope-chain-sidebar-pane-section"),a.listItemElement.setAttribute("aria-label",s),this._expandController.watchSection(s+(n?":"+n:""),a),a}_extraPropertiesForScope(t,i,s,n,o){if(t.type()!==Protocol.Debugger.ScopeType.Local||s.script.isWasm())return[];const r=[];if(n&&r.push(new ve.RemoteObjectProperty("this",n)),o){const t=i.exception();t&&r.push(new ve.RemoteObjectProperty(e.UIString("Exception"),t,void 0,void 0,void 0,void 0,void 0,!0));const n=s.returnValue();n&&r.push(new ve.RemoteObjectProperty(e.UIString("Return value"),n,void 0,void 0,void 0,void 0,void 0,!0,s.setReturnValue.bind(s)))}return r}_sidebarPaneUpdatedForTest(){}}const vs=Symbol("path");var ws=Object.freeze({__proto__:null,ScopeChainSidebarPane:fs,pathSymbol:vs});var Es=Object.freeze({__proto__:null,ScriptFormatterEditorAction:class{constructor(){this._pathsToFormatOnLoad=new Set,this._sourcesView,this._button}_editorSelected(e){const t=e.data;this._updateButton(t),this._isFormatableScript(t)&&this._pathsToFormatOnLoad.has(t.url())&&!Pe.SourceFormatter.instance().hasFormatted(t)&&this._showFormatted(t)}async _editorClosed(e){const t=e.data.uiSourceCode;e.data.wasSelected&&this._updateButton(null);const i=await Pe.SourceFormatter.instance().discardFormattedUISourceCode(t);i&&this._pathsToFormatOnLoad.delete(i.url())}_updateButton(t){const i=this._isFormatableScript(t);this._button.element.classList.toggle("hidden",!i),t&&this._button.setTitle(e.UIString("Pretty print "+t.name()))}button(t){return this._button||(this._sourcesView=t,this._sourcesView.addEventListener(Wi.EditorSelected,e=>{this._editorSelected(e)}),this._sourcesView.addEventListener(Wi.EditorClosed,e=>{this._editorClosed(e)}),this._button=new g.ToolbarButton(e.UIString("Pretty print"),"largeicon-pretty-print"),this._button.addEventListener(g.ToolbarButton.Events.Click,this.toggleFormatScriptSource,this),this._updateButton(t.currentUISourceCode())),this._button}_isFormatableScript(e){return!!e&&(!e.project().canSetFileContent()&&(e.project().type()!==ke.projectTypes.Formatter&&(!ue.PersistenceImpl.instance().binding(e)&&("application/wasm"!==e.mimeType()&&e.contentType().hasScripts()))))}isCurrentUISourceCodeFormatable(){const e=this._sourcesView.currentUISourceCode();return this._isFormatableScript(e)}toggleFormatScriptSource(e){const t=this._sourcesView.currentUISourceCode();t&&this._isFormatableScript(t)&&(this._pathsToFormatOnLoad.add(t.url()),this._showFormatted(t))}async _showFormatted(e){const t=await Pe.SourceFormatter.instance().format(e);if(e!==this._sourcesView.currentUISourceCode())return;const i=this._sourcesView.viewForFile(e);let s=[0,0];if(i instanceof ze.SourceFrameImpl){const e=i.selection();s=t.mapping.originalToFormatted(e.startLine,e.startColumn)}this._sourcesView.showSourceLocation(t.formattedSourceCode,s[0],s[1])}}});var xs=Object.freeze({__proto__:null,NetworkNavigatorView:class extends Jt{constructor(){super(),Se.TargetManager.instance().addEventListener(Se.Events.InspectedURLChanged,this._inspectedURLChanged,this),de.panelLoaded("sources","DevTools.Launch.Sources")}acceptProject(e){return e.type()===ke.projectTypes.Network}_inspectedURLChanged(e){const t=Se.TargetManager.instance().mainTarget();if(e.data!==t)return;const i=t&&t.inspectedURL();if(i)for(const e of this.workspace().uiSourceCodes())this.acceptProject(e.project())&&e.url()===i&&this.revealUISourceCode(e,!0)}uiSourceCodeAdded(e){const t=Se.TargetManager.instance().mainTarget(),i=t&&t.inspectedURL();i&&e.url()===i&&this.revealUISourceCode(e,!0)}},FilesNavigatorView:class extends Jt{constructor(){super();const e=new q.EmptyWidget("");this.setPlaceholder(e),e.appendParagraph().appendChild(G.html`
      <div>${ls`Sync changes in DevTools with the local filesystem`}</div><br />
      ${R.XLink.create("https://developers.google.com/web/tools/chrome-devtools/workspaces/",ls`Learn more about Workspaces`)}
    `);const t=new g.Toolbar("navigator-toolbar");t.appendItemsAtLocation("files-navigator-toolbar").then(()=>{t.empty()||this.contentElement.insertBefore(t.element,this.contentElement.firstChild)})}acceptProject(e){return e.type()===ke.projectTypes.FileSystem&&"overrides"!==pe.FileSystemWorkspaceBinding.fileSystemType(e)&&!Ze.isSnippetsProject(e)}handleContextMenu(e){const t=new x.ContextMenu(e);t.defaultSection().appendAction("sources.add-folder-to-workspace",void 0,!0),t.show()}},OverridesNavigatorView:class extends Jt{constructor(){super();const e=new q.EmptyWidget("");this.setPlaceholder(e),e.appendParagraph().appendChild(G.html`
      <div>${ls`Override page assets with files from a local folder`}</div><br />
      ${R.XLink.create("https://developers.google.com/web/updates/2018/01/devtools#overrides",ls`Learn more`)}
    `),this._toolbar=new g.Toolbar("navigator-toolbar"),this.contentElement.insertBefore(this._toolbar.element,this.contentElement.firstChild),_e.NetworkPersistenceManager.instance().addEventListener(_e.Events.ProjectChanged,this._updateProjectAndUI,this),this.workspace().addEventListener(ke.Events.ProjectAdded,this._onProjectAddOrRemoved,this),this.workspace().addEventListener(ke.Events.ProjectRemoved,this._onProjectAddOrRemoved,this),this._updateProjectAndUI()}_onProjectAddOrRemoved(e){const t=e.data;t&&t.type()===ke.projectTypes.FileSystem&&"overrides"!==pe.FileSystemWorkspaceBinding.fileSystemType(t)||this._updateUI()}_updateProjectAndUI(){this.reset();const e=_e.NetworkPersistenceManager.instance().project();e&&this.tryAddProject(e),this._updateUI()}_updateUI(){this._toolbar.removeToolbarItems();const t=_e.NetworkPersistenceManager.instance().project();if(t){const i=new g.ToolbarSettingCheckbox(r.Settings.instance().moduleSetting("persistenceNetworkOverridesEnabled"));this._toolbar.appendToolbarItem(i),this._toolbar.appendToolbarItem(new g.ToolbarSeparator(!0));const s=new g.ToolbarButton(e.UIString("Clear configuration"),"largeicon-clear");return s.addEventListener(g.ToolbarButton.Events.Click,()=>{t.remove()}),void this._toolbar.appendToolbarItem(s)}const i=e.UIString("Select folder for overrides"),s=new g.ToolbarButton(i,"largeicon-add",i);s.addEventListener(g.ToolbarButton.Events.Click,e=>{this._setupNewWorkspace()},this),this._toolbar.appendToolbarItem(s)}async _setupNewWorkspace(){await ge.IsolatedFileSystemManager.instance().addFileSystem("overrides")&&r.Settings.instance().moduleSetting("persistenceNetworkOverridesEnabled").set(!0)}acceptProject(e){return e===_e.NetworkPersistenceManager.instance().project()}},ContentScriptsNavigatorView:class extends Jt{constructor(){super();const e=new q.EmptyWidget("");this.setPlaceholder(e),e.appendParagraph().appendChild(G.html`
      <div>${ls`Content scripts served by extensions appear here`}</div><br />
      ${R.XLink.create("https://developer.chrome.com/extensions/content_scripts",ls`Learn more`)}
    `)}acceptProject(e){return e.type()===ke.projectTypes.ContentScripts}},SnippetsNavigatorView:class extends Jt{constructor(){super();const t=new q.EmptyWidget("");this.setPlaceholder(t),t.appendParagraph().appendChild(G.html`
      <div>${ls`Create and save code snippets for later reuse`}</div><br />
      ${R.XLink.create("https://developers.google.com/web/tools/chrome-devtools/javascript/snippets",ls`Learn more`)}
    `);const i=new g.Toolbar("navigator-toolbar"),s=new g.ToolbarButton(ls`New snippet`,"largeicon-add",e.UIString("New snippet"));s.addEventListener(g.ToolbarButton.Events.Click,e=>{this.create(et,"")}),i.appendToolbarItem(s),this.contentElement.insertBefore(i.element,this.contentElement.firstChild)}acceptProject(e){return Ze.isSnippetsProject(e)}handleContextMenu(e){const t=new x.ContextMenu(e);t.headerSection().appendItem(ls`Create new snippet`,()=>this.create(et,"")),t.show()}handleFileContextMenu(t,i){const s=i.uiSourceCode(),n=new x.ContextMenu(t);n.headerSection().appendItem(e.UIString("Run"),()=>Ze.evaluateScriptSnippet(s)),n.editSection().appendItem(e.UIString("Rename…"),()=>this.rename(i,!1)),n.editSection().appendItem(e.UIString("Remove"),()=>s.project().deleteFile(s)),n.saveSection().appendItem(e.UIString("Save as..."),this._handleSaveAs.bind(this,s)),n.show()}async _handleSaveAs(e){e.commitWorkingCopy();const{content:t}=await e.requestContent();Le.FileManager.instance().save(e.url(),t||"",!0),Le.FileManager.instance().close(e.url())}},ActionDelegate:class{handleAction(e,t){switch(t){case"sources.create-snippet":return et.createFile("",null,"").then(e=>i.reveal(e)),!0;case"sources.add-folder-to-workspace":return ge.IsolatedFileSystemManager.instance().addFileSystem(),!0}return!1}}});class ys extends z.ThrottledWidget{constructor(){super(!0),this.registerRequiredCSS("object_ui/objectValue.css"),this.registerRequiredCSS("sources/watchExpressionsSidebarPane.css"),this._watchExpressions=[],this._emptyElement,this._watchExpressionsSetting=r.Settings.instance().createLocalSetting("watchExpressions",[]),this._addButton=new g.ToolbarButton(ls`Add watch expression`,"largeicon-add"),this._addButton.addEventListener(g.ToolbarButton.Events.Click,e=>{this._addButtonClicked()}),this._refreshButton=new g.ToolbarButton(ls`Refresh watch expressions`,"largeicon-refresh"),this._refreshButton.addEventListener(g.ToolbarButton.Events.Click,this.update,this),this.contentElement.classList.add("watch-expressions"),this.contentElement.addEventListener("contextmenu",this._contextMenu.bind(this),!1),this._treeOutline=new X.ObjectPropertiesSectionsTreeOutline,this._treeOutline.registerRequiredCSS("sources/watchExpressionsSidebarPane.css"),this._treeOutline.setShowSelectionOnKeyboardFocus(!0),this._expandController=new X.ObjectPropertiesSectionsTreeExpandController(this._treeOutline),v.Context.instance().addFlavorChangeListener(Ee.ExecutionContext,this.update,this),v.Context.instance().addFlavorChangeListener(be.CallFrame,this.update,this),this._linkifier=new ot.Linkifier,this.update()}toolbarItems(){return[this._addButton,this._refreshButton]}focus(){this.hasFocus()||this._watchExpressions.length>0&&this._treeOutline.forceSelect()}hasExpressions(){return!!this._watchExpressionsSetting.get().length}_saveExpressions(){const e=[];for(let t=0;t<this._watchExpressions.length;t++)this._watchExpressions[t].expression()&&e.push(this._watchExpressions[t].expression());this._watchExpressionsSetting.set(e)}async _addButtonClicked(){await y.ViewManager.instance().showView("sources.watch"),this._emptyElement.classList.add("hidden"),this._createWatchExpression(null).startEditing()}doUpdate(){this._linkifier.reset(),this.contentElement.removeChildren(),this._treeOutline.removeChildren(),this._watchExpressions=[],this._emptyElement=this.contentElement.createChild("div","gray-info-message"),this._emptyElement.textContent=e.UIString("No watch expressions"),this._emptyElement.tabIndex=-1;const t=this._watchExpressionsSetting.get();t.length&&this._emptyElement.classList.add("hidden");for(let e=0;e<t.length;++e){const i=t[e];i&&this._createWatchExpression(i)}return Promise.resolve()}_createWatchExpression(e){this.contentElement.appendChild(this._treeOutline.element);const t=new ks(e,this._expandController,this._linkifier);return t.addEventListener(ks.Events.ExpressionUpdated,this._watchExpressionUpdated,this),this._treeOutline.appendChild(t.treeElement()),this._watchExpressions.push(t),t}_watchExpressionUpdated(e){const t=e.data;t.expression()||(Oe.removeElement(this._watchExpressions,t),this._treeOutline.removeChild(t.treeElement()),this._emptyElement.classList.toggle("hidden",!!this._watchExpressions.length),0===this._watchExpressions.length&&this._treeOutline.element.remove()),this._saveExpressions()}_contextMenu(e){const t=new x.ContextMenu(e);this._populateContextMenu(t,e),t.show()}_populateContextMenu(t,i){let s=!1;for(const e of this._watchExpressions)s=s||e.isEditing();s||t.debugSection().appendItem(e.UIString("Add watch expression"),this._addButtonClicked.bind(this)),this._watchExpressions.length>1&&t.debugSection().appendItem(e.UIString("Delete all watch expressions"),this._deleteAllButtonClicked.bind(this));const n=this._treeOutline.treeElementFromEvent(i);if(!n)return;const o=this._watchExpressions.find(e=>n.hasAncestorOrSelf(e.treeElement()));o&&o._populateContextMenu(t,i)}_deleteAllButtonClicked(){this._watchExpressions=[],this._saveExpressions(),this.update()}_focusAndAddExpressionToWatch(e){y.ViewManager.instance().showView("sources.watch"),this.doUpdate(),this._addExpressionToWatch(e)}_addExpressionToWatch(e){this._createWatchExpression(e),this._saveExpressions(),this.update()}handleAction(e,t){const i=v.Context.instance().flavor(Ei);if(!i)return!1;const s=i.textEditor.text(i.textEditor.selection());return this._focusAndAddExpressionToWatch(s),!0}_addPropertyPathToWatch(e){this._addExpressionToWatch(e.path())}appendApplicableItems(e,t,i){i instanceof X.ObjectPropertyTreeElement&&!i.property.synthetic&&t.debugSection().appendItem(ls`Add property path to watch`,this._addPropertyPathToWatch.bind(this,i));const s=v.Context.instance().flavor(Ei);s&&!s.textEditor.selection().isEmpty()&&t.debugSection().appendAction("sources.add-to-watch")}}class ks extends h.ObjectWrapper{constructor(e,t,i){super(),this._treeElement,this._nameElement,this._valueElement,this._expression=e,this._expandController=t,this._element=document.createElement("div"),this._element.classList.add("watch-expression"),this._element.classList.add("monospace"),this._editing=!1,this._linkifier=i,this._createWatchExpression(),this.update()}treeElement(){return this._treeElement}expression(){return this._expression}update(){const e=v.Context.instance().flavor(Ee.ExecutionContext);e&&this._expression&&e.evaluate({expression:this._expression,objectGroup:ks._watchObjectGroupId,includeCommandLineAPI:!1,silent:!0,returnByValue:!1,generatePreview:!1,allowUnsafeEvalBlockedByCSP:void 0,disableBreaks:void 0,replMode:void 0,throwOnSideEffect:void 0,timeout:void 0},!1,!1).then(e=>{"object"in e&&this._createWatchExpression(e.object,e.exceptionDetails)})}startEditing(){this._editing=!0,this._element.removeChildren();const e=this._element.createChild("div");e.textContent=this._nameElement.textContent,this._textPrompt=new X.ObjectPropertyPrompt,this._textPrompt.renderAsBlock();const t=this._textPrompt.attachAndStartEditing(e,this._finishEditing.bind(this));this._treeElement.listItemElement.classList.add("watch-expression-editing"),this._treeElement.collapse(),t.classList.add("watch-expression-text-prompt-proxy"),t.addEventListener("keydown",this._promptKeyDown.bind(this),!1);const i=this._element.getComponentSelection();i&&i.selectAllChildren(e)}isEditing(){return!!this._editing}_finishEditing(e,t){if(e&&e.consume(t),this._editing=!1,this._treeElement.listItemElement.classList.remove("watch-expression-editing"),this._textPrompt){this._textPrompt.detach();const e=t?this._expression:this._textPrompt.text();this._textPrompt=void 0,this._element.removeChildren(),this._updateExpression(e)}}_dblClickOnWatchExpression(e){e.consume(),this.isEditing()||this.startEditing()}_updateExpression(e){this._expression&&this._expandController.stopWatchSectionsWithId(this._expression),this._expression=e,this.update(),this.dispatchEventToListeners(ks.Events.ExpressionUpdated,this)}_deleteWatchExpression(e){e.consume(!0),this._updateExpression(null)}_createWatchExpression(e,t){this._result=e||null,this._element.removeChildren();const i=this._treeElement;if(this._createWatchExpressionTreeElement(e,t),i&&i.parent){const e=i.parent,t=e.indexOfChild(i);e.removeChild(i),e.insertChild(this._treeElement,t)}this._treeElement.select()}_createWatchExpressionHeader(t,i){const s=this._element.createChild("div","watch-expression-header"),n=E.Icon.create("smallicon-cross","watch-expression-delete-button");n.title=ls`Delete watch expression`,n.addEventListener("click",this._deleteWatchExpression.bind(this),!1);const o=s.createChild("div","watch-expression-title tree-element-title");if(o.appendChild(n),this._nameElement=X.ObjectPropertiesSection.createNameElement(this._expression),i||!t)this._valueElement=document.createElement("span"),this._valueElement.classList.add("watch-expression-error"),this._valueElement.classList.add("value"),o.classList.add("dimmed"),this._valueElement.textContent=e.UIString("<not available>");else{const e=X.ObjectPropertiesSection.createPropertyValueWithCustomSupport(t,!!i,!1,o,this._linkifier);this._valueElement=e.element}const r=document.createElement("span");return r.classList.add("watch-expressions-separator"),r.textContent=": ",o.append(this._nameElement,r,this._valueElement),s}_createWatchExpressionTreeElement(e,t){const i=this._createWatchExpressionHeader(e,t);!t&&e&&e.hasChildren&&!e.customPreview()?(i.classList.add("watch-expression-object-header"),this._treeElement=new X.RootElement(e,this._linkifier),this._expandController.watchSection(this._expression,this._treeElement),this._treeElement.toggleOnClick=!1,this._treeElement.listItemElement.addEventListener("click",this._onSectionClick.bind(this),!1),this._treeElement.listItemElement.addEventListener("dblclick",this._dblClickOnWatchExpression.bind(this))):(i.addEventListener("dblclick",this._dblClickOnWatchExpression.bind(this)),this._treeElement=new M.TreeElement),this._treeElement.title=this._element,this._treeElement.listItemElement.classList.add("watch-expression-tree-item"),this._treeElement.listItemElement.addEventListener("keydown",e=>{isEnterKey(e)&&!this.isEditing()&&(this.startEditing(),e.consume(!0))})}_onSectionClick(e){e.consume(!0);1===e.detail?this._preventClickTimeout=setTimeout(function(){if(!this._treeElement)return;this._treeElement.expanded?this._treeElement.collapse():this._treeElement.expand()}.bind(this),333):void 0!==this._preventClickTimeout&&(window.clearTimeout(this._preventClickTimeout),this._preventClickTimeout=void 0)}_promptKeyDown(e){(isEnterKey(e)||isEscKey(e))&&this._finishEditing(e,isEscKey(e))}_populateContextMenu(t,i){this.isEditing()||t.editSection().appendItem(e.UIString("Delete watch expression"),this._updateExpression.bind(this,null)),this.isEditing()||!this._result||"number"!==this._result.type&&"string"!==this._result.type||t.clipboardSection().appendItem(e.UIString("Copy value"),this._copyValueButtonClicked.bind(this));const s=i.deepElementFromPoint();s&&this._valueElement.isSelfOrAncestor(s)&&this._result&&t.appendApplicableItems(this._result)}_copyValueButtonClicked(){ce.InspectorFrontendHostInstance.copyText(this._valueElement.textContent)}}ks._watchObjectGroupId="watch-group",ks.Events={ExpressionUpdated:Symbol("ExpressionUpdated")};var Is=Object.freeze({__proto__:null,WatchExpressionsSidebarPane:ys,WatchExpression:ks});export{at as AddSourceMapURLDialog,ut as BreakpointEditDialog,Lt as CSSPlugin,Ct as CallStackSidebarPane,Et as CoveragePlugin,Mt as DebuggerPausedMessage,ss as DebuggerPlugin,di as EditingLocationHistoryManager,os as FilePathScoreFunction,as as FilteredUISourceCodeListProvider,ds as GoToLineQuickOpen,_i as GutterDiffPlugin,hs as InplaceFormatterEditorAction,gs as JavaScriptBreakpointsSidebarPane,bi as JavaScriptCompilerPlugin,ni as NavigatorView,bs as OpenFileQuickOpen,Cs as OutlineQuickOpen,vt as Plugin,ws as ScopeChainSidebarPane,Es as ScriptFormatterEditorAction,fi as ScriptOriginPlugin,$t as SearchSourcesView,ri as SimpleHistoryManager,wi as SnippetsPlugin,Ht as SourceMapNamesResolver,xs as SourcesNavigator,Zi as SourcesPanel,Gt as SourcesSearchScope,qi as SourcesView,Vi as TabbedEditorContainer,Ki as ThreadsSidebarPane,Fi as UISourceCodeFrame,Is as WatchExpressionsSidebarPane};
